"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[4427],{2844:function(e,t){t.A={'code[class*="language-"]':{fontFamily:'Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace',fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC"},'pre[class*="language-"]':{fontFamily:'Consolas, Menlo, Monaco, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", "Courier New", Courier, monospace',fontSize:"14px",lineHeight:"1.375",direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",background:"#2a2734",color:"#5DFAFC",padding:"1em",margin:".5em 0",overflow:"auto"},'pre > code[class*="language-"]':{fontSize:"1em"},'pre[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::-moz-selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::-moz-selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'pre[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"]::selection':{textShadow:"none",background:"#6a51e6"},'code[class*="language-"] ::selection':{textShadow:"none",background:"#6a51e6"},':not(pre) > code[class*="language-"]':{padding:".1em",borderRadius:".3em"},comment:{color:"#6c6783"},prolog:{color:"#6c6783"},doctype:{color:"#6c6783"},cdata:{color:"#6c6783"},punctuation:{color:"#6c6783"},namespace:{Opacity:".7"},tag:{color:"#3AACE2"},operator:{color:"#3AACE2"},number:{color:"#3AACE2"},property:{color:"#5DFAFC"},function:{color:"#5DFAFC"},"tag-id":{color:"#eeebff"},selector:{color:"#eeebff"},"atrule-id":{color:"#eeebff"},"code.language-javascript":{color:"#c4b9fe"},"attr-name":{color:"#c4b9fe"},"code.language-css":{color:"#ffffff"},"code.language-scss":{color:"#ffffff"},boolean:{color:"#ffffff"},string:{color:"#ffffff"},entity:{color:"#ffffff",cursor:"help"},url:{color:"#ffffff"},".language-css .token.string":{color:"#ffffff"},".language-scss .token.string":{color:"#ffffff"},".style .token.string":{color:"#ffffff"},"attr-value":{color:"#ffffff"},keyword:{color:"#ffffff"},control:{color:"#ffffff"},directive:{color:"#ffffff"},unit:{color:"#ffffff"},statement:{color:"#ffffff"},regex:{color:"#ffffff"},atrule:{color:"#ffffff"},placeholder:{color:"#ffffff"},variable:{color:"#ffffff"},deleted:{textDecoration:"line-through"},inserted:{borderBottom:"1px dotted #eeebff",textDecoration:"none"},italic:{fontStyle:"italic"},important:{fontWeight:"bold",color:"#c4b9fe"},bold:{fontWeight:"bold"},"pre > code.highlight":{Outline:".4em solid #8a75f5",OutlineOffset:".4em"},".line-numbers.line-numbers .line-numbers-rows":{borderRightColor:"#2c2937"},".line-numbers .line-numbers-rows > span:before":{color:"#3c3949"},".line-highlight.line-highlight":{background:"linear-gradient(to right, rgba(224, 145, 66, 0.2) 70%, rgba(224, 145, 66, 0))"}}},8409:function(e,t,n){n.d(t,{a:function(){return Qn}});var s=n(89555),r=n(31014),o=n(13062),a=n(37523),i=n(88443),l=n(17297),c=n(46932),d=n(9133),u=n(15230),p=n(94026),m=n(50111);var g={name:"1h0bf8r",styles:"body, :host{user-select:none;}"},h={name:"1gtrael",styles:"display:flex;flex:1;overflow:hidden;flex-direction:row"},f={name:"kjqqaz",styles:"width:0;position:relative"};var x=(0,r.forwardRef)((({initialRatio:e,paneWidth:t,setPaneWidth:n,leftChild:a,leftMinWidth:i,rightChild:l,rightMinWidth:c},x)=>{var v;const[y,b]=(0,r.useState)(!1),Y=(0,r.useRef)(null),S=null===(v=(0,p.wY)({ref:Y}))||void 0===v?void 0:v.width,A=(null!==S&&void 0!==S?S:1/0)-c,w=(0,r.useRef)(e),{theme:T}=(0,o.u)(),M=(0,r.useCallback)((e=>{S&&(w.current=e/S)}),[S]);return(0,r.useImperativeHandle)(x,(()=>({updateRatio:M}))),(0,r.useLayoutEffect)((()=>{S&&n((0,d.clamp)(S*w.current,i,A))}),[S,A,i,c,n]),(0,m.FD)("div",{ref:Y,css:h,children:[y&&(0,m.Y)(s.mL,{styles:g}),(0,m.Y)(u.ResizableBox,{axis:"x",width:t,css:(0,s.AH)({display:"flex",flex:`0 0 ${t}px`},""),handle:(0,m.Y)("div",{css:f,children:(0,m.Y)("div",{css:(0,s.AH)({position:"relative",width:T.spacing.sm,marginLeft:-T.spacing.xs,minHeight:"100%",cursor:"ew-resize",backgroundColor:"rgba(0,0,0,0)",zIndex:1,":hover":{backgroundColor:"rgba(0,0,0,0.1)"}},"")})}),onResize:(e,{size:t})=>{const s=(0,d.clamp)(t.width,i,A);n(s),S&&(w.current=s/S)},onResizeStart:()=>b(!0),onResizeStop:()=>b(!1),minConstraints:[i,1/0],maxConstraints:[A,1/0],children:a}),l]})})),v=n(76137),y=n(40553);var b={name:"2wv1be",styles:"width:100%;box-sizing:border-box"};var Y=({searchFilter:e,setSearchFilter:t,matchData:n,handleNextSearchMatch:i,handlePreviousSearchMatch:l})=>{const[c,d]=(0,r.useState)(e),u=(0,v.YQ)(t,350),{theme:p}=(0,o.u)();return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:p.spacing.sm},""),children:[(0,m.Y)(y.I,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:c,onClear:()=>{t(""),d("")},onChange:e=>{d(e.target.value),u(e.target.value.toLowerCase())},prefix:(0,m.Y)(y.S,{}),css:b}),n.match&&(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",marginLeft:p.spacing.xs,marginRight:p.spacing.sm,alignItems:"center"},""),children:[(0,m.FD)(o.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginRight:p.spacing.sm},""),children:[n.currentMatchIndex+1," / ",n.totalMatches]}),(0,m.Y)(o.B,{"data-testid":"prev-search-match",icon:(0,m.Y)(a.ChevronUpIcon,{}),onClick:l,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,m.Y)(o.B,{"data-testid":"next-search-match",icon:(0,m.Y)(a.ChevronDownIcon,{}),onClick:i,componentId:"shared.model-trace-explorer.next-search-match"})]})]})};const S=1/0,A=5,w=3,T=1,M=e=>{const t=[],n=e=>{var s;e&&(t.push(e),null===(s=e.children)||void 0===s||s.forEach(n))};return e.forEach(n),t},k=(e,t=1/0)=>{const n={},s=(e,r)=>{var o;!e||r>t||(n[e.key]=e,null===(o=e.children)||void 0===o||o.forEach((e=>s(e,r+1))))};return e.forEach(s,0),n},D=e=>{if(0===e)return"0s";if(e>=6e7){return`${(e/1e6/60).toFixed(2)}m`}if(e>=1e5){return`${(e/1e6).toFixed(2)}s`}return`${(e/1e3).toFixed(2)}ms`},I=(e,t)=>{var n;return e.key===t?0:(null!==(n=e.children)&&void 0!==n?n:[]).findIndex((e=>I(e,t)>-1))},C=e=>{var t;if(!e.children||0===(null===(t=e.children)||void 0===t?void 0:t.length))return 0;const n=e.children.map(C);return Math.max(...n)+1},F=(0,r.createContext)({rootNode:null,nodeMap:{},activeView:"summary",setActiveView:()=>{},selectedNode:void 0,setSelectedNode:()=>{},activeTab:"content",setActiveTab:()=>{},showTimelineTreeGantt:!1,setShowTimelineTreeGantt:()=>{},assessmentsPaneExpanded:!1,setAssessmentsPaneExpanded:()=>{},assessmentsPaneEnabled:!0}),H=()=>(0,r.useContext)(F),N=({modelTrace:e,initialActiveView:t,selectedSpanIdOnRender:n,assessmentsPaneEnabled:s,children:o})=>{var a,i,l;const d=(0,r.useMemo)((()=>(0,c.jW)(e)),[e]),u=(0,r.useMemo)((()=>d?k([d]):{}),[d]),p=(0,c.f7)(d,n),g=null!==(a=null!==p&&void 0!==p?p:d)&&void 0!==a?a:void 0,h=(null!==(i=null===g||void 0===g||null===(l=g.assessments)||void 0===l?void 0:l.length)&&void 0!==i?i:0)>0,[f,x]=(0,r.useState)(t),[v,y]=(0,r.useState)(g),[b,Y]=(0,r.useState)(null!==v&&void 0!==v&&v.chatMessages?"chat":"content"),[S,A]=(0,r.useState)(!1),[w,T]=(0,r.useState)(h),M=(0,r.useMemo)((()=>({rootNode:d,nodeMap:u,activeView:f,setActiveView:x,activeTab:b,setActiveTab:Y,selectedNode:v,setSelectedNode:y,showTimelineTreeGantt:S,setShowTimelineTreeGantt:A,assessmentsPaneExpanded:w,setAssessmentsPaneExpanded:T,assessmentsPaneEnabled:s})),[f,u,b,d,v,S,A,w,T,s]);return(0,m.Y)(F.Provider,{value:M,children:o})},R=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}},_=({treeNode:e,selectedNode:t,setSelectedNode:n,setActiveTab:s,setExpandedKeys:o,modelTraceInfo:a})=>{var i;const[l,u]=(0,r.useState)(""),[p,m]=(0,r.useState)((()=>(e=>{const t={};e&&(0,d.compact)(M([e]).map((e=>e.type))).forEach((e=>{t[e]=!0}));return{showParents:!0,showExceptions:!0,spanTypeDisplayState:t}})(e))),[g,h]=(0,r.useState)(0),{filteredTreeNodes:f,matches:x}=(0,r.useMemo)((()=>(0,d.isNil)(e)?{filteredTreeNodes:[],matches:[]}:(0,c.vL)(e,l,p)),[null===e||void 0===e?void 0:e.key,l,p,a]),v=(0,r.useMemo)((()=>k(f)),[f]),y=(0,r.useCallback)((e=>{if(e>=x.length||e<0)return;h(e);const t=x[e];n(t.span),s(R(t));const r=((e,t)=>{const n=new Set;let s=e;for(;s&&s.parentId;)n.add(s.parentId),s=t[s.parentId];return n})(t.span,v);o((e=>new Set([...e,...r])))}),[x,n,s,v,o]),b=(0,r.useCallback)((()=>{y(g+1)}),[g,y]),Y=(0,r.useCallback)((()=>{y(g-1)}),[g,y]);return(0,r.useLayoutEffect)((()=>{if(0!==f.length)if(0!==x.length)h(0),n(x[0].span),s(R(x[0]));else{var e;const r=null!==(e=null===t||void 0===t?void 0:t.key)&&void 0!==e?e:"";if(r in v)n(v[r]);else{const e=f[0];n(e),s(null!==e&&void 0!==e&&e.chatMessages?"chat":"content")}}}),[f,x,n]),{matchData:{match:null!==(i=x[g])&&void 0!==i?i:null,totalMatches:x.length,currentMatchIndex:g},searchFilter:l.toLowerCase().trim(),setSearchFilter:u,spanFilterState:p,setSpanFilterState:m,filteredTreeNodes:f,handleNextSearchMatch:b,handlePreviousSearchMatch:Y}};var z=n(48563);const E="yellow500",B="yellow200",O=({searchFilter:e,data:t,activeMatch:n,containsActiveMatch:a})=>{const{theme:i}=(0,o.u)(),l=(0,r.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),d=(0,r.useMemo)((()=>e?(0,c.OS)({data:t,searchFilter:e,activeMatchBackgroundColor:i.colors[E],inactiveMatchBackgroundColor:i.colors[B],containsActiveMatch:a,activeMatch:n,scrollToActiveMatch:l}):[]),[e,t,i,a,n,l]);return(0,m.Y)("pre",{css:(0,s.AH)({whiteSpace:"pre-wrap",backgroundColor:i.colors.backgroundSecondary,padding:i.spacing.sm,fontSize:i.typography.fontSizeSm},""),children:d})};var j=n(74396),L=n(55921),K=n(27193),$=n(22734);var P={name:"1qmr6ab",styles:"overflow:auto"},W={name:"uufhp1",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%;z-index:0"};const V=({children:e})=>(0,m.Y)("div",{"data-testid":"basic-table",css:P,children:(0,m.Y)(a.Table,{scrollable:!0,css:W,children:e})}),U=({children:e,node:t})=>{const{header:n,rows:s,isValid:o}=function({children:e}){var t;if(!e)return{header:void 0,rows:[],isValid:!1};const n=r.Children.toArray(e);return{header:null!==(t=n[0])&&void 0!==t?t:void 0,rows:n.slice(1).flatMap((e=>r.isValidElement(e)?r.Children.toArray(e.props.children).filter((e=>r.isValidElement(e))):[])),isValid:!0}}({children:e,node:t});return o?(0,m.Y)(q,{header:n,rows:s}):(0,m.Y)(V,{children:e,node:t})};var J={name:"qneu98",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%"};const q=({header:e,rows:t})=>{const{theme:n}=(0,o.u)(),i=r.useRef(null),l=(0,$.z)({size:t.length,parentRef:i,overscan:20}),{virtualItems:c,totalSize:d}=l;return(0,m.Y)("div",{"data-testid":"virtualized-table",ref:i,css:(0,s.AH)({overflow:"auto",maxHeight:420,border:"1px solid",borderColor:n.colors.border,borderRadius:n.borders.borderRadiusMd,marginBottom:n.spacing.md,zIndex:0},""),children:(0,m.FD)(a.Table,{css:J,children:[e,(0,m.Y)("div",{css:(0,s.AH)({position:"relative",height:`${d}px`,width:"100%",'& > div:last-child [role="cell"]':{borderBottom:"none"}},""),children:c.map((e=>{const n=e.index,r=t[n];return(0,m.Y)("div",{ref:e.measureRef,css:(0,s.AH)({position:"absolute",top:`${e.start}px`,width:"100%"},""),children:r},n)}))})]})})},G=({children:e,node:t})=>{const n=null===t||void 0===t?void 0:t.children.some((e=>"th"===e.tagName)),{theme:s}=(0,o.u)();return(0,m.Y)(a.TableRow,{style:n?{position:"sticky",top:0,zIndex:1,backgroundColor:s.colors.backgroundPrimary}:void 0,children:e,isHeader:n})},Z=({children:e,node:t})=>{const n="th"===(null===t||void 0===t?void 0:t.tagName),{theme:r}=(0,o.u)();return n?(0,m.Y)(a.TableHeader,{"data-testid":"virtualized-table-header",componentId:"virtualized-table-header",css:(0,s.AH)({paddingLeft:r.spacing.sm,borderColor:r.colors.border,color:r.colors.textPrimary},""),children:e}):(0,m.Y)(a.TableCell,{children:e})};const X=e=>e.startsWith("data:image/png")||e.startsWith("data:image/jpeg")?e:(0,j.Lv)(e),Q=e=>{const t=(0,r.useMemo)((()=>ae({extensions:e.components})),[e.components]);return(0,m.Y)(j.oz,{components:t,remarkPlugins:re,urlTransform:X,children:e.children})},ee=({codeBlock:e,codeInline:t,node:n,...s})=>{var o,a;const i=r.useMemo((()=>{var e;const t=/language-(\w+)/.exec(null!==(e=s.className)&&void 0!==e?e:"");return t&&t[1]?t[1]:void 0}),[s.className]);return(null===n||void 0===n||null===(o=n.position)||void 0===o?void 0:o.start.line)===(null===n||void 0===n||null===(a=n.position)||void 0===a?void 0:a.end.line)?r.createElement(t,s):r.createElement(e,{...s,language:i})},te=({children:e})=>(0,m.Y)(o.T.Text,{code:!0,children:e});var ne={name:"bjn8wh",styles:"position:relative"};const se=r.memo((({children:e,language:t})=>{const{theme:n}=(0,o.u)(),s=String(e).replace(/\n$/,"");return(0,m.Y)("div",{css:ne,children:(0,m.Y)(K.z7,{actions:(0,m.Y)(K.VE,{componentId:"genai.util.markdown-copy-code-block",copyText:s}),theme:n.isDarkMode?"duotoneDark":"light",children:s,language:t&&ie(t)?t:"text",style:{padding:"8px 0",borderRadius:8,width:"100%",boxSizing:"border-box",maxHeight:640,display:"flex",flexDirection:"column-reverse"},showLineNumbers:!0})})})),re=[L.A];var oe={name:"qhxz92",styles:"max-width:100%"};const ae=e=>({a:({href:e,children:t})=>(0,m.Y)(o.T.Link,{componentId:"codegen_webapp_js_genai_util_markdown.tsx_71",href:e,id:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?e.replace("#user-content-fn-","user-content-fnref-"):void 0,disabled:null===e||void 0===e?void 0:e.startsWith("."),children:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?(0,m.FD)(m.FK,{children:["[",t,"]"]}):t,openInNewTab:!(e&&e.startsWith("#"))}),code:t=>{var n,s,r,o;return(0,m.Y)(ee,{...t,codeBlock:null!==(n=null===(s=e.extensions)||void 0===s?void 0:s.codeBlock)&&void 0!==n?n:se,codeInline:null!==(r=null===(o=e.extensions)||void 0===o?void 0:o.codeInline)&&void 0!==r?r:te})},p:({children:e})=>(0,m.Y)(o.T.Paragraph,{children:e}),h1:({children:e})=>(0,m.Y)(o.T.Title,{level:1,children:e}),h2:({children:e})=>(0,m.Y)(o.T.Title,{level:2,children:e}),h3:({children:e})=>(0,m.Y)(o.T.Title,{level:3,children:e}),h4:({children:e})=>(0,m.Y)(o.T.Title,{level:4,children:e}),h5:({children:e})=>(0,m.Y)(o.T.Title,{level:5,children:e}),table:({children:e,node:t})=>(0,m.Y)(U,{children:e,node:t}),tr:({children:e,node:t})=>(0,m.Y)(G,{children:e,node:t}),th:({children:e,node:t})=>(0,m.Y)(Z,{children:e,node:t}),td:({children:e})=>(0,m.Y)(a.TableCell,{children:e,multiline:!0}),thead:({children:e})=>(0,m.Y)(m.FK,{children:e}),tbody:({children:e})=>(0,m.Y)(m.FK,{children:e}),img:({src:e,alt:t})=>(0,m.Y)("img",{src:e,alt:t,css:oe})}),ie=e=>{switch(e){case"go":case"java":case"javascript":case"json":case"python":case"sql":case"text":case"yaml":return!0;default:return!1}};var le={name:"bjn8wh",styles:"position:relative"},ce={name:"n31mhe",styles:"width:100%;padding:0"};function de({data:e,searchFilter:t="",activeMatch:n=null,containsActiveMatch:l=!1,renderMode:c=z.cC.JSON}){const u=Boolean(t)&&!(0,d.isNil)(n)&&e.toLowerCase().includes(t),{theme:p}=(0,o.u)(),[g,h]=(0,r.useState)("json"===c),[f,x]=(0,r.useState)(u),v=(0,r.useRef)(null),y=(0,r.useMemo)((()=>{if("json"===c)return e;const t=JSON.parse(e);return(0,d.isString)(t)?t:e}),[e,c]),b=g||y.split("\n").length>4||y.length>300,Y=(0,r.useMemo)((()=>{if(b&&!f){const e=y.split("\n").slice(0,4).join("\n");return e.length>300?e.slice(0,300):e}return y}),[y,b,f]);(0,r.useEffect)((()=>{v.current&&h(v.current.scrollWidth>v.current.clientWidth)}),[e]);const S=(0,r.useCallback)((e=>(0,m.Y)("pre",{...e,ref:v})),[]);return u?(0,m.Y)(O,{data:e,searchFilter:t,activeMatch:n,containsActiveMatch:!n.isKeyMatch&&l}):(0,m.FD)("div",{css:le,children:["markdown"===c?(0,m.Y)("div",{css:(0,s.AH)({padding:p.spacing.md,backgroundColor:p.colors.backgroundSecondary,marginBottom:-p.spacing.md},""),children:(0,m.Y)(Q,{children:Y})}):(0,m.FD)(m.FK,{children:[(0,m.Y)(K.VE,{componentId:"shared.model-trace-explorer.copy-snippet",copyText:e,size:"small",css:(0,s.AH)({position:"absolute",top:p.spacing.xs,right:p.spacing.xs,zIndex:1},"")},"copy-snippet"),(0,m.Y)(K.z7,{PreTag:S,showLineNumbers:!0,language:c,lineProps:{style:{wordBreak:"break-word",whiteSpace:"pre-wrap"}},wrapLines:f,theme:p.isDarkMode?"duotoneDark":"light",style:{backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.sm,paddingBottom:b?0:p.spacing.sm,paddingRight:2*p.spacing.md,overflow:f?"auto":"hidden",textOverflow:"ellipsis",fontSize:p.typography.fontSizeSm,lineHeight:p.typography.lineHeightBase},children:Y})]}),b&&(0,m.Y)("div",{css:(0,s.AH)({backgroundColor:p.colors.backgroundSecondary},""),children:(0,m.Y)(o.B,{css:ce,componentId:f?"shared.model-trace-explorer.snippet-see-less":"shared.model-trace-explorer.snippet-see-more",icon:f?(0,m.Y)(a.ChevronUpIcon,{}):(0,m.Y)(a.ChevronDownIcon,{}),type:"tertiary",onClick:()=>x(!f),children:f?(0,m.Y)(i.A,{id:"AgjhWE",defaultMessage:"See less"}):(0,m.Y)(i.A,{id:"HYQHVk",defaultMessage:"See more"})})})]})}const ue=({title:e,searchFilter:t,isActiveMatch:n})=>{const{theme:a}=(0,o.u)(),i=(0,r.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),l=e.toLowerCase();if(!l.includes(t))return(0,m.Y)("div",{children:e});const c=l.indexOf(t),d=c+t.length,u=n?a.colors[E]:a.colors[B];return(0,m.FD)("div",{children:[e.slice(0,c),(0,m.Y)("span",{ref:n?i:null,css:(0,s.AH)({backgroundColor:u,scrollMarginTop:50},""),children:e.slice(c,d)}),e.slice(d)]})};function pe(e,t){return t||(e?z.cC.MARKDOWN:z.cC.JSON)}function me(e){switch(e){case z.cC.JSON:return"JSON";case z.cC.TEXT:return"Text";case z.cC.MARKDOWN:return"Markdown"}}var ge={name:"bjn8wh",styles:"position:relative"},he={name:"1boj65s",styles:"max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},fe={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},xe={name:"2fp7nl",styles:"height:min-content;margin:0"};function ve({title:e,tokens:t,data:n,searchFilter:i="",activeMatch:l=null,containsActiveMatch:c=!1,initialRenderMode:u}){var p;const g=(0,r.useMemo)((()=>JSON.parse(n)),[n]),h=(0,d.isString)(g),{theme:f}=(0,o.u)(),[x,v]=(0,r.useState)(pe(h,u)),y=c&&null!==(p=null===l||void 0===l?void 0:l.isKeyMatch)&&void 0!==p&&p,b=h&&!i;return(0,r.useEffect)((()=>{v(pe(h,u))}),[h,u]),(0,m.Y)("div",{css:ge,children:(0,m.FD)("div",{css:(0,s.AH)({borderRadius:f.borders.borderRadiusSm,border:`1px solid ${f.colors.border}`,overflow:"hidden"},""),children:[(e||b)&&(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:f.spacing.sm},""),children:[(0,m.Y)(o.T.Title,{css:he,level:4,color:"secondary",withoutMargins:!0,children:(0,m.Y)(ue,{title:e,searchFilter:i,isActiveMatch:y})}),(0,m.Y)("div",{css:fe,children:b&&(0,m.FD)(a.DropdownMenu.Root,{children:[(0,m.Y)(a.DropdownMenu.Trigger,{asChild:!0,children:(0,m.Y)(a.Tag,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:xe,children:(0,m.FD)("div",{css:(0,s.AH)({paddingLeft:f.spacing.xs,marginRight:f.spacing.xs,cursor:"pointer"},""),children:[(0,m.Y)(o.T.Text,{size:"sm",color:"secondary",children:me(x)}),(0,m.Y)(a.ChevronDownIcon,{})]})})}),(0,m.FD)(a.DropdownMenu.Content,{children:[(0,m.Y)(a.DropdownMenu.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:x,onValueChange:e=>v(e),children:Object.values(z.cC).map((e=>(0,m.FD)(a.DropdownMenu.RadioItem,{value:e,children:[(0,m.Y)(a.DropdownMenu.ItemIndicator,{}),me(e)]},e)))}),(0,m.Y)(a.DropdownMenu.Arrow,{})]})]})})]}),(0,m.Y)(de,{data:n,searchFilter:i,activeMatch:l,containsActiveMatch:c,renderMode:x})]})})}function ye({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:r}=(0,o.u)(),{attributes:l}=e,c=(0,d.keys)(l).length>0,u=!(0,d.isNil)(n)&&n.span.key===e.key;return!c||(0,d.isNil)(l)?(0,m.Y)("div",{css:(0,s.AH)({marginTop:r.spacing.md},""),children:(0,m.Y)(a.Empty,{description:(0,m.Y)(i.A,{id:"B5K1Ix",defaultMessage:"No attributes found"})})}):(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm,padding:r.spacing.md},""),children:Object.entries(l).map((([e,s])=>(0,m.Y)(ve,{title:e,data:JSON.stringify(s,null,2),searchFilter:t,activeMatch:n,containsActiveMatch:u&&"attributes"===n.section&&n.key===e},e)))})}function be({paramName:e,paramProperties:t,isRequired:n}){const{theme:r}=(0,o.u)(),{type:a,description:l,enum:c}=t,d=a||l||c,u=d?{borderTopLeftRadius:r.borders.borderRadiusMd,borderTopRightRadius:r.borders.borderRadiusMd,borderBottom:`1px solid ${r.colors.border}`}:{borderRadius:r.borders.borderRadiusMd};return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:r.borders.borderRadiusMd,border:`1px solid ${r.colors.border}`},""),children:[(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:r.colors.backgroundSecondary,padding:`${r.spacing.sm}px ${r.spacing.md}px`,gap:r.spacing.sm,...u},""),children:[(0,m.Y)(o.T.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e}),n&&(0,m.Y)(o.T.Text,{withoutMargins:!0,color:"error",children:(0,m.Y)(i.A,{id:"JmNdE4",defaultMessage:"required"})})]}),d&&(0,m.FD)("div",{css:(0,s.AH)({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:r.spacing.md,padding:`${r.spacing.sm}px ${r.spacing.md}px`},""),children:[a&&(0,m.FD)(m.FK,{children:[(0,m.Y)(o.T.Text,{withoutMargins:!0,bold:!0,children:(0,m.Y)(i.A,{id:"CbRDlp",defaultMessage:"Type"})}),(0,m.Y)(o.T.Text,{withoutMargins:!0,code:!0,children:a})]}),l&&(0,m.FD)(m.FK,{children:[(0,m.Y)(o.T.Text,{withoutMargins:!0,bold:!0,children:(0,m.Y)(i.A,{id:"SLjN1/",defaultMessage:"Description"})}),(0,m.Y)(o.T.Text,{withoutMargins:!0,children:l})]}),c&&(0,m.FD)(m.FK,{children:[(0,m.Y)(o.T.Text,{withoutMargins:!0,bold:!0,children:(0,m.Y)(i.A,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm,flexWrap:"wrap"},""),children:c.map((e=>(0,m.Y)(o.T.Text,{withoutMargins:!0,code:!0,children:e},e)))})]})]})]})}function Ye({tool:e}){var t,n,i;const{theme:l}=(0,o.u)(),[c,d]=(0,r.useState)(!1),u=e.function.description,p=null===(t=e.function.parameters)||void 0===t?void 0:t.properties,g=null!==(n=null===(i=e.function.parameters)||void 0===i?void 0:i.required)&&void 0!==n?n:[],h=u||p,f=h?{":hover":{backgroundColor:l.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:l.borders.borderRadiusMd,border:`1px solid ${l.colors.border}`,backgroundColor:l.colors.backgroundPrimary},""),"data-testid":"model-trace-explorer-chat-tool",children:[(0,m.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",gap:l.spacing.sm,alignItems:"center",borderBottom:h&&c?`1px solid ${l.colors.border}`:"none",padding:l.spacing.sm,...f},""),onClick:()=>d(!c),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[h&&(c?(0,m.Y)(a.ChevronDownIcon,{}):(0,m.Y)(o.q,{})),(0,m.Y)(o.T.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.function.name})]}),h&&c&&(0,m.FD)("div",{css:(0,s.AH)({padding:l.spacing.sm},""),children:[u&&(0,m.Y)(o.T.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:l.spacing.sm,padding:`0px ${l.spacing.xs}px`},children:e.function.description}),p&&(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:l.spacing.sm},""),children:Object.keys(p).map((e=>(0,m.Y)(be,{paramName:e,paramProperties:p[e],isRequired:g.includes(e)},e)))})]})]})}var Se=n(6958),Ae=n(86494);const we=e=>{switch(e){case"system":return(0,m.Y)(Ae.P,{type:z.Dy.SYSTEM});case"user":return(0,m.Y)(Ae.P,{type:z.Dy.USER});case"tool":case"function":return(0,m.Y)(Ae.P,{type:z.Dy.WRENCH});default:return(0,m.Y)(Ae.P,{type:z.Dy.MODELS})}},Te=e=>{switch(e.role){case"system":return(0,m.Y)(i.A,{id:"+gqcru",defaultMessage:"System"});case"user":return(0,m.Y)(i.A,{id:"t+aG6y",defaultMessage:"User"});case"assistant":return(0,m.Y)(i.A,{id:"Hvznjh",defaultMessage:"Assistant"});case"tool":return e.name?e.name:(0,m.Y)(i.A,{id:"dPn3az",defaultMessage:"Tool"});case"function":return(0,m.Y)(i.A,{id:"5ZUAC2",defaultMessage:"Function"});default:return e.role}};var Me={name:"7dymr5",styles:"white-space:nowrap;display:inline-flex;align-items:center;flex:1;min-width:0"},ke={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const De=({isExpandable:e,expanded:t,setExpanded:n,message:r})=>{const{theme:l}=(0,o.u)(),c=e?{":hover":{backgroundColor:l.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,m.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:l.spacing.sm,gap:l.spacing.sm,...c},""),onClick:()=>n(!t),children:[e&&(t?(0,m.Y)(a.ChevronDownIcon,{}):(0,m.Y)(o.q,{})),we(r.role),r.tool_call_id?(0,m.Y)(o.T.Text,{color:"secondary",css:Me,children:(0,m.Y)(i.A,{id:"mWl3Qv",defaultMessage:"{toolName} was called in {toolCallId}",values:{toolName:(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginRight:l.spacing.xs},""),bold:!0,children:Te(r)}),toolCallId:(0,m.Y)(Se.T,{componentId:"test",content:r.tool_call_id,children:(0,m.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:l.spacing.xs},""),children:(0,m.Y)(o.T.Text,{css:ke,code:!0,children:r.tool_call_id})})})}})}):(0,m.Y)(o.T.Text,{bold:!0,children:Te(r)})]})};var Ie={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};function Ce({toolCall:e}){const{theme:t}=(0,o.u)();return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,m.Y)(o.T.Text,{color:"secondary",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${t.spacing.sm+t.spacing.xs}px`},""),children:(0,m.Y)(i.A,{id:"hV4vVj",defaultMessage:"called {functionName} in {toolCallId}",values:{functionName:(0,m.FD)(a.Tag,{color:"purple",componentId:"shared.model-trace-explorer.function-name-tag",css:(0,s.AH)({margin:`0px ${t.spacing.xs}px`},""),children:[(0,m.Y)(a.FunctionIcon,{}),(0,m.Y)(o.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginLeft:t.spacing.xs},""),children:e.function.name})]}),toolCallId:(0,m.Y)(Se.T,{componentId:"test",content:e.id,children:(0,m.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:t.spacing.xs},""),children:(0,m.Y)(o.T.Text,{css:Ie,code:!0,color:"secondary",children:e.id})})})}})}),(0,m.Y)(de,{data:e.function.arguments})]},e.id)}function Fe({content:e,shouldDisplayCodeSnippet:t}){const{theme:n}=(0,o.u)();return e?t?(0,m.Y)(de,{data:e,searchFilter:"",activeMatch:null,containsActiveMatch:!1,renderMode:z.cC.JSON}):(0,m.Y)("div",{css:(0,s.AH)({padding:n.spacing.sm,paddingTop:0,marginBottom:-n.typography.fontSizeBase},""),children:(0,m.Y)(Q,{children:e})}):null}function He({message:e,className:t}){var n,l;const{theme:c}=(0,o.u)(),[u,p]=(0,r.useState)(!1),{content:g,isJson:h}=(e=>{try{return{content:JSON.stringify(JSON.parse(e),null,2),isJson:!0}}catch(t){return{content:e,isJson:!1}}})(null!==(n=e.content)&&void 0!==n?n:""),f=h&&("tool"===e.role||"function"===e.role),x=null===(l=e.content)||void 0===l?void 0:l.startsWith("!["),v=!f&&!x&&g.length>300,y=v&&!u?`${g.slice(0,300)}...`:g;return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:c.borders.borderRadiusSm,border:`1px solid ${c.colors.border}`,backgroundColor:c.colors.backgroundPrimary,overflow:"hidden"},""),className:t,children:[(0,m.Y)(De,{isExpandable:v,expanded:u,setExpanded:p,message:e}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm},""),children:[!(0,d.isNil)(e.tool_calls)&&e.tool_calls.map((e=>(0,m.Y)(Ce,{toolCall:e},e.id))),(0,m.Y)(Fe,{content:y,shouldDisplayCodeSnippet:f})]}),v&&(0,m.Y)(o.B,{componentId:u?"shared.model-trace-explorer.chat-message-see-less":"shared.model-trace-explorer.chat-message-see-more",icon:u?(0,m.Y)(a.ChevronUpIcon,{}):(0,m.Y)(a.ChevronDownIcon,{}),type:"tertiary",onClick:()=>p(!u),css:(0,s.AH)({display:"flex",width:"100%",padding:c.spacing.md,borderRadius:"0px !important"},""),children:u?(0,m.Y)(i.A,{id:"gTEFCD",defaultMessage:"See less"}):(0,m.Y)(i.A,{id:"6fP+8o",defaultMessage:"See more"})})]})}function Ne({messages:e}){const{theme:t}=(0,o.u)();return(0,d.isNil)(e)?null:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e.map(((e,t)=>(0,m.Y)(He,{message:e},t)))})}var Re={name:"1d3w5wq",styles:"width:100%"};const _e=({sectionKey:e,title:t,children:n,withBorder:i=!1,className:l})=>{const[c,d]=(0,r.useState)(!0),{theme:u}=(0,o.u)();return(0,m.FD)("div",{className:l,css:(0,s.AH)({display:"flex",flexDirection:"column",borderRadius:u.borders.borderRadiusMd},""),children:[(0,m.FD)("div",{css:(0,s.AH)({alignItems:"center",display:"flex",flexDirection:"row",gap:u.spacing.xs,padding:i?u.spacing.sm:0,background:i?u.colors.backgroundSecondary:void 0,borderTopLeftRadius:u.borders.borderRadiusMd,borderTopRightRadius:u.borders.borderRadiusMd,borderBottomLeftRadius:c?0:u.borders.borderRadiusMd,borderBottomRightRadius:c?0:u.borders.borderRadiusMd,border:i?`1px solid ${u.colors.border}`:void 0,marginBottom:i?0:u.spacing.sm},""),children:[(0,m.Y)(o.B,{size:"small",componentId:`shared.model-trace-explorer.expand-${e}`,type:"tertiary",icon:c?(0,m.Y)(a.ChevronDownIcon,{}):(0,m.Y)(o.q,{}),onClick:()=>d(!c)}),(0,m.Y)(o.T.Title,{withoutMargins:!0,level:4,css:Re,children:t})]}),c&&(0,m.Y)("div",{css:(0,s.AH)({border:i?`1px solid ${u.colors.border}`:void 0,borderTop:"none",borderBottomLeftRadius:i?u.borders.borderRadiusMd:void 0,borderBottomRightRadius:i?u.borders.borderRadiusMd:void 0,padding:i?u.spacing.sm:0},""),children:n})]})};function ze({chatMessages:e,chatTools:t}){const{theme:n}=(0,o.u)();return(0,m.FD)("div",{css:(0,s.AH)({overflowY:"auto",padding:n.spacing.md},""),"data-testid":"model-trace-explorer-chat-tab",children:[t&&(0,m.Y)(_e,{css:(0,s.AH)({marginBottom:n.spacing.sm},""),title:(0,m.Y)(i.A,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:t.map((e=>(0,m.Y)(Ye,{tool:e},e.function.name)))})}),(0,m.Y)(_e,{title:(0,m.Y)(i.A,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,m.Y)(Ne,{messages:e})})]})}var Ee={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"},Be={name:"uqztsn",styles:"display:flex;flex-direction:row;justify-content:space-between;width:100%"};function Oe({activeSpan:e,className:t,searchFilter:n,activeMatch:a}){const{theme:l}=(0,o.u)(),u=(0,r.useMemo)((()=>(0,c.g_)(null===e||void 0===e?void 0:e.inputs)),[e]),p=(0,r.useMemo)((()=>(0,c.g_)(null===e||void 0===e?void 0:e.outputs)),[e]);if((0,d.isNil)(e))return null;const g=u.length>0,h=p.length>0,f=!(0,d.isNil)(a)&&a.span.key===e.key;return(0,m.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[g&&(0,m.Y)(_e,{withBorder:!0,css:(0,s.AH)({marginBottom:l.spacing.sm},""),sectionKey:"input",title:(0,m.Y)("div",{css:Ee,children:(0,m.Y)(i.A,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:l.spacing.sm},""),children:u.map((({key:e,value:t},s)=>(0,m.Y)(ve,{title:e,data:t,searchFilter:n,activeMatch:a,containsActiveMatch:f&&"inputs"===a.section&&a.key===e},e||s)))})}),h&&(0,m.Y)(_e,{withBorder:!0,sectionKey:"output",title:(0,m.Y)("div",{css:Be,children:(0,m.Y)(i.A,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:l.spacing.sm},""),children:p.map((({key:e,value:t})=>(0,m.Y)(ve,{title:e,data:t,searchFilter:n,activeMatch:a,containsActiveMatch:f&&"outputs"===a.section&&a.key===e},e)))})})]})}const je=e=>e?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"},Le=({itemKey:e,itemValue:t,charLimit:n=18,maxWidth:r=150,className:i})=>{const{shouldTruncateKey:l,shouldTruncateValue:c}=function(e,t,n){const s=e.length+t.length,r=e.length>t.length,o=r?t.length:e.length;return s<=n?{shouldTruncateKey:!1,shouldTruncateValue:!1}:o>n/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:r,shouldTruncateValue:!r}}(e,t,n);return(0,m.Y)(Se.T,{componentId:"shared.model-trace-explorer.key-value-tag.hover-tooltip",content:`${e}: ${t}`,children:(0,m.Y)(a.Tag,{componentId:"shared.model-trace-explorer.key-value-tag",className:i,children:(0,m.FD)("span",{css:(0,s.AH)({maxWidth:r,display:"inline-flex"},""),children:[(0,m.Y)(o.T.Text,{bold:!0,css:je(l),size:"sm",children:e}),":\xa0",(0,m.Y)(o.T.Text,{css:je(c),size:"sm",children:t})]})})})};var Ke={name:"1fttcpj",styles:"display:flex;flex-direction:column"};function $e({text:e,metadataTags:t,setExpanded:n,logDocumentClick:r}){const{theme:l}=(0,o.u)();return(0,m.FD)("div",{css:Ke,children:[(0,m.Y)("div",{role:"button",onClick:()=>{n(!1),null===r||void 0===r||r("collapse")},css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${l.spacing.sm}px ${l.spacing.md}px`,height:l.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:l.colors.backgroundSecondary}},""),children:(0,m.Y)(a.FileDocumentIcon,{})}),(0,m.Y)("div",{css:(0,s.AH)({padding:l.spacing.md,paddingBottom:0},""),children:(0,m.Y)(Q,{children:e})}),(0,m.Y)("div",{css:(0,s.AH)({padding:l.spacing.md,paddingTop:0},""),children:t.map((({key:e,value:t})=>(0,m.Y)(Le,{itemKey:e,itemValue:t},e)))}),(0,m.Y)(o.B,{css:(0,s.AH)({width:"100%",padding:l.spacing.sm},""),componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,m.Y)(a.ChevronUpIcon,{}),type:"tertiary",onClick:()=>n(!1),children:(0,m.Y)(i.A,{id:"AgjhWE",defaultMessage:"See less"})})]})}var Pe={name:"ti75j2",styles:"margin:0"},We={name:"1r5gb7q",styles:"display:inline-block"},Ve={name:"1tma7dt",styles:"white-space:nowrap;margin:0"};function Ue({text:e,metadataTags:t,setExpanded:n,logDocumentClick:r}){const{theme:i}=(0,o.u)();return(0,m.FD)("div",{role:"button",onClick:()=>{n(!0),null===r||void 0===r||r("expand")},css:(0,s.AH)({display:"flex",flexDirection:"row",padding:`${i.spacing.sm}px ${i.spacing.md}px`,gap:i.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:i.colors.backgroundSecondary}},""),children:[(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},""),children:[(0,m.Y)(a.FileDocumentIcon,{}),(0,m.Y)(o.T.Text,{ellipsis:!0,size:"md",children:e})]}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm},""),children:[t.length>0?(0,m.Y)(Le,{css:Pe,itemKey:t[0].key,itemValue:t[0].value}):null,t.length>1?(0,m.Y)(Se.T,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:t.slice(1).map((({key:e,value:t})=>(0,m.Y)("span",{css:We,children:`${e}: ${t}`},e))),children:(0,m.FD)(a.Tag,{componentId:"shared.model-trace-explorer.tag-count",css:Ve,children:["+",t.length-1]})}):null]})]})}function Je({text:e,metadata:t}){const[n,s]=(0,r.useState)(!1),o=(0,c.g_)(t);return n?(0,m.Y)($e,{text:e,metadataTags:o,setExpanded:s}):(0,m.Y)(Ue,{text:e,metadataTags:o,setExpanded:s})}var qe={name:"s5xdrg",styles:"display:flex;align-items:center"},Ge={name:"s5xdrg",styles:"display:flex;align-items:center"};function Ze({shouldRenderMarkdown:e,setShouldRenderMarkdown:t}){const{theme:n}=(0,o.u)();return(0,m.FD)(a.SegmentedControlGroup,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:`shared.model-trace-explorer.toggle-markdown-rendering-${!e}`,value:e,onChange:e=>{t(e.target.value)},children:[(0,m.Y)(a.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,m.Y)(Se.T,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,m.Y)(i.A,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,m.Y)("div",{css:qe,children:(0,m.Y)(a.TextBoxIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})}),(0,m.Y)(a.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,m.Y)(Se.T,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,m.Y)(i.A,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,m.Y)("div",{css:Ge,children:(0,m.Y)(a.MIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})})]})}var Xe={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"};function Qe({activeSpan:e,className:t,searchFilter:n,activeMatch:l}){const{theme:u}=(0,o.u)(),[p,g]=(0,r.useState)(!0),h=(0,r.useMemo)((()=>(0,c.g_)(e.inputs)),[e]),f=e.outputs,x=h.length>0,v=!(0,d.isNil)(l)&&l.span.key===e.key,y=v&&"outputs"===l.section;return(0,m.FD)("div",{className:t,"data-testid":"model-trace-explorer-retriever-span-view",children:[x&&(0,m.Y)(_e,{sectionKey:"input",css:(0,s.AH)({marginBottom:u.spacing.sm},""),title:(0,m.Y)(i.A,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:h.map((({key:e,value:t},s)=>(0,m.Y)(ve,{title:e,data:t,searchFilter:n,activeMatch:l,containsActiveMatch:v&&"inputs"===l.section&&l.key===e},e||s)))})}),(0,m.Y)(_e,{sectionKey:"output",title:(0,m.FD)("div",{css:Xe,children:[(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:u.spacing.sm},""),children:[(0,m.Y)(i.A,{id:"ThYYz6",defaultMessage:"Documents"}),(0,m.Y)(a.Tag,{componentId:"shared.model-trace-explorer.document-count",children:f.length})]}),!y&&(0,m.Y)(Ze,{shouldRenderMarkdown:p,setShouldRenderMarkdown:g})]}),children:p&&!y?(0,m.Y)("div",{css:(0,s.AH)({border:`1px solid ${u.colors.border}`,borderRadius:u.legacyBorders.borderRadiusMd},""),children:f.map(((e,t)=>(0,m.Y)("div",{css:(0,s.AH)({borderBottom:t!==f.length-1?`1px solid ${u.colors.border}`:""},""),children:(0,m.Y)(Je,{text:e.page_content,metadata:e.metadata},t)},t)))}):(0,m.Y)("div",{css:(0,s.AH)({border:`1px solid ${u.colors.border}`,borderRadius:u.legacyBorders.borderRadiusMd,padding:u.spacing.md},""),children:(0,m.Y)(ve,{title:"",data:JSON.stringify(f,null,2),searchFilter:n,activeMatch:l,containsActiveMatch:v&&"outputs"===l.section})})})]})}function et({activeSpan:e,className:t,searchFilter:n,activeMatch:r}){const{theme:a}=(0,o.u)();return!(0,d.isNil)(e)&&(0,c.vl)(e)?(0,m.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:a.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,m.Y)(Qe,{activeSpan:e,className:t,searchFilter:n,activeMatch:r})}):(0,m.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:a.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,m.Y)(Oe,{activeSpan:e,className:t,searchFilter:n,activeMatch:r})})}function tt({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:r}=(0,o.u)(),{events:l}=e,u=!(0,d.isNil)(n)&&n.span.key===e.key;return Array.isArray(l)&&0!==l.length?(0,m.Y)("div",{css:(0,s.AH)({padding:r.spacing.md},""),children:l.map(((e,i)=>{const l=e.attributes,d="exception"===e.name?(0,m.FD)(m.FK,{children:[(0,m.Y)(a.XCircleIcon,{css:(0,s.AH)({marginRight:r.spacing.sm},""),color:"danger"}),(0,m.Y)(o.T.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;return l?(0,m.Y)(_e,{sectionKey:e.name,title:d,withBorder:!0,children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:Object.keys(l).map((s=>{const r=(0,c.Q0)(e.name,i,s);return(0,m.Y)(ve,{title:s,data:JSON.stringify(l[s],null,2),searchFilter:t,activeMatch:n,containsActiveMatch:u&&"events"===n.section&&n.key===r,initialRenderMode:z.cC.TEXT},r)}))})},`${e.name}-${i}`):null}))}):(0,m.Y)("div",{css:(0,s.AH)({marginTop:r.spacing.md},""),children:(0,m.Y)(a.Empty,{description:(0,m.Y)(i.A,{id:"xnr5KT",defaultMessage:"No events found"})})})}function nt({count:e}){const{theme:t}=(0,o.u)();return(0,m.Y)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:"center",borderRadius:t.typography.fontSizeBase,height:t.typography.fontSizeBase,backgroundColor:t.colors.actionDangerPrimaryBackgroundDefault,padding:t.spacing.xs,marginLeft:t.spacing.xs,boxSizing:"border-box"},""),children:(0,m.Y)("span",{css:(0,s.AH)({color:t.colors.actionPrimaryTextDefault,fontSize:11},""),children:e})})}var st={name:"4zleql",styles:"display:block"},rt={name:"oit39a",styles:"& > span{display:flex;align-items:center;}"};const ot=()=>{const{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:t,assessmentsPaneEnabled:n}=H();return(0,m.Y)(a.SegmentedControlGroup,{css:st,name:"shared.model-trace-explorer.assessments-pane-toggle",componentId:"shared.model-trace-explorer.assessments-pane-toggle",value:e,size:"small",children:(0,m.Y)(a.SegmentedControlButton,{value:!0,disabled:!n,icon:(0,m.Y)(a.GavelIcon,{}),onClick:()=>null===t||void 0===t?void 0:t(!e),css:rt,children:!e&&(0,m.Y)(i.A,{id:"r/fxMt",defaultMessage:"Assessments"})})})};var at=n(88464),it=n(77020);const lt=250,ct=(e,t=new Date)=>{const n=Math.max(0,Math.floor((t.getTime()-e)/1e3));let s=Math.floor(n/31536e3);return s>=1?(0,m.Y)(i.A,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:s}}):(s=Math.floor(n/2592e3),s>=1?(0,m.Y)(i.A,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:s}}):(s=Math.floor(n/86400),s>=1?(0,m.Y)(i.A,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:s}}):(s=Math.floor(n/3600),s>=1?(0,m.Y)(i.A,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:s}}):(s=Math.floor(n/60),s>=1?(0,m.Y)(i.A,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:s}}):(0,m.Y)(i.A,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:n}})))))},dt=({formValue:e,dataType:t,isFeedback:n})=>n?{feedback:{value:e}}:"json"===t?{expectation:{serialized_value:{value:String(e),serialization_format:"JSON_FORMAT"}}}:{expectation:{value:e}};var ut=n(39416);const pt=fetch;function mt(e){if(void 0!==e)return"string"===typeof e||e instanceof FormData||e instanceof Blob?e:JSON.stringify(e)}const gt=async(e,t="GET",n)=>{const s=await pt(e,{method:t,body:mt(n),headers:n?{"Content-Type":"application/json"}:{}});if(!s.ok){const e=(0,ut.a$)(s);if(e){try{const t=(await s.json()).message;e.message=null!==t&&void 0!==t?t:e.message}catch{}throw e}}return s.json()},ht=({payload:e})=>gt(`/ajax-api/3.0/mlflow/traces/${e.assessment.trace_id}/assessments`,"POST",e),ft=(0,r.createContext)({refetchTraceInfo:null}),xt=()=>(0,r.useContext)(ft),vt=({assessmentName:e,spanId:t,traceId:n,setExpanded:l})=>{const u=(0,at.A)(),{theme:p}=(0,o.u)(),[g,h]=(0,r.useState)(""),[f,x]=(0,r.useState)("feedback"),[v,b]=(0,r.useState)("boolean"),[Y,S]=(0,r.useState)(!0),[A,w]=(0,r.useState)(""),[T,M]=(0,r.useState)(null),{refetchTraceInfo:k}=xt(),{mutate:D,isLoading:I}=(0,it.n)({mutationFn:e=>ht({payload:e}),onSuccess:()=>{null===k||void 0===k||k()},onError:e=>{(0,c.ij)(u.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)}))},onSettled:()=>{l(!1)}}),C=!(0,d.isNil)(e),F=(0,r.useCallback)((async()=>{if("json"===v)try{JSON.parse(Y)}catch(o){return void M((0,m.Y)(i.A,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}))}const s=dt({formValue:Y,dataType:v,isFeedback:"feedback"===f}),r={assessment:{assessment_name:C?e:g,trace_id:n,source:{source_type:"HUMAN",source_id:(0,c.HW)()},span_id:t,rationale:A,...s}};await D(r)}),[v,Y,f,C,e,g,n,t,A,D]);return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:p.spacing.xs,marginTop:p.spacing.sm,border:`1px solid ${p.colors.border}`,padding:p.spacing.sm,borderRadius:p.borders.borderRadiusSm},""),children:[(0,m.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,m.FD)(a.SimpleSelect,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",value:f,disabled:I,onChange:e=>x(e.target.value),children:[(0,m.Y)(a.SimpleSelectOption,{value:"feedback",children:(0,m.Y)(i.A,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,m.Y)(a.SimpleSelectOption,{value:"expectation",children:(0,m.Y)(i.A,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginTop:p.spacing.xs},""),size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),C?(0,m.Y)(o.T.Text,{children:e}):(0,m.Y)(y.I,{componentId:"shared.model-trace-explorer.assessment-name-input",value:g,disabled:I,onKeyDown:e=>e.stopPropagation(),onChange:e=>h(e.target.value)}),(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginTop:p.spacing.xs},""),size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,m.FD)(a.SimpleSelect,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",value:v,disabled:I,onChange:e=>{b(e.target.value),M(null)},children:["expectation"===f&&(0,m.Y)(a.SimpleSelectOption,{value:"json",children:(0,m.Y)(i.A,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,m.Y)(a.SimpleSelectOption,{value:"string",children:(0,m.Y)(i.A,{id:"cBSSLp",defaultMessage:"String"})}),(0,m.Y)(a.SimpleSelectOption,{value:"boolean",children:(0,m.Y)(i.A,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,m.Y)(a.SimpleSelectOption,{value:"number",children:(0,m.Y)(i.A,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginTop:p.spacing.xs},""),size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"ms+6Z2",defaultMessage:"Value"})}),"json"===v&&(0,m.FD)(m.FK,{children:[(0,m.Y)(y.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(Y),autoSize:{minRows:1,maxRows:5},onKeyDown:e=>e.stopPropagation(),onChange:e=>{S(e.target.value),M(null)},validationState:T?"error":void 0,disabled:I}),T&&(0,m.Y)(a.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:T,type:"error"})]}),"string"===v&&(0,m.Y)(y.I,{componentId:"shared.model-trace-explorer.assessment-value-string-input",value:String(Y),onKeyDown:e=>e.stopPropagation(),onChange:e=>{S(e.target.value),M(null)},disabled:I,allowClear:!0}),"boolean"===v&&(0,m.FD)(a.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-value-boolean-input",name:"shared.model-trace-explorer.assessment-value-boolean-input",value:Y,disabled:I,onChange:e=>{S(e.target.value),M(null)},children:[(0,m.Y)(a.SegmentedControlButton,{value:!0,children:"True"}),(0,m.Y)(a.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===v&&(0,m.Y)(y.I,{componentId:"shared.model-trace-explorer.assessment-value-number-input",value:String(Y),onKeyDown:e=>e.stopPropagation(),onChange:e=>{S(e.target.value?Number(e.target.value):""),M(null)},type:"number",disabled:I,allowClear:!0}),(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginTop:p.spacing.xs},""),size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,m.Y)(y.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:A,autoSize:{minRows:1,maxRows:5},disabled:I,onKeyDown:e=>e.stopPropagation(),onChange:e=>w(e.target.value)}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:p.spacing.xs},""),children:[(0,m.Y)(o.B,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:I,onClick:()=>l(!1),children:(0,m.Y)(i.A,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,m.Y)(o.B,{css:(0,s.AH)({marginLeft:p.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:F,loading:I,children:(0,m.Y)(i.A,{id:"Me7xpG",defaultMessage:"Create"})})]})]})},yt=({title:e,assessmentName:t,spanId:n,traceId:s})=>{const[i,l]=(0,r.useState)(!1);return(0,m.FD)("div",{children:[(0,m.Y)(o.B,{size:"small",componentId:"shared.model-trace-explorer.add-new-assessment",icon:(0,m.Y)(a.PlusIcon,{}),onClick:()=>l(!0),children:e}),i&&(0,m.Y)(vt,{assessmentName:t,spanId:n,traceId:s,setExpanded:l})]})},bt=({assessment:e,setIsEditing:t,setShowDeleteModal:n})=>{const s="feedback"in e,r=(0,c.HW)(),d=(0,l.nX)(),u=r===e.source.source_id||s&&"HUMAN"!==e.source.source_type,p=d&&u&&t;return(0,m.FD)(a.DropdownMenu.Root,{children:[(0,m.Y)(a.DropdownMenu.Trigger,{asChild:!0,children:(0,m.Y)(o.B,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,m.Y)(a.OverflowIcon,{}),size:"small"})}),(0,m.FD)(a.DropdownMenu.Content,{minWidth:100,children:[p&&(0,m.FD)(a.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>null===t||void 0===t?void 0:t(!0),children:[(0,m.Y)(a.DropdownMenu.IconWrapper,{children:(0,m.Y)(a.PencilIcon,{})}),(0,m.Y)(i.A,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,m.FD)(a.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>n(!0),children:[(0,m.Y)(a.DropdownMenu.IconWrapper,{children:(0,m.Y)(a.TrashIcon,{})}),(0,m.Y)(i.A,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})},Yt=({assessment:e,isModalVisible:t,setIsModalVisible:n})=>{const s=(0,at.A)(),{refetchTraceInfo:o}=xt(),{mutate:a,isLoading:l}=(0,it.n)({mutationFn:()=>(({traceId:e,assessmentId:t})=>gt(`/ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`,"DELETE"))({traceId:e.trace_id,assessmentId:e.assessment_id}),onSuccess:()=>{null===o||void 0===o||o()},onError:e=>{(0,c.ij)(s.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)}))},onSettled:()=>{n(!1)}}),d=(0,r.useCallback)((async()=>{await a()}),[a]);return(0,m.Y)(Se.d,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:t,onOk:d,okButtonProps:{danger:!0,loading:l},okText:(0,m.Y)(i.A,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{n(!1)},cancelText:(0,m.Y)(i.A,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:l,title:(0,m.Y)(i.A,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,m.Y)(i.A,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})},St=({assessment:e,refetchTraceInfo:t,onSuccess:n,onError:s,onSettled:r})=>{const o=(0,at.A)(),{mutate:a,isLoading:i}=(0,it.n)({mutationFn:t=>(({traceId:e,assessmentId:t,payload:n})=>gt(`/ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`,"PATCH",n))({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t}),onError:e=>{(0,c.ij)(o.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===s||void 0===s||s(e)},onSuccess:()=>{null===t||void 0===t||t(),null===n||void 0===n||n()},onSettled:()=>{null===r||void 0===r||r()}});return{updateAssessmentMutation:a,isLoading:i}},At=({assessment:e,onSuccess:t,onSettled:n,onCancel:l})=>{const u="feedback"in e,p=(e=>"feedback"in e?e.feedback.value:"value"in e.expectation?e.expectation.value:e.expectation.serialized_value.value)(e),g=((e,t)=>{if("string"===typeof e){if(""===e)return"boolean";if(t)return"string";try{return JSON.parse(e),"json"}catch(n){return"string"}}return"boolean"===typeof e||"number"===typeof e?typeof e:"boolean"})(p,u),h=(e=>"string"===typeof e?e||null:"boolean"===typeof e||"number"===typeof e?e:null)(p),f=(0,c.HW)(),{theme:x}=(0,o.u)(),[v,b]=(0,r.useState)(g),[Y,S]=(0,r.useState)(h),[A,w]=(0,r.useState)(e.rationale),[T,M]=(0,r.useState)(null),{refetchTraceInfo:k}=xt(),{updateAssessmentMutation:D,isLoading:I}=St({assessment:e,refetchTraceInfo:k,onSuccess:t,onSettled:n}),{overrideAssessmentMutation:C,isLoading:F}=(({refetchTraceInfo:e,onSuccess:t,onError:n,onSettled:s})=>{const r=(0,at.A)(),{mutate:o,isLoading:a}=(0,it.n)({mutationFn:({oldAssessment:e,value:t,rationale:n})=>{const s={...e,...t,rationale:n,source:{source_id:(0,c.HW)(),source_type:"HUMAN"},overrides:e.assessment_id},r={assessment:(0,d.omit)(s,"assessment_id","create_time","last_update_time","overriddenAssessments")};return ht({payload:r})},onError:e=>{(0,c.ij)(r.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:()=>{null===e||void 0===e||e(),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{overrideAssessmentMutation:o,isLoading:a}})({refetchTraceInfo:k,onSuccess:t,onSettled:n}),H=I||F,N=(0,r.useCallback)((async()=>{if("json"===v)try{JSON.parse(Y)}catch(n){return void M((0,m.Y)(i.A,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}))}const t=dt({formValue:Y,dataType:v,isFeedback:u});if(f!==e.source.source_id&&u)await C({oldAssessment:e,value:t,...A?{rationale:A}:{}});else{const e={assessment:{...t,rationale:A},update_mask:(u?"feedback":"expectation")+",rationale"};await D(e)}}),[v,Y,u,f,e,A,D,C]);return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:x.spacing.xs,marginTop:x.spacing.sm,border:`1px solid ${x.colors.border}`,padding:x.spacing.sm,borderRadius:x.borders.borderRadiusSm},""),children:[(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,m.FD)(a.SimpleSelect,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:v,disabled:H,onChange:e=>{b(e.target.value),M(null)},children:[!u&&(0,m.Y)(a.SimpleSelectOption,{value:"json",children:(0,m.Y)(i.A,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,m.Y)(a.SimpleSelectOption,{value:"string",children:(0,m.Y)(i.A,{id:"cBSSLp",defaultMessage:"String"})}),(0,m.Y)(a.SimpleSelectOption,{value:"boolean",children:(0,m.Y)(i.A,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,m.Y)(a.SimpleSelectOption,{value:"number",children:(0,m.Y)(i.A,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"e2AObB",defaultMessage:"Value"})}),"json"===v&&(0,m.FD)(m.FK,{children:[(0,m.Y)(y.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(Y),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{S(e.target.value),M(null)},validationState:T?"error":void 0,disabled:H}),T&&(0,m.Y)(a.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:T,type:"error"})]}),"string"===v&&(0,m.Y)(y.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(Y),onKeyDown:e=>e.stopPropagation(),onChange:e=>{S(e.target.value),M(null)},disabled:H,allowClear:!0}),"boolean"===v&&(0,m.FD)(a.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:Y,disabled:H,onChange:e=>{S(e.target.value),M(null)},children:[(0,m.Y)(a.SegmentedControlButton,{value:!0,children:"True"}),(0,m.Y)(a.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===v&&(0,m.Y)(y.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(Y),onKeyDown:e=>e.stopPropagation(),onChange:e=>{S(e.target.value?Number(e.target.value):""),M(null)},type:"number",disabled:H,allowClear:!0}),(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginTop:x.spacing.xs},""),size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,m.Y)(y.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:A,autoSize:{minRows:1,maxRows:5},disabled:H,onKeyDown:e=>e.stopPropagation(),onChange:e=>w(e.target.value)}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:x.spacing.xs},""),children:[(0,m.Y)(o.B,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:H,onClick:l,children:(0,m.Y)(i.A,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,m.Y)(o.B,{css:(0,s.AH)({marginLeft:x.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:N,loading:H,children:(0,m.Y)(i.A,{id:"M+iC03",defaultMessage:"Save"})})]})]})};var wt={name:"1gyqtrv",styles:"width:min-content;max-width:100%"},Tt={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const Mt=({objectKey:e,value:t})=>{const{theme:n}=(0,o.u)(),r=(0,d.isString)(t)?t:JSON.stringify(t);return(0,m.Y)(Se.T,{content:r,componentId:"shared.model-trace-explorer.expectation-value-preview-tooltip",children:(0,m.Y)(a.Tag,{color:"indigo",componentId:"shared.model-trace-explorer.expectation-array-item-tag",css:wt,children:(0,m.FD)(o.T.Text,{css:Tt,children:[e&&(0,m.FD)(o.T.Text,{bold:!0,css:(0,s.AH)({marginRight:n.spacing.xs},""),children:[e,":"]}),r]})})})},kt=({node:e})=>{var t;const{theme:n}=(0,o.u)(),{setSelectedNode:r,setActiveView:a,setShowTimelineTreeGantt:i}=H(),l=(0,c.N7)(e)>0;return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",marginRight:n.spacing.xs,gap:n.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:l?n.colors.actionDangerDefaultTextDefault:n.colors.actionDefaultTextDefault,cursor:"pointer"}},""),onClick:()=>{r(e),a("detail"),i(!1)},children:[(0,m.Y)(Ae.P,{hasException:l,type:(0,c.tC)(null!==(t=e.type)&&void 0!==t?t:z.UG.UNKNOWN)}),(0,m.Y)(o.T.Text,{color:l?"error":"primary",css:(0,s.AH)({marginLeft:n.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},""),children:e.title})]})};const Dt=e=>Array.isArray(e)?e.map(((e,t)=>(0,m.Y)(Mt,{value:e},t))):(0,d.isObject)(e)?Object.entries(e).map((([e,t])=>(0,m.Y)(Mt,{objectKey:e,value:t},e))):(0,m.Y)(Mt,{value:e});var It={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},Ct={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const Ft=({expectation:e})=>{const{theme:t}=(0,o.u)(),[n,a]=(0,r.useState)(!1),[l,c]=(0,r.useState)(!1),{nodeMap:d,activeView:u}=H(),p=e.span_id?d[e.span_id]:null,g="summary"===u&&p,h=(e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(t){return e.serialized_value.value}})(e.expectation);return(0,m.FD)("div",{css:(0,s.AH)({padding:t.spacing.sm+t.spacing.xs,paddingTop:t.spacing.sm,border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,m.FD)("div",{css:It,children:[(0,m.Y)(o.T.Text,{bold:!0,css:Ct,children:e.assessment_name}),(0,m.Y)(bt,{assessment:e,setIsEditing:a,setShowDeleteModal:c}),(0,m.Y)(Yt,{assessment:e,isModalVisible:l,setIsModalVisible:c})]}),n?(0,m.Y)(At,{assessment:e,onSuccess:()=>a(!1),onCancel:()=>a(!1)}):Dt(h),g&&(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,m.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"+hQbnS",defaultMessage:"Span"})}),(0,m.Y)(kt,{node:p})]})]})};var Ht={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const Nt=({jsonValue:e})=>{const{theme:t}=(0,o.u)();if(!e||'""'===e)return null;let n;try{n=JSON.parse(e)}catch(c){n=e}let r="default",l=JSON.stringify(n,null,2);return"yes"===n?(r="lime",l=(0,m.FD)(m.FK,{children:[(0,m.Y)(a.CheckCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,m.Y)(i.A,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===n?(r="coral",l=(0,m.FD)(m.FK,{children:[(0,m.Y)(a.XCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,m.Y)(i.A,{id:"M8cEQy",defaultMessage:"No"})]})):"string"===typeof n?l=n:null===n?(r="coral",l=(0,m.FD)(m.FK,{children:[(0,m.Y)(o.l,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,m.Y)(i.A,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===n?(r="lime",l=(0,m.FD)(m.FK,{children:[(0,m.Y)(a.CheckCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,m.Y)(i.A,{id:"hWHLjo",defaultMessage:"True"})]})):!1===n&&(r="coral",l=(0,m.FD)(m.FK,{children:[(0,m.Y)(a.XCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,m.Y)(i.A,{id:"4U/RVz",defaultMessage:"False"})]})),(0,m.Y)(Se.T,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:l,children:(0,m.Y)(a.Tag,{css:(0,s.AH)({display:"inline-flex",maxWidth:"100%",minWidth:t.spacing.md,marginRight:0},""),componentId:"shared.model-trace-explorer.assesment-value-tag",color:r,children:(0,m.Y)("span",{css:Ht,children:l})})})},Rt=({source:e})=>{const{theme:t}=(0,o.u)();return(0,m.Y)(Se.T,{componentId:"shared.model-trace-explorer.assessment-source-name",content:e.source_id,children:(0,m.Y)("span",{css:(0,s.AH)({flexShrink:1,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",marginLeft:t.spacing.sm,minWidth:t.spacing.md},""),children:(0,m.Y)(o.T.Text,{children:(0,m.Y)("span",{css:(0,s.AH)({color:t.colors.blue500},""),children:e.source_id})})})})};var _t={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};const zt=({renderConnector:e=!0,assessment:t,setIsEditing:n})=>{const{theme:i}=(0,o.u)(),[l,c]=(0,r.useState)(!1),d=(e=>{switch(e.source_type){case"HUMAN":return a.UserIcon;case"LLM_JUDGE":return a.SparkleIcon;default:return a.CodeIcon}})(t.source);return(0,m.FD)("div",{css:_t,children:[e&&(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",left:-1,top:0,width:10,height:i.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:i.borders.borderRadiusMd,borderBottom:`1px solid ${i.colors.border}`,borderLeft:`1px solid ${i.colors.border}`},"")}),(0,m.Y)(d,{size:i.typography.fontSizeSm,css:(0,s.AH)({padding:2,backgroundColor:i.colors.actionIconBackgroundHover,borderRadius:i.borders.borderRadiusFull},"")}),(0,m.Y)(Rt,{source:t.source}),(0,m.FD)("div",{css:(0,s.AH)({marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:i.spacing.xs},""),children:[t.last_update_time&&(0,m.Y)(o.T.Text,{color:"secondary",size:"sm",css:(0,s.AH)({marginLeft:i.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},""),children:ct(new Date(t.last_update_time))}),(0,m.Y)(bt,{assessment:t,setIsEditing:n,setShowDeleteModal:c}),(0,m.Y)(Yt,{assessment:t,isModalVisible:l,setIsModalVisible:c})]})]})},Et=({error:e})=>{const{theme:t}=(0,o.u)(),[n,l]=(0,r.useState)(!1);return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,m.Y)(a.Alert,{type:"error",closable:!1,message:e.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,m.Y)("span",{children:e.error_message}),e.stack_trace&&(0,m.Y)(o.T.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>l(!0),children:(0,m.Y)(i.A,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),e.stack_trace&&(0,m.Y)(Se.d,{title:(0,m.Y)(i.A,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:n,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>l(!1),children:(0,m.Y)(ve,{data:JSON.stringify(e.stack_trace),title:"",initialRenderMode:z.cC.TEXT})})]})};var Bt={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const Ot=({feedback:e})=>{const{theme:t}=(0,o.u)(),n=e.feedback.value;return(0,m.FD)("div",{css:Bt,children:[(0,m.Y)(zt,{renderConnector:!1,assessment:e}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,marginLeft:10,paddingLeft:t.spacing.md,paddingTop:t.spacing.sm,paddingBottom:t.spacing.md,paddingRight:t.spacing.lg,borderLeft:`1px solid ${t.colors.border}`},""),children:[(0,d.isNil)(e.feedback.error)?(0,m.FD)(m.FK,{children:[(0,m.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,m.Y)("div",{children:(0,m.Y)(Nt,{jsonValue:JSON.stringify(n)})})]}):(0,m.Y)(Et,{error:e.feedback.error}),e.rationale&&(0,m.FD)(m.FK,{children:[(0,m.Y)(o.T.Text,{size:"sm",color:"secondary",css:(0,s.AH)({marginTop:t.spacing.xs},""),children:(0,m.Y)(i.A,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,m.Y)(Q,{children:e.rationale})]})]})]})},jt=({isModalVisible:e,setIsModalVisible:t,feedback:n})=>{const s=(0,r.useMemo)((()=>(e=>{const t=new Set,n=[];let s=e;for(;s&&!t.has(s.assessment_id);)t.add(s.assessment_id),n.push(s),s=s.overriddenAssessment;return n})(n)),[n]);return(0,m.Y)(Se.d,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:e,footer:null,onCancel:()=>{t(!1)},title:(0,m.Y)(i.A,{id:"n6SrIn",defaultMessage:"Edit history"}),children:s.map((e=>"feedback"in e?(0,m.Y)(Ot,{feedback:e},e.assessment_id):null))})};var Lt={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"},Kt={name:"16mcpms",styles:"& > div:last-of-type{margin-bottom:0;}"};const $t=({feedback:e})=>{const[t,n]=(0,r.useState)(!1),{theme:a}=(0,o.u)(),{nodeMap:l,activeView:c}=H(),u=e.feedback.value,p=e.span_id?l[e.span_id]:null,g="summary"===c&&p;return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm,marginLeft:a.spacing.lg},""),children:[!(0,d.isNil)(e.feedback.error)&&(0,m.Y)(Et,{error:e.feedback.error}),g&&(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:a.spacing.xs},""),children:[(0,m.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"+hQbnS",defaultMessage:"Span"})}),(0,m.Y)(kt,{node:p})]}),(0,d.isNil)(e.feedback.error)&&(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:a.spacing.xs},""),children:[(0,m.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",gap:a.spacing.xs},""),children:[(0,m.Y)(Nt,{jsonValue:JSON.stringify(u)}),e.overriddenAssessment&&(0,m.FD)(m.FK,{children:[(0,m.Y)("span",{onClick:()=>n(!0),children:(0,m.Y)(o.T.Text,{css:Lt,color:"secondary",children:(0,m.Y)(i.A,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,m.Y)(jt,{isModalVisible:t,setIsModalVisible:n,feedback:e})]})]})]}),e.rationale&&(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:a.spacing.xs},""),children:[(0,m.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,m.Y)(i.A,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,m.Y)("div",{css:Kt,children:(0,m.Y)(Q,{children:e.rationale})})]})]})},Pt=({feedback:e})=>{const{theme:t}=(0,o.u)(),[n,a]=(0,r.useState)(!1);return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,paddingLeft:t.spacing.lg/2,marginLeft:t.spacing.lg/2,paddingTop:t.spacing.sm,paddingBottom:t.spacing.sm,borderLeft:`1px solid ${t.colors.border}`,position:"relative"},""),children:[(0,m.Y)(zt,{assessment:e,setIsEditing:a}),n?(0,m.Y)(At,{assessment:e,onSuccess:()=>a(!1),onCancel:()=>a(!1)}):(0,m.Y)($t,{feedback:e})]})};const Wt=e=>{const t={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,m.Y)(a.UserIcon,{css:t});case"LLM_JUDGE":return(0,m.Y)(a.SparkleIcon,{css:t});case"CODE":return(0,m.Y)(a.CodeIcon,{css:t});default:return null}};var Vt={name:"ti75j2",styles:"margin:0"};const Ut=({feedbacks:e})=>{const{theme:t}=(0,o.u)();if(e.length<2)return null;const n=(0,d.countBy)(e,(e=>e.source.source_type));return(0,m.Y)("div",{css:(0,s.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center",marginLeft:t.spacing.xs},""),children:Object.entries(n).map((([e,n])=>(0,m.Y)(a.Tag,{componentId:`shared.model-trace-explorer.feedback-source-count-${e}`,css:Vt,children:(0,m.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[Wt(e),(0,m.Y)(o.T.Text,{children:n})]})},e)))})};var Jt={name:"1fttcpj",styles:"display:flex;flex-direction:column"},qt={name:"ozd7xs",styles:"flex-shrink:0"},Gt={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const Zt=({jsonValue:e,feedbacks:t})=>{const{theme:n}=(0,o.u)(),[i,l]=(0,r.useState)(!1);return(0,m.FD)("div",{css:Jt,children:[(0,m.FD)("div",{css:(0,s.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center"},""),children:[(0,m.Y)(o.B,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:qt,size:"small",icon:i?(0,m.Y)(a.ChevronDownIcon,{}):(0,m.Y)(o.q,{}),onClick:()=>l(!i)}),(0,m.Y)(Nt,{jsonValue:e}),(0,m.Y)(Ut,{feedbacks:t})]}),i&&(0,m.Y)("div",{css:Gt,children:t.map((e=>!1===(null===e||void 0===e?void 0:e.valid)?null:(0,m.Y)(Pt,{feedback:e},e.assessment_id)))})]})};var Xt={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},Qt={name:"ozd7xs",styles:"flex-shrink:0"};const en=({name:e,valuesMap:t,traceId:n,activeSpanId:i})=>{const{theme:l}=(0,o.u)(),c=(e=>{const t=e.split("/");return 1===t.length?e:2===t.length?t[1]:t.slice(2).join("/")})(e),[u,p]=(0,r.useState)(!1),g=Object.values(t).flat().some((e=>!(0,d.isNil)(e.feedback.error)));return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",marginBottom:l.spacing.sm,border:`1px solid ${l.colors.border}`,borderRadius:l.borders.borderRadiusMd,padding:l.spacing.sm+l.spacing.xs,paddingTop:l.spacing.sm,gap:l.spacing.sm},""),children:[(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:l.spacing.sm},""),children:[(0,m.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:l.spacing.sm,flex:1,minWidth:0},""),children:[(0,m.Y)(o.T.Text,{bold:!0,css:Xt,children:c}),g&&(0,m.Y)(o.l,{css:Qt,color:"danger"})]}),(0,m.Y)(Se.T,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,m.Y)(o.B,{componentId:"shared.model-trace-explorer.add-feedback",css:(0,s.AH)({flexShrink:0,marginRight:-l.spacing.xs},""),size:"small",icon:(0,m.Y)(a.PlusIcon,{}),onClick:()=>p(!0)})})]}),Object.entries(t).map((([e,t])=>(0,m.Y)(Zt,{jsonValue:e,feedbacks:t},e))),u&&(0,m.Y)(vt,{assessmentName:e,spanId:i,traceId:n,setExpanded:p})]})};var tn={name:"4c6dm7",styles:"display:flex;flex-direction:row;justify-content:space-between"};const nn=({assessments:e,traceId:t,activeSpanId:n})=>{const{theme:a}=(0,o.u)(),{setAssessmentsPaneExpanded:l}=H(),[c,u]=(0,r.useMemo)((()=>(0,d.partition)(e,(e=>"feedback"in e))),[e]),p=(0,r.useMemo)((()=>(e=>{const t={};return e.forEach((e=>{if(!1===e.valid)return;let n=null;""!==e.feedback.value&&(n=JSON.stringify(e.feedback.value));const{assessment_name:s}=e;t[s]||(t[s]={});const r=t[s];(0,d.isNil)(n)||(r[n]||(r[n]=[]),r[n].push(e))})),Object.entries(t).toSorted((([e],[t])=>e.localeCompare(t)))})(c)),[c]),g=u.toSorted(((e,t)=>e.assessment_name.localeCompare(t.assessment_name)));return(0,m.FD)("div",{"data-testid":"assessments-pane",css:(0,s.AH)({display:"flex",flexDirection:"column",padding:a.spacing.sm,paddingTop:a.spacing.xs,height:"100%",borderLeft:`1px solid ${a.colors.border}`,overflowY:"scroll",minWidth:lt,width:"100%",boxSizing:"border-box"},""),children:[(0,m.FD)("div",{css:tn,children:[(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginBottom:a.spacing.sm},""),bold:!0,children:(0,m.Y)(i.A,{id:"++Ydlz",defaultMessage:"Assessments"})}),l&&(0,m.Y)(Se.T,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,m.Y)(i.A,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,m.Y)(o.B,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,m.Y)(o.C,{}),onClick:()=>l(!1)})})]}),p.map((([e,s])=>(0,m.Y)(en,{name:e,valuesMap:s,traceId:t,activeSpanId:n},e))),g.length>0&&(0,m.FD)(m.FK,{children:[(0,m.Y)(o.T.Text,{color:"secondary",css:(0,s.AH)({marginBottom:a.spacing.sm},""),children:(0,m.Y)(i.A,{id:"UbXw8O",defaultMessage:"Expectations"})}),(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm,marginBottom:a.spacing.sm},""),children:g.map((e=>(0,m.Y)(Ft,{expectation:e},e.assessment_id)))})]}),(0,m.Y)(yt,{title:"Add new assessment",spanId:n,traceId:t})]})};function sn({activeSpan:e,searchFilter:t,activeMatch:n,activeTab:l,setActiveTab:u}){const{theme:p}=(0,o.u)(),[g,h]=(0,r.useState)(500),f={flex:1,marginTop:-p.spacing.md,overflowY:"auto"},{assessmentsPaneExpanded:v,assessmentsPaneEnabled:y}=H();if((0,d.isNil)(e))return(0,m.Y)(a.Empty,{description:"Please select a span to view more information"});const b=(0,c.N7)(e),Y=b>0,S=(0,m.FD)(a.Tabs.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${p.colors.border}`,minWidth:200,position:"relative"},""),value:l,onValueChange:e=>u(e),children:[(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",right:v?p.spacing.xs:p.spacing.md,top:p.spacing.xs},""),children:(0,m.Y)(ot,{})}),(0,m.FD)(a.Tabs.List,{css:(0,s.AH)({padding:0,paddingLeft:p.spacing.md,paddingRight:p.spacing.sm,boxSizing:"border-box",width:"100%"},""),children:[e.chatMessages&&(0,m.Y)(a.Tabs.Trigger,{value:"chat",children:(0,m.Y)(i.A,{id:"BkDhmT",defaultMessage:"Chat"})}),(0,m.Y)(a.Tabs.Trigger,{value:"content",children:(0,m.Y)(i.A,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,m.Y)(a.Tabs.Trigger,{value:"attributes",children:"Attributes"}),(0,m.FD)(a.Tabs.Trigger,{value:"events",children:["Events ",Y&&(0,m.Y)(nt,{count:b})]})]}),e.chatMessages&&(0,m.Y)(a.Tabs.Content,{css:f,value:"chat",children:(0,m.Y)(ze,{chatMessages:e.chatMessages,chatTools:e.chatTools})}),(0,m.Y)(a.Tabs.Content,{css:f,value:"content",children:(0,m.Y)(et,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,m.Y)(a.Tabs.Content,{css:f,value:"attributes",children:(0,m.Y)(ye,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,m.Y)(a.Tabs.Content,{css:f,value:"events",children:(0,m.Y)(tt,{activeSpan:e,searchFilter:t,activeMatch:n})})]});return y&&v?(0,m.Y)(x,{initialRatio:.7,paneWidth:g,setPaneWidth:h,leftChild:S,leftMinWidth:250,rightChild:(0,m.Y)(nn,{assessments:e.assessments,traceId:e.traceId,activeSpanId:e.parentId?String(e.key):void 0}),rightMinWidth:lt}):S}const rn=r.memo(sn),on=({spanFilterState:e,setSpanFilterState:t})=>{const{theme:n}=(0,o.u)();return(0,m.FD)(o.ax.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,m.Y)(o.ax.Trigger,{asChild:!0,children:(0,m.Y)(o.B,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,m.Y)(a.FilterIcon,{}),size:"small",children:(0,m.Y)(i.A,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,m.Y)(o.ax.Content,{align:"start",children:(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingBottom:n.spacing.xs},""),children:[(0,m.Y)(o.T.Text,{bold:!0,children:(0,m.Y)(i.A,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,m.Y)(o.T.Text,{color:"secondary",children:(0,m.Y)(i.A,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(e.spanTypeDisplayState).map((([r,i])=>{const l=(0,m.Y)(Ae.P,{type:(0,c.tC)(r)});return(0,m.FD)(a.Checkbox,{componentId:`shared.model-trace-explorer.toggle-span-filter_${r}-${!i}`,style:{width:"100%"},isChecked:i,onChange:()=>t({...e,spanTypeDisplayState:{...e.spanTypeDisplayState,[r]:!i}}),children:[l,(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),children:(0,c.LS)(r)})]},r)})),(0,m.Y)(o.T.Text,{color:"secondary",children:(0,m.Y)(i.A,{id:"SrV58C",defaultMessage:"Settings"})}),(0,m.FD)(a.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showParents}`,style:{width:"100%"},isChecked:e.showParents,onChange:()=>t({...e,showParents:!e.showParents}),children:[(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,m.Y)(i.A,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,m.Y)(a.InfoTooltip,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,m.Y)(i.A,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,m.FD)(a.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showExceptions}`,style:{width:"100%"},isChecked:e.showExceptions,onChange:()=>t({...e,showExceptions:!e.showExceptions}),children:[(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,m.Y)(i.A,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,m.Y)(a.InfoTooltip,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,m.Y)(i.A,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},an=({showTimelineInfo:e,setShowTimelineInfo:t,spanFilterState:n,setSpanFilterState:r})=>{const{theme:l}=(0,o.u)();return(0,m.FD)("div",{css:(0,s.AH)({padding:`${l.spacing.xs}px ${l.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${l.colors.border}`,boxSizing:"border-box",paddingLeft:l.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},""),children:[(0,m.Y)(o.T.Text,{bold:!0,children:(0,m.Y)(i.A,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:l.spacing.sm},""),children:[(0,m.Y)(on,{spanFilterState:n,setSpanFilterState:r}),(0,m.FD)(a.SegmentedControlGroup,{name:"size-story",value:e,onChange:e=>{t(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,m.Y)(a.SegmentedControlButton,{"data-testid":"hide-timeline-info-button",icon:(0,m.Y)(Se.T,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,m.Y)(i.A,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,m.Y)(a.ListBorderIcon,{})}),value:!1}),(0,m.Y)(a.SegmentedControlButton,{"data-testid":"show-timeline-info-button",icon:(0,m.Y)(Se.T,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,m.Y)(i.A,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,m.Y)(a.BarsAscendingVerticalIcon,{})}),value:!0})]})]})]})},ln=({active:e})=>{const{theme:t}=(0,o.u)(),n=e?t.colors.blue500:t.colors.border;return(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",left:"100%",bottom:0,width:9,height:t.spacing.md,boxSizing:"border-box",borderTopRightRadius:t.borders.borderRadiusMd,borderTop:`1px solid ${n}`,borderRight:`1px solid ${n}`,zIndex:T},"")})},cn=({active:e})=>{const{theme:t}=(0,o.u)(),n=e?t.colors.blue500:t.colors.border;return(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",left:"50%",top:0,width:8,height:t.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:t.borders.borderRadiusMd,borderBottom:`1px solid ${n}`,borderLeft:`1px solid ${n}`,zIndex:e?w:T},"")})},dn=({active:e})=>{const{theme:t}=(0,o.u)(),n=e?t.colors.blue500:t.colors.border;return(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",width:8,left:"50%",height:32,borderLeft:`1px solid ${n}`,boxSizing:"border-box",zIndex:e?w:T},"")})},un=({isActiveSpan:e,isInActiveChain:t,linesToRender:n,hasChildren:r,isExpanded:o})=>0===n.length?(0,m.Y)("div",{css:(0,s.AH)({width:0,height:32,boxSizing:"border-box",position:"relative"},""),children:r&&(0,m.Y)(ln,{active:t&&!e})}):(0,m.Y)(m.FK,{children:n.map((({shouldRender:a,isActive:i},l)=>(0,m.FD)("div",{css:(0,s.AH)({width:16,height:32,boxSizing:"border-box",position:"relative"},""),children:[a&&(0,m.Y)(dn,{active:i}),l===n.length-1&&(0,m.FD)(m.FK,{children:[(0,m.Y)(cn,{active:t}),r&&o&&(0,m.Y)(ln,{active:t&&!e})]})]},l)))});var pn={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const mn=({span:e,children:t})=>{var n;const{theme:r}=(0,o.u)(),a=(0,c.tC)(null!==(n=e.type)&&void 0!==n?n:z.UG.UNKNOWN),l=r.isDarkMode?r.colors.grey800:r.colors.grey100,d=r.isDarkMode?r.colors.grey500:r.colors.grey350;return(0,m.Y)(Se.T,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,m.FD)("div",{css:pn,children:[(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:r.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},""),children:[(0,m.Y)(Ae.P,{type:a,isInTooltip:!0}),(0,m.Y)("span",{css:(0,s.AH)({color:l},""),children:e.title}),(0,m.Y)("span",{css:(0,s.AH)({marginLeft:r.spacing.xs,color:d,fontSize:r.typography.fontSizeSm},""),children:D(e.end-e.start)})]}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",color:l},""),children:[(0,m.Y)(i.A,{id:"YV6xFB",defaultMessage:"Start:"})," ",D(e.start)," | ",(0,m.Y)(i.A,{id:"q90jVU",defaultMessage:"End:"})," ",D(e.end)]})]}),side:"right",maxWidth:700,children:t})};var gn={name:"18mz9c1",styles:"display:flex;flex-direction:row;align-items:center;overflow:hidden;flex:1"},hn={name:"adzntw",styles:"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1"};const fn=({node:e,selectedKey:t,expandedKeys:n,setExpandedKeys:r,traceStartTime:i,traceEndTime:l,onSelect:d,linesToRender:u})=>{var p,g;const h=n.has(e.key),{theme:f}=(0,o.u)(),x=(null!==(p=e.children)&&void 0!==p?p:[]).length>0,{setAssessmentsPaneExpanded:v}=H(),y=t===e.key,b=I(e,String(t)),Y=b>-1,S=(0,c.N7)(e)>0,A=y?f.colors.actionDefaultBackgroundHover:"transparent";return(0,m.FD)(m.FK,{children:[(0,m.Y)(mn,{span:e,children:(0,m.Y)("div",{"data-testid":`timeline-tree-node-${e.key}`,css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:A,":hover":{backgroundColor:f.colors.actionDefaultBackgroundHover},":active":{backgroundColor:f.colors.actionDefaultBackgroundPress}},""),onClick:()=>{null===d||void 0===d||d(e)},children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${f.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},""),children:(0,m.FD)("div",{css:gn,children:[x?(0,m.Y)(o.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:f.spacing.xs},""),icon:h?(0,m.Y)(a.ChevronDownIcon,{}):(0,m.Y)(o.q,{}),onClick:t=>{t.stopPropagation();const s=new Set(n);h?s.delete(e.key):s.add(e.key),r(s)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,m.Y)("div",{css:(0,s.AH)({width:24,marginRight:f.spacing.xs},"")}),(0,m.Y)(un,{isActiveSpan:y,isInActiveChain:Y,linesToRender:u,hasChildren:x,isExpanded:h}),(0,m.Y)("span",{css:(0,s.AH)({flexShrink:0,marginRight:f.spacing.xs,borderRadius:f.borders.borderRadiusSm,border:`1px solid ${b>-1?f.colors.blue500:f.colors.backgroundSecondary}`,zIndex:w},""),children:e.icon}),(0,m.Y)(o.T.Text,{color:S?"error":"primary",css:hn,children:e.title}),e.assessments.length>0&&(0,m.FD)(a.Tag,{color:"indigo","data-testid":`assessment-tag-${e.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:(0,s.AH)({margin:0,borderRadius:f.borders.borderRadiusSm},""),onClick:()=>null===v||void 0===v?void 0:v(!0),children:[(0,m.Y)(a.GavelIcon,{}),(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginLeft:f.spacing.xs},""),children:e.assessments.length})]})]})})})}),h&&(null===(g=e.children)||void 0===g?void 0:g.map(((s,o)=>{var a,c;return(0,m.Y)(fn,{node:s,expandedKeys:n,setExpandedKeys:r,selectedKey:t,traceStartTime:i,traceEndTime:l,onSelect:d,linesToRender:u.concat({shouldRender:o<(null!==(a=null===(c=e.children)||void 0===c?void 0:c.length)&&void 0!==a?a:0)-1,isActive:o<b})},s.key)})))]})};var xn={name:"1j2qjqs",styles:"flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"};const vn=({node:e,selectedKey:t,leftOffset:n,width:i,onSelect:l,expandedKeys:c,setExpandedKeys:d})=>{var u;const{theme:p}=(0,o.u)(),g=(0,r.useRef)(null),h=(0,r.useRef)(null),f=t===e.key?p.colors.actionDefaultBackgroundHover:"transparent",x=(null!==(u=e.children)&&void 0!==u?u:[]).length>0,v=c.has(e.key);return(0,r.useLayoutEffect)((()=>{if(!g.current||!h.current)return;Math.max(g.current.offsetWidth,h.current.offsetWidth)<i-p.spacing.sm?(g.current.style.display="inline",h.current.style.display="none"):(g.current.style.display="none",h.current.style.display="inline")}),[p.spacing.sm,i]),(0,m.Y)(mn,{span:e,children:(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:p.spacing.xs,paddingRight:p.spacing.sm,paddingTop:p.spacing.xs,paddingBottom:p.spacing.xs,backgroundColor:f,alignItems:"center",":hover":{backgroundColor:p.colors.actionDefaultBackgroundHover},":active":{backgroundColor:p.colors.actionDefaultBackgroundPress},zIndex:w},""),onClick:()=>null===l||void 0===l?void 0:l(e),children:[x?(0,m.Y)(o.B,{size:"small","data-testid":`toggle-timeline-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:p.spacing.xs},""),icon:v?(0,m.Y)(a.ChevronDownIcon,{}):(0,m.Y)(o.q,{}),onClick:t=>{t.stopPropagation();const n=new Set(c);v?n.delete(e.key):n.add(e.key),d(n)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,m.Y)("div",{css:(0,s.AH)({width:24,marginRight:p.spacing.xs},"")}),(0,m.Y)("div",{css:(0,s.AH)({width:n,flexShrink:0},"")}),(0,m.Y)("div",{css:(0,s.AH)({position:"relative",width:i,height:p.typography.lineHeightBase,backgroundColor:p.colors.blue600,borderRadius:p.borders.borderRadiusSm,flexShrink:0},""),children:(0,m.Y)(o.T.Text,{children:(0,m.Y)("span",{ref:g,css:(0,s.AH)({marginLeft:p.spacing.xs,color:p.colors.white,display:"none"},""),children:e.title})})}),(0,m.FD)("div",{css:xn,children:[(0,m.Y)(o.T.Text,{children:(0,m.Y)("span",{ref:h,css:(0,s.AH)({marginLeft:p.spacing.xs,color:p.colors.textPrimary},""),children:e.title})}),(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginLeft:p.spacing.xs},""),color:"secondary",children:D(e.end-e.start)})]})]},e.key)})};var yn={name:"1c2ejnx",styles:"display:flex;flex-direction:column;position:relative;box-sizing:border-box"},bn={name:"bjn8wh",styles:"position:relative"},Yn={name:"xyyuvf",styles:"position:absolute;height:100%;width:100%"};const Sn=({nodes:e,selectedKey:t,onSelect:n,traceStartTime:a,traceEndTime:i,expandedKeys:l,setExpandedKeys:c})=>{var d,u;const{theme:g}=(0,o.u)(),h=(0,r.useRef)(null),f=null!==(d=null===(u=(0,p.wY)({ref:h}))||void 0===u?void 0:u.width)&&void 0!==d?d:0,x=(0,r.useMemo)((()=>function(e,t,n,s=60){const r=t-e;if(r<=0||n<=0)return[];const o=Math.floor(n/s);if(o<1)return[];const a=r/o,i=Math.pow(10,Math.floor(Math.log10(a))),l=a/i;let c;c=l<=1?1:l<=2?2:l<=5?5:10;const d=c*i,u=t+2*d,p=[];for(let m=Math.ceil(e/d)*d;m<=u;m+=d)p.push(Number(m.toFixed(10)));return p}(a,i,f)),[i,a,f]),v=Math.min(...x),y=(x[x.length-1]+x[x.length-2])/2,b=x.slice(0,-1),Y=e=>function(e,t,n,s){return(e-t)/(n-t)*s}(e,v,y,f);return(0,m.FD)("div",{css:yn,children:[(0,m.Y)("div",{ref:h,css:(0,s.AH)({display:"flex",width:"100%",flexDirection:"row",height:g.typography.lineHeightBase,paddingLeft:32,paddingRight:g.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:g.colors.backgroundPrimary,zIndex:A},""),children:(0,m.Y)("div",{"data-testid":"time-marker-area",css:bn,children:b.map((e=>(0,m.Y)(o.T.Text,{css:(0,s.AH)({position:"absolute",transform:"translateX(-50%)",left:Y(e),whiteSpace:"nowrap"},""),children:D(e)},e)))})}),(0,m.Y)("div",{css:(0,s.AH)({flex:1,pointerEvents:"none",zIndex:T},""),children:(0,m.Y)("div",{css:Yn,children:b.map((e=>(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",left:Y(e)+32,borderRight:`1px solid ${g.colors.border}`,height:"100%"},"")},e)))})}),e.map((e=>{const s=Y(e.start),r=Y(e.end)-s;return(0,m.Y)(vn,{selectedKey:t,onSelect:n,node:e,leftOffset:s,width:r,expandedKeys:l,setExpandedKeys:c},e.key)}))]})};var An={name:"1v8q7xf",styles:"flex:1;overflow:auto;min-height:100%;box-sizing:border-box;display:flex;flex-direction:column"},wn={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},Tn={name:"13ku56z",styles:"display:flex;flex-direction:column;height:100%"},Mn={name:"9nf0yq",styles:"flex:1;overflow-y:auto;display:flex"};const kn=({rootNodes:e,selectedNode:t,setSelectedNode:n,traceStartTime:a,traceEndTime:l,expandedKeys:c,setExpandedKeys:d,spanFilterState:u,setSpanFilterState:p,className:g})=>{const{theme:h}=(0,o.u)(),f=(0,r.useCallback)((e=>{null===n||void 0===n||n(e)}),[n]),{showTimelineTreeGantt:x,setShowTimelineTreeGantt:v}=H(),y=(0,r.useMemo)((()=>((e,t)=>{const n=[],s=e=>{var r;e&&(n.push(e),t.has(e.key)&&(null===(r=e.children)||void 0===r||r.forEach(s)))};return e.forEach(s),n})(e,c)),[e,c]),b=(0,r.useMemo)((()=>{var n;return(0,m.Y)("div",{css:An,children:x?(0,m.Y)(Sn,{nodes:y,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",onSelect:f,traceStartTime:a,traceEndTime:l,expandedKeys:c,setExpandedKeys:d}):e.map((e=>{var n;return(0,m.Y)(fn,{node:e,expandedKeys:c,setExpandedKeys:d,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",traceStartTime:a,traceEndTime:l,onSelect:f,linesToRender:[]},e.key)}))})}),[x,y,null===t||void 0===t?void 0:t.key,f,a,l,e,c,d]);return(0,m.Y)("div",{css:(0,s.AH)({height:"100%",borderRadius:h.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),className:g,children:(0,m.Y)("div",{css:wn,children:(0,m.FD)("div",{css:Tn,children:[(0,m.Y)(an,{showTimelineInfo:x,setShowTimelineInfo:v,spanFilterState:u,setSpanFilterState:p}),e.length>0?(0,m.Y)("div",{css:Mn,children:b}):(0,m.Y)("div",{css:(0,s.AH)({flex:1,display:"flex",justifyContent:"center",padding:h.spacing.md,paddingTop:h.spacing.lg},""),children:(0,m.Y)(i.A,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})};var Dn={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},In={name:"82a6rk",styles:"flex:1"};const Cn=({modelTrace:e,className:t,selectedSpanId:n,onSelectSpan:a})=>{var i,l;const{theme:c}=(0,o.u)(),u=window.innerWidth<=768?.33:.25,p=(0,r.useRef)(null),[g,h]=(0,r.useState)(500),{rootNode:f,selectedNode:v,setSelectedNode:y,activeTab:b,setActiveTab:A}=H(),{expandedKeys:w,setExpandedKeys:T}=((e={})=>{const[t,n]=(0,r.useState)((()=>{if(e.rootNodes){const t=(0,d.values)(k(e.rootNodes,e.initialExpandDepth)).map((e=>e.key));return new Set(t)}return new Set}));return{expandedKeys:t,setExpandedKeys:n}})({rootNodes:f?[f]:[],initialExpandDepth:S}),{matchData:M,searchFilter:D,setSearchFilter:I,spanFilterState:F,setSpanFilterState:N,filteredTreeNodes:R,handleNextSearchMatch:z,handlePreviousSearchMatch:E}=_({treeNode:f,selectedNode:v,setSelectedNode:y,setActiveTab:A,setExpandedKeys:T,modelTraceInfo:null===e||void 0===e?void 0:e.info});(0,r.useLayoutEffect)((()=>{const e=(0,d.values)(k(R,S)).map((e=>e.key));T(new Set(e))}),[R,T]);const B=(0,r.useMemo)((()=>{const e=16*Math.max(...R.map(C))+7*c.spacing.lg;return Math.max(275,e)}),[R,c.spacing.lg]);return(0,m.FD)("div",{css:Dn,className:t,children:[(0,m.Y)("div",{css:(0,s.AH)({padding:c.spacing.xs,borderBottom:`1px solid ${c.colors.border}`},""),children:(0,m.Y)(Y,{searchFilter:D,setSearchFilter:I,matchData:M,handleNextSearchMatch:z,handlePreviousSearchMatch:E})}),(0,m.Y)(x,{ref:p,initialRatio:u,paneWidth:g,setPaneWidth:h,leftChild:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:B},""),children:(0,m.Y)(kn,{rootNodes:R,selectedNode:v,traceStartTime:null!==(i=null===f||void 0===f?void 0:f.start)&&void 0!==i?i:0,traceEndTime:null!==(l=null===f||void 0===f?void 0:f.end)&&void 0!==l?l:0,setSelectedNode:e=>{y(e),A(null!==e&&void 0!==e&&e.chatMessages?"chat":"content"),(0,d.isString)(null===e||void 0===e?void 0:e.key)&&(null===a||void 0===a||a(null===e||void 0===e?void 0:e.key))},css:In,expandedKeys:w,setExpandedKeys:T,spanFilterState:F,setSpanFilterState:N})}),leftMinWidth:B,rightChild:(0,m.Y)(rn,{activeSpan:v,searchFilter:D,activeMatch:M.match,activeTab:b,setActiveTab:A}),rightMinWidth:500})]})};var Fn={name:"15currb",styles:"display:flex;height:100%"},Hn={name:"82a6rk",styles:"flex:1"};var Nn=n(41261);const Rn=({traceId:e,setModelTrace:t,setAssessmentsPaneEnabled:n})=>(0,Nn.I)({queryFn:()=>(({traceId:e})=>gt(`/ajax-api/3.0/mlflow/traces/${e}`))({traceId:e}),onSuccess:e=>{t((t=>{var n,s;return{data:t.data,info:null!==(n=null===e||void 0===e||null===(s=e.trace)||void 0===s?void 0:s.trace_info)&&void 0!==n?n:{}}})),n(!0)},onError:()=>{n(!1)}}),_n=({title:e,tools:t})=>{const{theme:n}=(0,o.u)();return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,padding:n.spacing.sm,border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,m.Y)(o.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),bold:!0,children:e}),t.map((e=>(0,m.Y)(Ye,{tool:e},e.function.name)))]})},zn=({title:e,documents:t})=>{const{theme:n}=(0,o.u)();return(0,m.FD)("div",{css:(0,s.AH)({backgroundColor:n.colors.backgroundPrimary,borderRadius:n.borders.borderRadiusSm,border:`1px solid ${n.colors.border}`},""),children:[e&&(0,m.Y)("div",{css:(0,s.AH)({padding:`${n.spacing.xs}px ${n.spacing.sm}px`,borderBottom:`1px solid ${n.colors.border}`},""),children:(0,m.Y)(o.T.Text,{bold:!0,children:e})}),t.map(((e,r)=>(0,m.Y)("div",{css:(0,s.AH)({borderBottom:r!==t.length-1?`1px solid ${n.colors.border}`:""},""),children:(0,m.Y)(Je,{text:e.page_content,metadata:e.metadata},r)},r)))]})},En=({title:e,value:t})=>{const{theme:n}=(0,o.u)(),[l,c]=(0,r.useState)(!1),d=t.length>400,u=!l&&t.length>400?t.slice(0,400)+"...":t,p=d?{":hover":{backgroundColor:n.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,m.FD)("div",{css:(0,s.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,m.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${n.spacing.sm}px ${n.spacing.sm+n.spacing.xs}px`,...p},""),onClick:()=>c(!l),children:[(0,m.Y)(o.T.Text,{bold:!0,children:e}),d&&(l?(0,m.Y)(a.ChevronDownIcon,{}):(0,m.Y)(o.q,{}))]}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.sm+n.spacing.xs,paddingRight:n.spacing.sm+n.spacing.xs,paddingTop:e?0:n.spacing.sm,paddingBottom:n.spacing.sm,"& > div:last-of-type":{marginBottom:0}},""),children:[(0,m.Y)(Q,{children:u}),d&&(0,m.Y)(o.T.Link,{onClick:()=>c(!l),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:l?(0,m.Y)(i.A,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,m.Y)(i.A,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})},Bn=({title:e,data:t,renderMode:n})=>{const s=(0,r.useMemo)((()=>{try{return JSON.parse(t)}catch(e){return t}}),[t]),o=(0,d.isString)(s),a=(0,c.Hq)(s),i=Array.isArray(s)&&s.length>0&&(0,d.every)(s,c.PC),l=Array.isArray(s)&&s.length>0&&(0,d.every)(s,c.W0);return"json"===n?(0,m.Y)(ve,{title:e,data:t,initialRenderMode:z.cC.JSON}):"text"===n?(0,m.Y)(ve,{title:e,data:t,initialRenderMode:z.cC.TEXT}):o?(0,m.Y)(En,{title:e,value:s}):a&&a.length>0?(0,m.Y)(Ne,{messages:a}):i?(0,m.Y)(_n,{title:e,tools:s}):l?(0,m.Y)(zn,{title:e,documents:s}):(0,m.Y)(ve,{title:e,data:t})},On=({node:e})=>{var t;const{theme:n}=(0,o.u)(),r=(0,c.bn)(e),i=!e.parentId,l=r[0];return l?(0,m.Y)(_e,{css:(0,s.AH)({marginBottom:i?n.spacing.sm:0},""),withBorder:i,sectionKey:l.name,title:(0,m.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:n.spacing.sm},""),children:[(0,m.Y)(a.XCircleIcon,{color:"danger"}),(0,m.Y)(o.T.Text,{color:"error",bold:!0,children:"Exception"})]}),children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingBottom:n.spacing.sm,paddingLeft:i?0:n.spacing.lg},""),children:Object.entries(null!==(t=l.attributes)&&void 0!==t?t:{}).map((([e,t])=>(0,m.Y)(Bn,{title:e,data:JSON.stringify(t,null,2),renderMode:"text"},e)))})},l.name):null};var jn={name:"s6cpzs",styles:"display:flex;flex-direction:column;flex:1;min-width:0"},Ln={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},Kn={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"};const $n=({node:e,renderMode:t})=>{const{theme:n}=(0,o.u)(),[l,d]=(0,r.useState)(!1),u=(0,r.useMemo)((()=>(0,c.g_)(e.inputs)),[e]),p=(0,r.useMemo)((()=>(0,c.g_)(e.outputs)),[e]),g=(0,c.bn)(e).length>0,h=u.length>0,f=p.length>0,{setSelectedNode:x,setActiveView:v,setShowTimelineTreeGantt:y}=H();return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},""),children:[(0,m.Y)("div",{css:(0,s.AH)({height:48,display:"flex",alignItems:"center"},""),children:(0,m.Y)(o.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:n.spacing.xs},""),icon:l?(0,m.Y)(a.ChevronDownIcon,{}):(0,m.Y)(o.q,{}),onClick:()=>d(!l),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,m.Y)("div",{css:(0,s.AH)({position:"relative",boxSizing:"border-box",height:"100%",borderLeft:`2px solid ${n.colors.border}`,width:12},""),children:(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:n.borders.borderRadiusMd,borderBottom:`2px solid ${n.colors.border}`,borderLeft:`2px solid ${n.colors.border}`},"")})}),(0,m.FD)("div",{css:jn,children:[(0,m.FD)("div",{css:Ln,children:[(0,m.Y)(o.T.Text,{color:"secondary",css:(0,s.AH)({display:"inline-flex",alignItems:"center",height:48},""),children:(0,m.Y)(i.A,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,m.Y)(kt,{node:e})}})}),(0,m.Y)("span",{onClick:()=>{x(e),v("detail"),y(!0)},children:(0,m.Y)(o.T.Text,{css:Kn,color:"secondary",children:D(e.end-e.start)})})]}),l&&(0,m.FD)("div",{children:[g&&(0,m.Y)(On,{node:e}),h&&(0,m.Y)(_e,{sectionKey:"input",title:(0,m.Y)(i.A,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:f?0:n.spacing.sm},""),children:u.map((({key:e,value:n},s)=>(0,m.Y)(Bn,{title:e,data:n,renderMode:t},e||s)))})}),f&&(0,m.Y)(_e,{sectionKey:"output",title:(0,m.Y)(i.A,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:n.spacing.sm},""),children:p.map((({key:e,value:n})=>(0,m.Y)(Bn,{title:e,data:n,renderMode:t},e)))})})]})]})]})},Pn=({rootNode:e,intermediateNodes:t})=>{const{theme:n}=(0,o.u)(),[l,d]=(0,r.useState)("default"),u=e.inputs,p=e.outputs,g=(0,c.bn)(e),h=t.length>0,f=g.length>0,x=(0,c.g_)(u),v=(0,c.g_)(p);return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,padding:n.spacing.md,paddingTop:n.spacing.sm,overflow:"auto",minWidth:400},""),children:[(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"flex-end",marginBottom:n.spacing.sm},""),children:(0,m.FD)("div",{css:(0,s.AH)({display:"flex",gap:n.spacing.sm},""),children:[(0,m.FD)(a.SegmentedControlGroup,{name:"render-mode",componentId:"shared.model-trace-explorer.summary-view.render-mode",value:l,size:"small",onChange:e=>d(e.target.value),children:[(0,m.Y)(a.SegmentedControlButton,{value:"default",children:(0,m.Y)(i.A,{id:"uYkbr+",defaultMessage:"Default"})}),(0,m.Y)(a.SegmentedControlButton,{value:"json",children:(0,m.Y)(i.A,{id:"XC1Pro",defaultMessage:"JSON"})})]}),(0,m.Y)(ot,{})]})}),f&&(0,m.Y)(On,{node:e}),(0,m.Y)(_e,{withBorder:!0,title:(0,m.Y)(i.A,{id:"/TX1Az",defaultMessage:"Inputs"}),css:(0,s.AH)({marginBottom:h?0:n.spacing.md},""),sectionKey:"summary-inputs",children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:x.map((({key:e,value:t},n)=>(0,m.Y)(Bn,{title:e,data:t,renderMode:l},e||n)))})}),h&&t.map((e=>(0,m.Y)($n,{node:e,renderMode:l},e.key))),(0,m.Y)(_e,{withBorder:!0,title:(0,m.Y)(i.A,{id:"ZstVNI",defaultMessage:"Outputs"}),sectionKey:"summary-outputs",children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:v.map((({key:e,value:t},n)=>(0,m.Y)(Bn,{title:e,data:t,renderMode:l},e||n)))})})]})},Wn=e=>{var t;return!!e.parentId&&([z.UG.AGENT,z.UG.RETRIEVER,z.UG.CHAT_MODEL,z.UG.TOOL,z.UG.LLM].includes(null!==(t=e.type)&&void 0!==t?t:z.UG.UNKNOWN)||(0,c.N7)(e)>0)},Vn=({modelTrace:e})=>{const{theme:t}=(0,o.u)(),[n,l]=(0,r.useState)(500),{rootNode:c,nodeMap:d,assessmentsPaneEnabled:u,assessmentsPaneExpanded:p}=H(),g=(0,r.useMemo)((()=>Object.values(d).flatMap((e=>e.assessments))),[d]),h=(0,r.useMemo)((()=>{if(!c)return[];return M([c]).filter(Wn)}),[c]);return c?u&&p?(0,m.Y)(x,{initialRatio:.75,paneWidth:n,setPaneWidth:l,leftChild:(0,m.Y)(Pn,{rootNode:c,intermediateNodes:h}),rightChild:(0,m.Y)(nn,{assessments:g,traceId:c.traceId,activeSpanId:void 0}),leftMinWidth:400,rightMinWidth:lt}):(0,m.Y)(Pn,{rootNode:c,intermediateNodes:h}):(0,m.Y)("div",{css:(0,s.AH)({marginTop:t.spacing.lg},""),children:(0,m.Y)(a.Empty,{description:(0,m.Y)(i.A,{id:"hm98EL",defaultMessage:"No span data to display"})})})};var Un={name:"13y2nry",styles:"display:flex;flex-direction:column;height:100%;overflow:hidden"},Jn={name:"1kyojz6",styles:"& > div:first-of-type{margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},qn={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},Gn={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const Zn=({modelTrace:e,className:t,selectedSpanId:n,onSelectSpan:r})=>{const{theme:c}=(0,o.u)(),d=(0,l.wO)(),{activeView:u,setActiveView:p}=H();return d?(0,m.FD)(a.Tabs.Root,{componentId:"model-trace-explorer",value:u,onValueChange:e=>p(e),css:Jn,children:[(0,m.FD)(a.Tabs.List,{css:(0,s.AH)({paddingLeft:c.spacing.md,flexShrink:0},""),children:[(0,m.Y)(a.Tabs.Trigger,{value:"summary",children:(0,m.Y)(i.A,{id:"paolVF",defaultMessage:"Summary"})}),(0,m.Y)(a.Tabs.Trigger,{value:"detail",children:(0,m.Y)(i.A,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,m.Y)(a.Tabs.Content,{value:"summary",css:qn,children:(0,m.Y)(Vn,{modelTrace:e})}),(0,m.Y)(a.Tabs.Content,{value:"detail",css:Gn,children:(0,m.Y)(Cn,{modelTrace:e,className:t,selectedSpanId:n,onSelectSpan:r})})]}):(0,m.Y)("div",{css:Un,children:(0,m.Y)(Cn,{modelTrace:e,className:t,selectedSpanId:n,onSelectSpan:r})})},Xn=({refetchContextValue:e,children:t})=>(0,m.Y)(ft.Provider,{value:e,children:t}),Qn=({modelTrace:e,className:t,initialActiveView:n="summary",selectedSpanId:s,onSelectSpan:o})=>{const[a,i]=(0,r.useState)(e),[l,d]=(0,r.useState)(!0),u=(0,c.MF)(e),{refetch:p}=Rn({traceId:u,setModelTrace:i,setAssessmentsPaneEnabled:d}),g=(0,r.useMemo)((()=>({refetchTraceInfo:p})),[p]);return(0,r.useEffect)((()=>{i(e),p()}),[u]),(0,m.Y)(Xn,{traceId:u,refetchContextValue:g,children:(0,m.Y)(N,{modelTrace:a,initialActiveView:n,selectedSpanIdOnRender:s,assessmentsPaneEnabled:l,children:(0,m.Y)(Zn,{modelTrace:a,className:t,selectedSpanId:s,onSelectSpan:o})})})};Qn.Skeleton=({label:e})=>{const{theme:t}=(0,o.u)();return(0,m.FD)("div",{css:Fn,children:[(0,m.FD)("div",{css:Hn,children:[(0,m.Y)("div",{css:(0,s.AH)({padding:t.spacing.sm,borderBottom:`1px solid ${t.colors.border}`},""),children:(0,m.Y)(a.TitleSkeleton,{label:e})}),(0,m.FD)("div",{css:(0,s.AH)({borderRadius:t.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),children:[(0,m.Y)("div",{css:(0,s.AH)({flex:1,padding:t.spacing.sm,borderRight:`1px solid ${t.colors.border}`},""),children:(0,m.Y)(a.TableSkeleton,{lines:5})}),(0,m.Y)("div",{css:(0,s.AH)({flex:2,padding:t.spacing.sm},""),children:(0,m.Y)(a.TableSkeleton,{lines:5})})]})]}),(0,m.Y)("div",{css:(0,s.AH)({padding:t.spacing.md,overflowY:"auto",flex:1},""),children:(0,m.Y)(a.TableSkeleton,{lines:12})})]})}},36784:function(e,t,n){n.d(t,{n:function(){return c},u:function(){return d}});var s=n(9133),r=n(46932);const o=e=>(0,s.isObject)(e)&&(0,s.isString)((0,s.get)(e,"id"))&&(0,s.isString)((0,s.get)(e,"name"))&&(0,s.isString)((0,s.get)(e,"arguments")),a=e=>{if(!(0,s.isObject)(e))return!1;const t=(0,s.get)(e,"type");if(t){if("SystemMessage"===t)return(0,s.isString)((0,s.get)(e,"content"));if("UserMessage"===t)return(0,s.has)(e,"content")&&(0,s.has)(e,"source");if("AssistantMessage"===t)return(0,s.has)(e,"content")&&(0,s.has)(e,"source");if("FunctionMessage"===t)return(0,s.has)(e,"content")&&(0,s.has)(e,"source")}return!(!(0,s.has)(e,"source")||!["system","user","assistant","function"].includes((0,s.get)(e,"source")))&&(0,s.has)(e,"content")},i=e=>(0,s.isString)(e)?(0,r.ZI)({type:"message",content:e,role:"assistant"}):(0,s.isArray)(e)&&e.every(o)?{role:"assistant",tool_calls:e.map((e=>(0,r.CL)({id:e.id,function:{name:e.name,arguments:e.arguments}})))}:null,l=e=>{if("SystemMessage"===e.type)return(0,r.ZI)({type:"message",content:e.content,role:"system"});if("UserMessage"===e.type){if((0,s.isString)(e.content))return(0,r.ZI)({type:"message",content:e.content,role:"user"});if((0,s.isArray)(e.content)){const t=e.content.filter((e=>(0,s.isString)(e)||(0,s.isObject)(e)&&"text"===e.type)).map((e=>(0,s.isString)(e)?{type:"text",text:e}:e));if(t.length>0)return(0,r.ZI)({type:"message",content:t,role:"user"})}}if("AssistantMessage"===e.type)return i(e.content);if("FunctionMessage"===e.type)return(0,r.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"});if("system"===e.source)return(0,r.ZI)({type:"message",content:e.content,role:"system"});if("user"===e.source){if((0,s.isString)(e.content))return(0,r.ZI)({type:"message",content:e.content,role:"user"});if((0,s.isArray)(e.content)){const t=e.content.filter((e=>(0,s.isString)(e))).map((e=>({type:"text",text:e})));if(t.length>0)return(0,r.ZI)({type:"message",content:t,role:"user"})}}return"assistant"===e.source?i(e.content):"function"===e.source?(0,r.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"}):null},c=e=>{if((0,s.isNil)(e))return null;if((0,s.isArray)(e)&&e.length>0&&e.every(a))return(0,s.compact)(e.map(l));if((0,s.isObject)(e)&&"messages"in e){const t=e.messages;if((0,s.isArray)(t)&&t.length>0&&t.every(a))return(0,s.compact)(t.map(l))}return null},d=e=>{if((0,s.isNil)(e))return null;if((0,s.isArray)(e)&&e.length>0&&e.every(a))return(0,s.compact)(e.map(l));if((0,s.isObject)(e)&&"content"in e){const t=(0,r.ZI)({role:"assistant",content:e.content,type:"message"});return t?[t]:null}return null}},38237:function(e,t,n){n.d(t,{Y:function(){return l},f:function(){return c}});var s=n(9133),r=n(46932);const o=e=>{if(e.text)return{type:"text",text:e.text};if(e.json)return{type:"text",text:JSON.stringify(e.json)};if(e.image){const t=e.image.source.bytes,n=e.image.format;let s;if("string"===typeof t)s=t;else{s=Buffer.from(t).toString("base64")}return{type:"image_url",image_url:{url:`data:${`image/${n}`};base64,${s}`}}}return null},a=e=>{let t=e.role;const n=[],s=[];let a;for(const c of e.content)if(c.toolUse){const e=c.toolUse,t="string"===typeof e.input?e.input:JSON.stringify(e.input);s.push((0,r.CL)({id:e.toolUseId,function:{name:e.name,arguments:t}}))}else if(c.toolResult){a=c.toolResult.toolUseId,t="tool";for(const e of c.toolResult.content){const t=o(e);t&&n.push(t)}}else{const e=o(c);e&&n.push(e)}let i="";n.length>0&&(i=n.map((e=>"text"===e.type?e.text:"image_url"===e.type?`[Image: ${e.image_url.url}]`:"")).filter((e=>e.length>0)).join(" "));const l={role:t,content:i};return s.length>0&&(l.tool_calls=s),a&&(l.tool_call_id=a),l},i=e=>{if(!(0,s.isObject)(e))return!1;const t=(0,s.has)(e,"role")&&(0,s.isString)(e.role)&&["user","assistant","system"].includes(e.role),n=(0,s.has)(e,"content")&&(0,s.isArray)(e.content);return t&&n},l=e=>{if((0,s.isNil)(e))return null;if((0,s.isObject)(e)&&"messages"in e){const t=e.messages;if((0,s.isArray)(t)&&t.length>0&&t.every(i))return(0,s.compact)(t.map(a))}return null},c=e=>{if((0,s.isNil)(e))return null;if((0,s.isObject)(e)&&"output"in e){const t=e.output;if((0,s.isObject)(t)&&"message"in t){const e=t.message;if(i(e))return[a(e)]}}return null}},50211:function(e,t){t.A={'code[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none"},'pre[class*="language-"]':{textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",wordWrap:"normal",color:"rgb(77, 77, 76)",background:"#fafafa",fontFamily:"Monaco, Menlo, Ubuntu Mono, Consolas, source-code-pro, monospace",fontSize:"12px",lineHeight:"1.5em",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",overflow:"auto",position:"relative",margin:"0.5em 0",padding:"1.25em 1em"},'code[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::-moz-selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"]::selection':{background:"#cceae7",color:"#263238"},'code[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},'pre[class*="language-"] ::selection':{background:"#cceae7",color:"#263238"},':not(pre) > code[class*="language-"]':{whiteSpace:"normal",borderRadius:"0.2em",padding:"0.1em"},".language-css > code":{color:"#f5871f"},".language-sass > code":{color:"#f5871f"},".language-scss > code":{color:"#f5871f"},'[class*="language-"] .namespace':{Opacity:"0.7"},atrule:{color:"#7c4dff"},"attr-name":{color:"#39adb5"},"attr-value":{color:"#f6a434"},attribute:{color:"#f6a434"},boolean:{color:"#7c4dff"},builtin:{color:"#39adb5"},cdata:{color:"#39adb5"},char:{color:"#39adb5"},class:{color:"#39adb5"},"class-name":{color:"#6182b8"},comment:{color:"#8e908c"},constant:{color:"#7c4dff"},deleted:{color:"#e53935"},doctype:{color:"#aabfc9"},entity:{color:"#e53935"},function:{color:"#4271ae"},hexcode:{color:"#f5871f"},id:{color:"#7c4dff",fontWeight:"bold"},important:{color:"#7c4dff",fontWeight:"bold"},inserted:{color:"#39adb5"},keyword:{color:"#8959a8"},number:{color:"#f5871f"},operator:{color:"#3e999f"},prolog:{color:"#aabfc9"},property:{color:"#39adb5"},"pseudo-class":{color:"#f6a434"},"pseudo-element":{color:"#f6a434"},punctuation:{color:"rgb(77, 77, 76)"},regex:{color:"#6182b8"},selector:{color:"#e53935"},string:{color:"#3ba85f"},symbol:{color:"#7c4dff"},tag:{color:"#e53935"},unit:{color:"#f5871f"},url:{color:"#e53935"},variable:{color:"#c72d4c"}}},76901:function(e,t,n){n.d(t,{AG:function(){return d},a8:function(){return o},bS:function(){return a},m$:function(){return f},n_:function(){return p},xW:function(){return h}});var s=n(9133),r=n(46932);const o=e=>{var t;if(!e)return null;const n=null!==(t=e.messages)&&void 0!==t?t:e.input;return Array.isArray(n)&&0!==n.length&&n.every(r.I$)?(0,s.compact)(n.map(r.ZI)):null},a=e=>(0,r.x0)(e)?e.map((e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(r.CL)}})):(0,r.in)(e)?e.choices.map((e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(r.CL)}})):null,i=e=>!!((0,s.has)(e,"role")&&(0,s.has)(e,"content")&&["user","assistant","system","developer"].includes(e.role))&&((0,s.isString)(e.content)||(0,s.isArray)(e.content)&&e.content.every((e=>(0,s.has)(e,"type")&&["input_text","input_image","input_file"].includes(e.type)))),l=e=>{if(!(0,s.isObject)(e))return!1;if("message"===(0,s.get)(e,"type"))return(0,r.I$)(e);if("function_call"===(0,s.get)(e,"type"))return(0,s.isString)((0,s.get)(e,"call_id"))&&(0,s.isString)((0,s.get)(e,"name"))&&(0,s.isString)((0,s.get)(e,"arguments"));if("function_call_output"===(0,s.get)(e,"type"))return(0,s.isString)((0,s.get)(e,"call_id"))&&(0,s.isString)((0,s.get)(e,"output"));if("image_generation_call"===(0,s.get)(e,"type")){const t=(0,s.get)(e,"output_format");return(0,s.isString)((0,s.get)(e,"result"))&&(0,s.isString)(t)&&["png","jpeg","webp"].includes(t)}return"reasoning"===(0,s.get)(e,"type")&&((0,s.has)(e,"id")&&(0,s.isArray)((0,s.get)(e,"summary")))},c=e=>{if((0,s.isString)(e.content)){const t=(0,r.ZI)({type:"message",content:e.content,role:e.role});return t&&[t]}return e.content.map((t=>((e,t)=>{const n=(0,s.get)(e,"text");if("input_text"===(0,s.get)(e,"type")&&(0,s.isString)(n))return(0,r.ZI)({type:"message",content:[{type:"text",text:n}],role:t});const o=(0,s.get)(e,"image_url");return"input_image"===(0,s.get)(e,"type")&&(0,s.isString)(o)?(0,r.ZI)({type:"message",content:[{type:"image_url",image_url:{url:o}}],role:t}):null})(t,e.role))).filter((e=>null!==e))},d=e=>{const t=(0,s.get)(e,"input");if((0,s.isString)(t)){const e=(0,r.ZI)({type:"message",content:t,role:"user"});return e&&[e]}return(0,s.isArray)(t)&&t.every(i)?(0,s.compact)(t.flatMap(c)):null},u=e=>"message"===e.type?(0,r.ZI)(e):"function_call"===e.type?{role:"assistant",tool_calls:[(0,r.CL)({id:e.call_id,function:{arguments:e.arguments,name:e.name}})]}:"function_call_output"===e.type?{role:"tool",tool_call_id:e.call_id,content:e.output}:"image_generation_call"===e.type?(0,r.ZI)({type:"message",content:[{type:"image_url",image_url:{url:`data:image/${e.output_format};base64,${e.result}`}}],role:"tool"}):(e.type,null),p=e=>{if((0,s.isNil)(e))return null;const t=(0,s.get)(e,"output");return(0,s.isArray)(t)&&t.length>0&&t.every(l)?(0,s.compact)(t.map(u).filter(Boolean)):(0,s.isArray)(t)&&t.length>0&&t.every((e=>"response.output_item.done"===e.type&&l(e.item)))?(0,s.compact)(t.map((e=>u(e.item)))):null},m=e=>!!(0,s.isObject)(e)&&(!!((0,s.has)(e,"role")&&(0,s.has)(e,"content")&&["user","assistant","system","tool"].includes(e.role))||("function_call"===(0,s.get)(e,"type")?(0,s.isString)((0,s.get)(e,"call_id"))&&(0,s.isString)((0,s.get)(e,"name"))&&(0,s.isString)((0,s.get)(e,"arguments")):"function_call_output"===(0,s.get)(e,"type")&&((0,s.isString)((0,s.get)(e,"call_id"))&&(0,s.isString)((0,s.get)(e,"output"))))),g=e=>{if((0,s.has)(e,"role")&&(0,s.has)(e,"content")){if((0,s.isArray)(e.content)){const t=e.content.filter((e=>"output_text"===e.type&&(0,s.isString)(e.text))).map((e=>e.text)).join(" ");if(t)return(0,r.ZI)({...e,content:t})}return(0,r.ZI)(e)}if("function_call"===(0,s.get)(e,"type")){const t=(0,s.get)(e,"call_id"),n=(0,s.get)(e,"arguments"),o=(0,s.get)(e,"name");if((0,s.isString)(t)&&(0,s.isString)(n)&&(0,s.isString)(o))return{role:"assistant",tool_calls:[(0,r.CL)({id:t,function:{arguments:n,name:o}})]}}if("function_call_output"===(0,s.get)(e,"type")){const t=(0,s.get)(e,"call_id"),n=(0,s.get)(e,"output");if((0,s.isString)(t)&&(0,s.isString)(n))return{role:"tool",tool_call_id:t,content:n}}return null},h=e=>(0,s.isNil)(e)?null:(0,s.isArray)(e)&&e.length>0&&e.every(m)?(0,s.compact)(e.map(g)):null,f=e=>(0,s.isNil)(e)?null:(0,s.isArray)(e)&&e.length>0&&e.every(m)?(0,s.compact)(e.map(g)):null},79912:function(e,t,n){n.d(t,{H:function(){return c},W:function(){return l}});var s=n(9133),r=n(46932);const o=e=>{const t=(0,s.get)(e,"text");return"text"===(0,s.get)(e,"block_type")&&(0,s.isString)(t)},a=e=>{const t=(0,s.get)(e,"blocks"),n=(0,s.get)(e,"role");return(0,s.isString)(n)&&["assistant","system","user"].includes(n)&&(0,s.isArray)(t)&&t.every(o)},i=e=>(0,r.ZI)({role:e.role,content:e.blocks.map((e=>({type:"text",text:e.text})))}),l=e=>{if(!(e=>a((0,s.get)(e,"message")))(e))return null;const t=i(e.message);return t&&[t]},c=e=>(e=>{const t=(0,s.get)(e,"messages");return(0,s.isArray)(t)&&t.every(a)})(e)?(0,s.compact)(e.messages.map(i)):null},86494:function(e,t,n){n.d(t,{P:function(){return c}});var s=n(89555),r=n(13062),o=n(37523),a=n(40553),i=n(48563),l=n(50111);const c=({type:e=i.Dy.CONNECT,isInTooltip:t=!1,hasException:n=!1,isRootSpan:c=!1})=>{const{theme:d}=(0,r.u)();let u;c?u="ai":n&&(u="danger");const p={[i.Dy.MODELS]:(0,l.Y)(o.ModelsIcon,{color:u}),[i.Dy.DOCUMENT]:(0,l.Y)(o.FileDocumentIcon,{color:u}),[i.Dy.CONNECT]:(0,l.Y)(o.ConnectIcon,{color:u}),[i.Dy.CODE]:(0,l.Y)(o.CodeIcon,{color:u}),[i.Dy.FUNCTION]:(0,l.Y)(o.FunctionIcon,{color:u}),[i.Dy.NUMBERS]:(0,l.Y)(o.NumbersIcon,{color:u}),[i.Dy.SEARCH]:(0,l.Y)(a.S,{color:u}),[i.Dy.SORT]:(0,l.Y)(o.SortUnsortedIcon,{color:u}),[i.Dy.UNKNOWN]:(0,l.Y)(o.QuestionMarkIcon,{color:u}),[i.Dy.WRENCH]:(0,l.Y)(o.WrenchIcon,{color:u}),[i.Dy.AGENT]:(0,l.Y)(o.UserSparkleIcon,{color:u}),[i.Dy.CHAIN]:(0,l.Y)(o.ChainIcon,{color:u}),[i.Dy.USER]:(0,l.Y)(o.UserIcon,{color:u}),[i.Dy.SYSTEM]:(0,l.Y)(o.GearIcon,{color:u})};let m=d.colors.actionDefaultIconDefault,g=d.colors.actionPrimaryIcon,h=d.colors.backgroundSecondary;switch(e){case i.Dy.SEARCH:m=d.colors.textValidationSuccess,g=d.colors.green500,h=d.isDarkMode?d.colors.green800:d.colors.green100;break;case i.Dy.MODELS:m=d.isDarkMode?d.colors.blue500:d.colors.turquoise,g=d.isDarkMode?d.colors.turquoise:d.colors.blue500,h=d.isDarkMode?d.colors.blue800:d.colors.blue100;break;case i.Dy.WRENCH:m=d.isDarkMode?d.colors.red500:d.colors.red700,g=d.isDarkMode?d.colors.red700:d.colors.red500,h=d.isDarkMode?d.colors.red800:d.colors.red100}return(0,l.FD)("div",{css:(0,s.AH)({position:"relative",width:d.general.iconSize,height:d.general.iconSize,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:d.borders.borderRadiusSm,background:t?d.colors.tooltipBackgroundTooltip:h,color:t?g:m,svg:{width:d.general.iconFontSize,height:d.general.iconFontSize},flexShrink:0},""),children:[n&&(0,l.Y)("div",{css:(0,s.AH)({position:"absolute",top:-d.spacing.xs,right:-d.spacing.xs,height:d.spacing.sm,width:d.spacing.sm,borderRadius:d.borders.borderRadiusSm,backgroundColor:d.colors.actionDangerPrimaryBackgroundDefault,zIndex:5},"")}),p[e]]})}},92151:function(e,t,n){n.d(t,{KF:function(){return c},pL:function(){return d},iU:function(){return M},Pn:function(){return k},DE:function(){return g},Sy:function(){return h},HD:function(){return S},oI:function(){return w},W3:function(){return T.W},a8:function(){return f.a8},bS:function(){return f.bS},AG:function(){return f.AG},n_:function(){return f.n_}});var s=n(9133),r=n(46932);const o=e=>{if((0,s.isNil)(e))return!1;if((0,s.has)(e,"type")){if("text"===e.type&&(0,s.has)(e,"text")&&(0,s.isString)(e.text))return!0;if("image"===e.type&&(0,s.has)(e,"source")&&(0,s.has)(e.source,"type")){if("base64"===e.source.type&&(0,s.has)(e.source,"media_type")&&(0,s.isString)(e.source.media_type)&&["image/jpeg","image/png","image/gif","image/webp"].includes(e.source.media_type)&&(0,s.has)(e.source,"data")&&(0,s.isString)(e.source.data))return!0;if("url"===e.source.type&&(0,s.has)(e.source,"url")&&(0,s.isString)(e.source.url))return!0}if("tool_use"===e.type&&(0,s.has)(e,"id")&&(0,s.has)(e,"name")&&(0,s.has)(e,"input"))return(0,s.isString)(e.id)&&(0,s.isString)(e.name)&&(0,s.isObject)(e.input);if("tool_result"===e.type&&(0,s.has)(e,"tool_use_id")&&(0,s.has)(e,"content"))return(0,s.isString)(e.tool_use_id)&&(0,s.isString)(e.content)}return!1},a=e=>{if(!(0,s.isObject)(e))return!1;const t=(0,s.has)(e,"role")&&(0,s.isString)(e.role)&&["user","assistant"].includes(e.role),n="content"in e&&((0,s.isString)(e.content)||(0,s.isArray)(e.content)&&e.content.every(o));return t&&n},i=e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":switch(e.source.type){case"base64":return{type:"image_url",image_url:{url:`data:${e.source.media_type};base64,${e.source.data}`}};case"url":return{type:"image_url",image_url:{url:e.source.url}}}}throw new Error(`Unsupported content block type: ${e.type}`)},l=e=>{const t=[];if("string"===typeof e.content){const n=(0,r.ZI)({type:"message",content:e.content,role:e.role});n&&t.push(n)}else{const{messages:n,textParts:s,toolCalls:o}=(e=>{const t=[],n=[],s=[];for(const r of e)"text"===r.type||"image"===r.type?n.push(i(r)):"tool_use"===r.type?s.push({id:r.id,function:{name:r.name,arguments:JSON.stringify(r.input)}}):"tool_result"===r.type&&t.push({role:"tool",tool_call_id:r.tool_use_id,content:r.content});return{messages:t,textParts:n,toolCalls:s}})(e.content);if(t.push(...n),s.length>0||o.length>0){const n=(0,r.ZI)({type:"message",content:s.length>0?s:void 0,role:e.role,...o.length>0&&{tool_calls:o}});n&&t.push(n)}}return t},c=e=>{if(!(0,s.isObject)(e))return null;if("messages"in e&&(0,s.isArray)(e.messages)&&e.messages.every(a)){const t=[];for(const n of e.messages)t.push(...l(n));return t}return null},d=e=>(0,s.isObject)(e)&&(0,s.has)(e,"type")&&"message"===e.type&&a(e)?l(e):null,u=e=>(0,s.isObject)(e)&&"text"in e&&(0,s.isString)(e.text),p=e=>(0,s.isObject)(e)&&"role"in e&&(0,s.isString)(e.role)&&["user","model"].includes(e.role)&&(0,s.has)(e,"parts")&&Array.isArray(e.parts)&&e.parts.every(u),m=e=>(0,s.isObject)(e)&&"content"in e&&p(e.content),g=e=>{if(!(0,s.isObject)(e))return null;if("contents"in e){if((0,s.isString)(e.contents)){const t=(0,r.ZI)({type:"message",content:e.contents,role:"user"});return t&&[t]}if((0,s.isArray)(e.contents)&&e.contents.every(p))return(0,s.compact)(e.contents.map((e=>{const t="model"===e.role?"assistant":e.role;return(0,r.ZI)({type:"message",content:e.parts.map((e=>({type:"text",text:e.text}))),role:t})})))}return null},h=e=>(0,s.isObject)(e)&&"candidates"in e&&(0,s.isArray)(e.candidates)&&e.candidates.every(m)?(0,s.compact)(e.candidates.flatMap((e=>e.content)).map((e=>{const t="model"===e.role?"assistant":e.role;return(0,r.ZI)({type:"message",content:e.parts.map((e=>({type:"text",text:e.text}))),role:t})}))):null;var f=n(76901);const x=e=>{var t;let n,o;switch(e.type){case"user":case"human":n="user";break;case"assistant":case"ai":n="assistant";break;case"system":n="system";break;case"tool":n="tool";break;case"function":n="function";break;default:return null}if((0,s.isString)(e.content))o=e.content;else if(Array.isArray(e.content)){o=e.content.map((e=>{var t;return(0,s.isString)(e)?e:"text"===e.type&&e.text?e.text:"image_url"===e.type&&null!==(t=e.image_url)&&void 0!==t&&t.url?`![](${e.image_url.url})`:""})).filter(Boolean).join("\n\n")}else o=void 0;const a={content:o,role:n},i=e.tool_calls,l=null===(t=e.additional_kwargs)||void 0===t?void 0:t.tool_calls;return!(0,s.isNil)(i)&&Array.isArray(i)&&i.length>0&&i.every(b)?a.tool_calls=(0,s.compact)(i.map(v)):!(0,s.isNil)(l)&&Array.isArray(l)&&l.length>0&&l.every(r.h8)&&(a.tool_calls=l.map(r.CL)),(0,s.isNil)(e.tool_call_id)||(a.tool_call_id=e.tool_call_id),a},v=e=>({id:e.id,function:{arguments:JSON.stringify(e.args,null,2),name:e.name}}),y=e=>!!e&&(!!((0,s.isNil)(e.content)||(0,s.isString)(e.content)||Array.isArray(e.content))&&["human","user","assistant","ai","system","tool","function"].includes(e.type)),b=e=>e&&(0,s.isString)(e.name)&&(0,s.has)(e,"args")&&(0,s.isString)(e.id),Y=e=>e&&y(e.message),S=e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])&&e[0].length>0&&e[0].every(y)){const t=e[0].map(x);return t.some((e=>null===e))?null:t}if(Array.isArray(null===e||void 0===e?void 0:e.messages)&&e.messages.length>0&&e.messages.every(y)){const t=e.messages.map(x);return t.some((e=>null===e))?null:t}if(Array.isArray(e)&&e.length>0&&e.every(y)){const t=e.map(x);return t.some((e=>null===e))?null:t}return null},A=e=>{const t=e.map((e=>x(e.message)));return t.some((e=>null===e))?null:t},w=e=>(e=>!(!Array.isArray(e)||e.length<1)&&!(!Array.isArray(e[0])||e[0].length<1)&&e[0].every(Y))(e)?A(e[0]):Array.isArray(null===e||void 0===e?void 0:e.generations)&&e.generations.length>0&&e.generations[0].every(Y)?A(e.generations[0]):null;var T=n(79912);const M=e=>{if((0,s.has)(e,"messages")&&(0,s.isArray)(e.messages)){return e.messages.map((e=>(0,r.ZI)({type:"message",content:e.content,role:e.role}))).filter(Boolean)}return null},k=e=>{if((0,s.isArray)(e)&&e.length>0&&e.every(s.isString)){const t=e.join("\n"),n=(0,r.ZI)({type:"message",content:t,role:"assistant"});return n&&[n]}return null}}}]);
//# sourceMappingURL=4427.0061ea88.chunk.js.map