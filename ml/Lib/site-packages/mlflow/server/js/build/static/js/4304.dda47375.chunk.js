"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[4304],{1323:function(e,t,n){n.d(t,{m:function(){return r}});var o=n(37523),a=n(50361),s=n(50111);const r=({sourceType:e,className:t})=>e===a.Y1.NOTEBOOK?(0,s.Y)(o.NotebookIcon,{className:t}):e===a.Y1.LOCAL?(0,s.Y)(o.FileCodeIcon,{className:t}):e===a.Y1.PROJECT?(0,s.Y)(o.FolderBranchIcon,{className:t}):e===a.Y1.JOB?(0,s.Y)(o.WorkflowsIcon,{className:t}):null},15164:function(e,t,n){n.d(t,{t:function(){return u}});var o=n(89555),a=n(31014),s=n(76010),r=n(13062),i=n(1323),l=n(50111);var c={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const u=a.memo((({value:e})=>{var t;const{theme:n}=(0,r.u)();if(!e)return(0,l.Y)(l.FK,{children:"-"});const a=(null===(t=e[s.A.sourceTypeTag])||void 0===t?void 0:t.value)||"",u=s.A.renderSource(e||{},void 0,void 0);return u?(0,l.FD)("div",{css:(0,o.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center"},""),children:[(0,l.Y)(i.m,{sourceType:a,css:(0,o.AH)({color:n.colors.textSecondary},"")}),(0,l.Y)("span",{css:c,children:u})]}):(0,l.Y)(l.FK,{children:"-"})}))},17297:function(e,t,n){n.d(t,{nX:function(){return o},wO:function(){return a}});const o=()=>!0,a=()=>!0},30214:function(e,t,n){n.d(t,{W:function(){return l}});var o=n(89555),a=(n(31014),n(88443)),s=n(13062),r=n(37523),i=n(50111);const l=({className:e})=>{const{theme:t}=(0,s.u)();return(0,i.Y)(r.Tag,{componentId:"codegen_mlflow_app_src_shared_building_blocks_previewbadge.tsx_14",className:e,css:(0,o.AH)({marginLeft:t.spacing.xs},""),color:"turquoise",children:(0,i.Y)(a.A,{id:"8qJt7/",defaultMessage:"Experimental"})})}},32614:function(e,t,n){n.d(t,{A:function(){return o}});class o{static getStoreForComponent(e,t){return new a([e,t].join("-"),"localStorage")}static getSessionScopedStoreForComponent(e,t){return new a([e,t].join("-"),"sessionStorage")}}o.version="1.1";class a{constructor(e,t){this.scope=void 0,this.storageObj=void 0,this.scope=e,this.storageObj="localStorage"===t?window.localStorage:window.sessionStorage}loadComponentState(){const e=this.getItem(a.reactComponentStateKey);return e?JSON.parse(e):{}}saveComponentState(e){const t="function"===typeof e.toJSON?e.toJSON():e;this.setItem(a.reactComponentStateKey,JSON.stringify(t))}withScopePrefix(e){return["MLflowLocalStorage",o.version,this.scope,e].join("-")}setItem(e,t){this.storageObj.setItem(this.withScopePrefix(e),t)}getItem(e){return this.storageObj.getItem(this.withScopePrefix(e))}}a.reactComponentStateKey="ReactComponentState"},39771:function(e,t,n){n.d(t,{b:function(){return a}});var o=n(31014);function a(e){const t=(0,o.useRef)(null),[n,a]=(0,o.useState)(void 0),s=(0,o.useCallback)((()=>{t.current&&a(t.current.clientWidth)}),[]);(0,o.useLayoutEffect)((()=>(s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s))),[s]);return{resizableMaxWidth:void 0===n?void 0:n-e,ref:(0,o.useCallback)((e=>{t.current=e,s()}),[s])}}},43683:function(e,t,n){n.d(t,{Q:function(){return x}});var o=n(89555),a=n(9133),s=n(31014),r=n(13062),i=n(6958),l=n(37523),c=n(88464),u=n(88443),d=n(13369),m=n(50111);var g={name:"4zleql",styles:"display:block"};function p(e){return t=>function(e,t){const n=(0,c.A)(),{theme:i}=(0,r.u)(),u=e.props.searchValue.toLowerCase();return(0,s.useMemo)((()=>{if(!u)return e;if((0,a.sortedIndexOf)(t,u)>=0)return e;const r=/^[^,.:/=\-\s]+$/.test(u);return s.cloneElement(e,{flattenOptions:[{data:{value:u,disabled:!r,style:{color:r?i.colors.actionTertiaryTextDefault:i.colors.actionDisabledText},children:(0,m.Y)(l.LegacyTooltip,{title:r?void 0:n.formatMessage({id:"fWEvZL",defaultMessage:", . : / - = and blank spaces are not allowed"}),placement:"right",children:(0,m.FD)("span",{css:g,children:[(0,m.Y)(l.PlusIcon,{css:(0,o.AH)({marginRight:i.spacing.sm},"")}),n.formatMessage({id:"IJbauF",defaultMessage:'Add tag "{tagKey}"'},{tagKey:u})]})})},key:u,groupOption:!1},...e.props.flattenOptions]})}),[t,e,u,n,i])}(t,e)}var h={name:"1d3w5wq",styles:"width:100%"};function f({allAvailableTags:e,control:t,onKeyChangeCallback:n}){const o=(0,c.A)(),[a,r]=(0,s.useState)(!1),i=(0,s.useRef)(null),{field:u,fieldState:g}=(0,d.as)({control:t,name:"key",rules:{required:{message:o.formatMessage({id:"RlBbjb",defaultMessage:"A tag key is required"}),value:!0}}});return(0,m.Y)(l.LegacySelect,{allowClear:!0,ref:i,dangerouslySetAntdProps:{showSearch:!0,dropdownRender:p(e)},css:h,placeholder:o.formatMessage({id:"8ALhnh",defaultMessage:"Type a key"}),value:u.value,defaultValue:u.value,open:a,onDropdownVisibleChange:e=>{r(e)},filterOption:(e,t)=>null===t||void 0===t?void 0:t.value.toLowerCase().includes(e.toLowerCase()),onSelect:e=>{u.onChange(e),null===n||void 0===n||n(e)},onClear:()=>{u.onChange(void 0),null===n||void 0===n||n(void 0)},validationState:g.error?"error":void 0,children:e.map((e=>(0,m.Y)(l.LegacySelect.Option,{value:e,children:e},e)))})}var v=n(98597),y=n(52350);function w(e){return new Map(e.map((e=>[e.key,e])))}var _={name:"82a6rk",styles:"flex:1"},b={name:"82a6rk",styles:"flex:1"};const x=({onSuccess:e,saveTagsHandler:t,allAvailableTags:n,valueRequired:g=!1,title:p})=>{const h=(0,s.useRef)(),[x,S]=(0,s.useState)(""),{theme:C}=(0,r.u)(),[A,I]=(0,s.useState)(new Map),[T,Y]=(0,s.useState)(new Map),[M,N]=(0,s.useState)(!1),E=(0,d.mN)({defaultValues:{key:void 0,value:""}}),R=()=>N(!1),O=(0,s.useCallback)((e=>{h.current=e,I(w(e.tags||[])),Y(w(e.tags||[])),E.reset(),N(!0)}),[E]),P=async()=>{h.current&&(S(""),H(!0),t(h.current,Array.from(A.values()),Array.from(T.values())).then((()=>{R(),null===e||void 0===e||e(),H(!1)})).catch((e=>{var t;H(!1),S(e instanceof y.s?null===(t=e.getUserVisibleError())||void 0===t?void 0:t.message:e.message)})))},D=(0,c.A)(),F=E.watch(),[L,H]=(0,s.useState)(!1),q=(0,s.useMemo)((()=>!(0,a.isEqual)((0,a.sortBy)(Array.from(A.values()),"key"),(0,a.sortBy)(Array.from(T.values()),"key"))),[A,T]),U=F.key||F.value,V=q&&U;return{EditTagsModal:(0,m.FD)(i.d,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_135",destroyOnClose:!0,visible:M,title:null!==p&&void 0!==p?p:(0,m.Y)(u.A,{id:"TBX+Gs",defaultMessage:"Add/Edit tags"}),onCancel:R,footer:(0,m.FD)(r.y,{children:[(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_147",dangerouslyUseFocusPseudoClass:!0,onClick:R,css:(0,o.AH)({marginRight:q?0:C.spacing.sm},""),children:D.formatMessage({id:"2a/rR8",defaultMessage:"Cancel"})}),V?(0,m.Y)(k,{formValues:F,isLoading:L,onSaveTask:P}):(0,m.Y)(l.LegacyTooltip,{title:q?void 0:D.formatMessage({id:"16onEc",defaultMessage:"Please add or remove one or more tags before saving"}),children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_174",dangerouslyUseFocusPseudoClass:!0,disabled:!q,loading:L,type:"primary",onClick:P,children:D.formatMessage({id:"801Xh4",defaultMessage:"Save tags"})})})]}),children:[(0,m.FD)("form",{onSubmit:E.handleSubmit((()=>{if(g&&!F.value.trim())return;const e=new Map(T);e.set(F.key,F),Y(e),E.reset()})),css:(0,o.AH)({display:"flex",alignItems:"flex-end",gap:C.spacing.md},""),children:[(0,m.FD)("div",{css:(0,o.AH)({minWidth:0,display:"flex",gap:C.spacing.md,flex:1},""),children:[(0,m.FD)("div",{css:_,children:[(0,m.Y)(l.FormUI.Label,{htmlFor:"key",children:D.formatMessage({id:"crTWax",defaultMessage:"Key"})}),(0,m.Y)(f,{allAvailableTags:n||[],control:E.control,onKeyChangeCallback:e=>{var t;const n=e?T.get(e):void 0;E.setValue("value",null!==(t=null===n||void 0===n?void 0:n.value)&&void 0!==t?t:"")}})]}),(0,m.FD)("div",{css:b,children:[(0,m.Y)(l.FormUI.Label,{htmlFor:"value",children:g?D.formatMessage({id:"tHrp+A",defaultMessage:"Value"}):D.formatMessage({id:"4B8k46",defaultMessage:"Value (optional)"})}),(0,m.Y)(l.RHFControlledComponents.Input,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_223",name:"value",control:E.control,"aria-label":g?D.formatMessage({id:"tHrp+A",defaultMessage:"Value"}):D.formatMessage({id:"4B8k46",defaultMessage:"Value (optional)"}),placeholder:D.formatMessage({id:"FFe+Ug",defaultMessage:"Type a value"})})]})]}),(0,m.Y)(l.LegacyTooltip,{title:D.formatMessage({id:"tx3aAM",defaultMessage:"Add tag"}),children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_248",htmlType:"submit","aria-label":D.formatMessage({id:"tx3aAM",defaultMessage:"Add tag"}),children:(0,m.Y)(l.PlusIcon,{})})})]}),x&&(0,m.Y)(l.FormUI.Message,{type:"error",message:x}),(0,m.Y)("div",{css:(0,o.AH)({display:"flex",rowGap:C.spacing.xs,flexWrap:"wrap",marginTop:C.spacing.sm},""),children:Array.from(T.values()).map((e=>(0,m.Y)(v.t,{isClosable:!0,tag:e,onClose:()=>(({key:e})=>{Y((t=>(t.delete(e),new Map(t))))})(e)},e.key)))})]}),showEditTagsModal:O,isLoading:L}};var S={name:"1y0ex1",styles:"max-width:400px"};function k({isLoading:e,formValues:t,onSaveTask:n}){const s=(0,c.A)(),{theme:i}=(0,r.u)(),l=`${`${(0,a.truncate)(t.key,{length:20})||"_"}`}${t.value?`:${(0,a.truncate)(t.value,{length:20})}`:""}`,u=s.formatMessage({id:"wcSVYI",defaultMessage:'Are you sure you want to save and close without adding "{tag}"'},{tag:l});return(0,m.FD)(r.ax.Root,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_309",children:[(0,m.Y)(r.ax.Trigger,{asChild:!0,children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_306",dangerouslyUseFocusPseudoClass:!0,loading:e,type:"primary",children:s.formatMessage({id:"801Xh4",defaultMessage:"Save tags"})})}),(0,m.FD)(r.ax.Content,{align:"end","aria-label":u,children:[(0,m.Y)(r.T.Paragraph,{css:S,children:u}),(0,m.Y)(r.ax.Close,{asChild:!0,children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_316",onClick:n,children:s.formatMessage({id:"mv6CY3",defaultMessage:"Yes, save and close"})})}),(0,m.Y)(r.ax.Close,{asChild:!0,children:(0,m.Y)(r.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_324",type:"primary",css:(0,o.AH)({marginLeft:i.spacing.sm},""),children:s.formatMessage({id:"geizp1",defaultMessage:"Cancel"})})}),(0,m.Y)(r.ax.Arrow,{})]})]})}},46932:function(e,t,n){n.d(t,{CL:function(){return G},HW:function(){return g},Hq:function(){return B},I$:function(){return z},LS:function(){return f},MF:function(){return Y},N7:function(){return H},OS:function(){return O},PC:function(){return U},Q0:function(){return F},W0:function(){return P},ZI:function(){return J},bn:function(){return L},f7:function(){return _},g_:function(){return R},h8:function(){return V},ij:function(){return p},in:function(){return $},jW:function(){return M},tC:function(){return h},vL:function(){return w},vl:function(){return D},x0:function(){return W}});var o=n(89555),a=n(9133),s=n(48563),r=n(86494),i=n(92151),l=n(79912),c=n(76901),u=n(36784),d=n(38237),m=n(50111);const g=()=>"User",p=e=>{};function h(e){switch(e){case s.UG.LLM:return s.Dy.MODELS;case s.UG.CHAIN:return s.Dy.CHAIN;case s.UG.AGENT:return s.Dy.AGENT;case s.UG.TOOL:return s.Dy.WRENCH;case s.UG.CHAT_MODEL:return s.Dy.MODELS;case s.UG.RETRIEVER:return s.Dy.SEARCH;case s.UG.PARSER:return s.Dy.CODE;case s.UG.EMBEDDING:return s.Dy.NUMBERS;case s.UG.RERANKER:return s.Dy.SORT;case s.UG.FUNCTION:return s.Dy.FUNCTION;case s.UG.UNKNOWN:return s.Dy.UNKNOWN;default:return s.Dy.FUNCTION}}function f(e){switch(e){case s.UG.LLM:return"LLM";case s.UG.CHAIN:return"Chain";case s.UG.AGENT:return"Agent";case s.UG.TOOL:return"Tool";case s.UG.CHAT_MODEL:return"Chat model";case s.UG.RETRIEVER:return"Retriever";case s.UG.PARSER:return"Parser";case s.UG.EMBEDDING:return"Embedding";case s.UG.RERANKER:return"Reranker";case s.UG.FUNCTION:return"Function";case s.UG.UNKNOWN:return"Unknown";default:return e}}function v(e){try{return JSON.parse(e)}catch(t){return e}}const y=(e,t)=>{if(!t)return[];const n=[],o={inputs:null===e||void 0===e?void 0:e.inputs,outputs:null===e||void 0===e?void 0:e.outputs,attributes:null===e||void 0===e?void 0:e.attributes,events:null===e||void 0===e?void 0:e.events};return(0,a.map)(o,((o,a)=>{if("events"===a)return void n.push(...((e,t)=>{const n=e.events;if(!n)return[];const o=[];return n.forEach(((n,a)=>{const s=n.attributes;s&&Object.keys(s).forEach((r=>{const i=r.toLowerCase().includes(t),l=F(n.name,a,r);i&&o.push({span:e,section:"events",key:l,isKeyMatch:!0,matchIndex:0});const c=JSON.stringify(s[r]).toLowerCase().split(t).length-1;for(let t=0;t<c;t++)o.push({span:e,section:"events",key:l,isKeyMatch:!1,matchIndex:t})}))})),o})(e,t));R(o).forEach((o=>{o.key.toLowerCase().includes(t)&&n.push({span:e,section:a,key:o.key,isKeyMatch:!0,matchIndex:0});const s=o.value.toLowerCase().split(t).length-1;for(let t=0;t<s;t++)n.push({span:e,section:a,key:o.key,isKeyMatch:!1,matchIndex:t})}))})),n};function w(e,t,n){var o,a;const s=t.toLowerCase().trim(),r=Object.values(n.spanTypeDisplayState).every((e=>e));if(""===s&&r)return{filteredTreeNodes:[e],matches:[]};const i=null!==(o=e.children)&&void 0!==o?o:[],l=[],c=[];i.forEach((e=>{const{filteredTreeNodes:t,matches:o}=w(e,s,n);l.push(...t),c.push(...o)}));const u=(null!==(a=e.title)&&void 0!==a?a:"").toLowerCase(),d=y(e,s),m=d.length>0||u.includes(s),g=!e.type||n.spanTypeDisplayState[e.type],p=m&&g,h=l.length>0,f=H(e)>0;return p||n.showParents&&h||n.showExceptions&&f?{filteredTreeNodes:[{...e,children:l}],matches:d.concat(c)}:{filteredTreeNodes:l,matches:c}}function _(e,t){var n;if((0,a.isNil)(t)||(0,a.isNil)(e))return;if(e.key===t)return e;const o=null!==(n=e.children)&&void 0!==n?n:[];for(const a of o){const e=_(a,t);if(e)return e}}const b=(e,t,n,o,s,i)=>{var l,c,u,d,g,p,f,y;const w=v(null===(l=e.attributes)||void 0===l?void 0:l["mlflow.spanType"]),_=v(null===(c=e.attributes)||void 0===c?void 0:c["mlflow.spanInputs"]),b=v(null===(u=e.attributes)||void 0===u?void 0:u["mlflow.spanOutputs"]),x=A(e),S=C(e),k=null!==(d=s[S])&&void 0!==d?d:[];var Y;x||k.push(...null!==(Y=s[""])&&void 0!==Y?Y:[]);const M=v(null===(g=e.attributes)||void 0===g?void 0:g["mlflow.chat.messages"]),N=v(null===(p=e.attributes)||void 0===p?void 0:p["mlflow.message.format"]),E=((e,t,n,o)=>{var s,r;if(Array.isArray(e)&&e.every(z))return(0,a.compact)(e.map(J));const i=null!==(s=B(t,null===o||void 0===o?void 0:o["mlflow.message.format"]))&&void 0!==s?s:[],l=null!==(r=B(n,null===o||void 0===o?void 0:o["mlflow.message.format"]))&&void 0!==r?r:[];return 0!==i.length&&0!==l.length?i.concat(l):void 0})(M,_,b,N?{"mlflow.message.format":N}:void 0),R=((e,t)=>{var n;return Array.isArray(e)&&e.every(U)?e:Array.isArray(null===t||void 0===t?void 0:t.tools)&&null!==t&&void 0!==t&&null!==(n=t.tools)&&void 0!==n&&n.every(U)?t.tools:void 0})(v(null===(f=e.attributes)||void 0===f?void 0:f["mlflow.chat.tools"]),_),O=(0,a.mapValues)((0,a.omitBy)(e.attributes,((e,t)=>t.startsWith("mlflow."))),(e=>v(e))),P=e.events,D=(Number(I(e))-t)/1e3,F=(Number(null!==(y=T(e))&&void 0!==y?y:n)-t)/1e3;return{title:e.name,icon:(0,m.Y)(r.P,{type:h(w),hasException:H(e)>0,isRootSpan:!x}),type:w,key:S,start:D,end:F,children:o,inputs:_,outputs:b,attributes:O,events:P,chatMessages:E,chatTools:R,parentId:x,assessments:k,traceId:i}},x=(e,t)=>{if(t)try{return(e=>{const t=atob(e),n=t.length;let o="";for(let a=0;a<n;a++)o+=t.charCodeAt(a).toString(16).padStart(2,"0");return o})(e)}catch(n){return e}return e.startsWith("0x")?e.slice(2):e};function S(e){return"trace_metadata"in e}function k(e){return"start_time_unix_nano"in e}function C(e){var t,n;return k(e)?x(e.span_id,!0):x(null!==(t=null===(n=e.context)||void 0===n?void 0:n.span_id)&&void 0!==t?t:"",!1)}function A(e){var t;return k(e)?x(e.parent_span_id,!0):x(null!==(t=e.parent_id)&&void 0!==t?t:"",!1)}function I(e){return k(e)?Number(e.start_time_unix_nano):Number(e.start_time)}function T(e){return k(e)?Number(e.end_time_unix_nano):Number(e.end_time)}function Y(e){var t;return S(e.info)?e.info.trace_id:null!==(t=e.info.request_id)&&void 0!==t?t:""}function M(e){var t,n;const o=Y(e),i=null!==(t=null===(n=e.trace_data)||void 0===n?void 0:n.spans)&&void 0!==t?t:e.data.spans,l={},c={};i.forEach((e=>{const t=C(e);l[t]=e,c[t]=[]})),i.forEach((e=>{const t=C(e),n=A(e);if(n){if(!c[n])throw new Error("Tree structure is malformed!");c[n].push(t)}}));const u=i.find((e=>!A(e)));if((0,a.isNil)(u))return null;return function t(n){var a,i,d;const g=l[n],p=Number(I(u)),f=Number(T(u)),v=c[n].map(t),y=N(e.info);if(k(g)||"parent_id"in g)return b(g,p,f,v,y,o);const w=null!==(a=g.span_type)&&void 0!==a?a:s.UG.UNKNOWN;return{title:g.name,icon:(0,m.Y)(r.P,{type:h(w)}),type:w,key:g.context.span_id,start:Number(g.start_time)-p,end:Number(null!==(i=g.end_time)&&void 0!==i?i:f)-p,children:v,inputs:g.inputs,outputs:g.outputs,attributes:g.attributes,events:g.events,parentId:null!==(d=g.parent_id)&&void 0!==d?d:g.parent_span_id,assessments:[],traceId:o}}(C(u))}const N=e=>{let t=[];var n;S(e)?t=null!==(n=e.assessments)&&void 0!==n?n:[]:t=E(e.tags);const o=(0,a.keyBy)(t,"assessment_id");Object.values(o).forEach((e=>{if(e.overrides){const t=o[e.overrides];e.overriddenAssessment=t}})),t=Object.values(o);const s=t.reduce(((e,t)=>{var n;const o=null!==(n=t.span_id)&&void 0!==n?n:"";return e[o]||(e[o]=[]),e[o].push(t),e}),{});return Object.keys(s).forEach((e=>{s[e].sort(((e,t)=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime()))})),s},E=e=>{if(!e)return[];return(Array.isArray(e)?e:Object.entries(e).map((([e,t])=>({key:e,value:t})))).filter((({key:e})=>e.startsWith("mlflow.assessment."))).map((({value:e})=>JSON.parse(e)))};const R=e=>(0,a.isNil)(e)?[]:Array.isArray(e)||(0,a.isString)(e)||(0,a.isNumber)(e)||(0,a.isBoolean)(e)?[{key:"",value:JSON.stringify(e,null,2)}]:Object.entries(e).map((([e,t])=>({key:e,value:JSON.stringify(t,null,2)}))),O=({searchFilter:e,data:t,activeMatchBackgroundColor:n,inactiveMatchBackgroundColor:s,containsActiveMatch:r,activeMatch:i,scrollToActiveMatch:l})=>{const c=new RegExp(`(${(0,a.escapeRegExp)(e.trim())})`,"gi"),u=t.split(c),d=[];let g=0;for(let a=0;a<u.length;a++)if(u[a].toLowerCase().includes(e.toLowerCase().trim())){const e=r&&i.matchIndex===g,t=e?n:s,c=(0,m.Y)("span",{ref:e?l:null,css:(0,o.AH)({backgroundColor:t,scrollMarginTop:50},""),children:u[a]},a);g++,d.push(c)}else d.push(u[a]);return d},P=e=>(0,a.has)(e,"page_content"),D=e=>e.type===s.UG.RETRIEVER&&Array.isArray(e.outputs)&&e.outputs.length>0&&(0,a.every)(e.outputs,P),F=(e,t,n)=>`${e}-${t}-${n}`,L=e=>{var t;return(null!==(t=e.events)&&void 0!==t?t:[]).filter((e=>"exception"===e.name))},H=e=>L(e).length,q=e=>!(0,a.isNil)(e)&&(!(!(0,a.isNil)(e.type)&&!(0,a.isString)(e.type))&&(!(!(0,a.isNil)(e.description)&&!(0,a.isString)(e.description))&&!(!(0,a.isNil)(e.enum)&&!Array.isArray(e.enum)))),U=e=>{var t;if((0,a.isNil)(e)||"function"!==e.type||!(0,a.has)(e,"function.name"))return!1;const n=null===(t=e.function)||void 0===t?void 0:t.parameters;if(!(0,a.isNil)(n)){const e=n.required;if(!(0,a.isNil)(e)&&(!Array.isArray(e)||!e.every(a.isString)))return!1;const t=n.properties;if(!(0,a.isNil)(t)&&!Object.values(t).every(q))return!1}return!0},V=e=>{var t,n;return e&&(0,a.isString)(e.id)&&(0,a.isString)(null===(t=e.function)||void 0===t?void 0:t.arguments)&&(0,a.isString)(null===(n=e.function)||void 0===n?void 0:n.name)},K=e=>!(!(0,a.isNil)(e)&&!(0,a.isString)(e))||!!(0,a.isArray)(e)&&e.every((e=>(e=>{switch(e.type){case"text":case"input_text":case"output_text":return(0,a.isString)(e.text);case"image_url":const{image_url:t}=e;return!(0,a.isNil)(t)&&(0,a.isString)(t.url)&&((0,a.isNil)(t.detail)||["auto","low","high"].includes(t.detail));case"input_audio":const{input_audio:n}=e;return!(0,a.isNil)(n)&&(0,a.isString)(n.data)&&((0,a.isNil)(n.format)||["wav","mp3"].includes(n.format));default:return!1}})(e))),z=e=>{if(!e)return!1;if(e.tool_calls){if(!Array.isArray(e.tool_calls))return!1;if(!e.tool_calls.every(V))return!1}return"reasoning"===e.type||!!K(e.content)&&("user"===e.role||"assistant"===e.role||"system"===e.role||"tool"===e.role)},W=e=>Array.isArray(e)&&e.length>0&&e.every((e=>{return(0,a.has)(e,"message")&&(t=e.message,!!z(t)&&((0,a.isNil)(t.content)||(0,a.isString)(t.content)));var t})),$=e=>e&&W(e.choices),B=(e,t)=>{var n,o,s,r,m,g,p,h,f,v,y,w;try{if(Array.isArray(e)&&e.length>0&&e.every(z))return(0,a.compact)(e.map(J));switch(t){case"langchain":const t=null!==(n=(0,i.HD)(e))&&void 0!==n?n:(0,i.oI)(e);if(t)return t;break;case"llamaindex":const a=null!==(o=(0,l.H)(e))&&void 0!==o?o:(0,i.W3)(e);if(a)return a;break;case"openai":const _=null!==(s=null!==(r=null!==(m=(0,i.a8)(e))&&void 0!==m?m:(0,i.bS)(e))&&void 0!==r?r:(0,i.n_)(e))&&void 0!==s?s:(0,i.AG)(e);if(_)return _;break;case"dspy":const b=null!==(g=(0,i.iU)(e))&&void 0!==g?g:(0,i.Pn)(e);if(b)return b;break;case"gemini":const x=null!==(p=(0,i.DE)(e))&&void 0!==p?p:(0,i.Sy)(e);if(x)return x;break;case"anthropic":const S=null!==(h=(0,i.KF)(e))&&void 0!==h?h:(0,i.pL)(e);if(S)return S;break;case"openai-agent":const k=null!==(f=(0,c.xW)(e))&&void 0!==f?f:(0,c.m$)(e);if(k)return k;break;case"autogen":const C=null!==(v=(0,u.n)(e))&&void 0!==v?v:(0,u.u)(e);if(C)return C;break;case"bedrock":const A=null!==(y=(0,d.Y)(e))&&void 0!==y?y:(0,d.f)(e);if(A)return A;break;default:const I=null!==(w=(0,i.a8)(e))&&void 0!==w?w:(0,i.bS)(e);if(I)return I}return null}catch(_){return null}},G=e=>{var t;let n=null===(t=e.function)||void 0===t?void 0:t.arguments;try{n=JSON.stringify(JSON.parse(n),null,2)}catch(o){}return{id:e.id,function:{arguments:n,name:e.function.name}}},j=e=>{if((0,a.isNil)(e)||(0,a.isString)(e))return e;return e.map((e=>{var t;switch(e.type){case"text":case"input_text":case"output_text":return e.text;case"image_url":const n=null===e||void 0===e||null===(t=e.image_url)||void 0===t?void 0:t.url;return n?`![](${n})`:"[image]";case"input_audio":return"[audio]"}})).filter((e=>void 0!==e)).join("\n\n")},J=e=>{var t;return"reasoning"===e.type?null:{...e,content:j(e.content),tool_calls:null===(t=e.tool_calls)||void 0===t?void 0:t.map(G)}}},48563:function(e,t,n){n.d(t,{Dy:function(){return a},UG:function(){return o},cC:function(){return s}});let o=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.FUNCTION="FUNCTION",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.UNKNOWN="UNKNOWN",e}({}),a=function(e){return e.MODELS="models",e.DOCUMENT="document",e.CONNECT="connect",e.SEARCH="search",e.SORT="sort",e.UNKNOWN="unknown",e.FUNCTION="function",e.CODE="code",e.NUMBERS="numbers",e.WRENCH="wrench",e.AGENT="agent",e.CHAIN="chain",e.USER="user",e.SYSTEM="system",e}({}),s=function(e){return e.JSON="json",e.TEXT="text",e.MARKDOWN="markdown",e}({})},51455:function(e,t,n){n.d(t,{A:function(){return r},S:function(){return i}});var o=n(31014),a=n(50111);const s=(0,o.createContext)({}),r=({children:e,introductionText:t,displayVersionWarnings:n})=>(0,a.Y)(s.Provider,{value:{introductionText:t,displayVersionWarnings:n},children:e}),i=()=>(0,o.useContext)(s)},80171:function(e,t,n){n.d(t,{Ab:function(){return y},CF:function(){return p},Db:function(){return g},Mq:function(){return d},Nh:function(){return s},YO:function(){return v},_H:function(){return h},cS:function(){return i},dY:function(){return m},h:function(){return u},oj:function(){return c},se:function(){return f},y:function(){return l}});var o=n(69526),a=n(9133);const s="mlflow.traceName",r=(e,t)=>{var n,o;return null===(n=e.request_metadata)||void 0===n||null===(o=n.find((({key:e})=>e===t)))||void 0===o?void 0:o.value},i=e=>e.length>=250,l=e=>r(e,"mlflow.sourceRun"),c=e=>r(e,"total_tokens"),u=e=>{const t=r(e,"mlflow.traceInputs");if(!(0,a.isNil)(t))try{return JSON.stringify(JSON.parse(t))}catch(n){return t}},d=e=>{const t=r(e,"mlflow.traceOutputs");if(!(0,a.isNil)(t))try{return JSON.stringify(JSON.parse(t))}catch(n){return t}},m=(e,t)=>{var n,o,a;return Array.isArray(e.tags)?null===(o=e.tags)||void 0===o||null===(a=o.find((({key:e})=>e===t)))||void 0===a?void 0:a.value:null===(n=e.tags)||void 0===n?void 0:n[t]},g=e=>m(e,s)||e.request_id,p=["timestamp_ms"],h="select";let f=function(e){return e.requestId="request_id",e.traceName="traceName",e.timestampMs="timestamp_ms",e.inputs="inputs",e.outputs="outputs",e.runName="runName",e.totalTokens="total_tokens",e.source="source",e.latency="latency",e.tags="tags",e.status="status",e}({});const v={[f.requestId]:(0,o.zR)({id:"0HqSXX",defaultMessage:"Request ID"}),[f.traceName]:(0,o.zR)({id:"60C/WF",defaultMessage:"Trace name"}),[f.timestampMs]:(0,o.zR)({id:"V3BImd",defaultMessage:"Time created"}),[f.status]:(0,o.zR)({id:"PBkS4s",defaultMessage:"Status"}),[f.inputs]:(0,o.zR)({id:"TQZ+X6",defaultMessage:"Request"}),[f.outputs]:(0,o.zR)({id:"pHAqL+",defaultMessage:"Response"}),[f.runName]:(0,o.zR)({id:"yltHdB",defaultMessage:"Run name"}),[f.totalTokens]:(0,o.zR)({id:"O5FKCr",defaultMessage:"Tokens"}),[f.source]:(0,o.zR)({id:"eM4+ab",defaultMessage:"Source"}),[f.latency]:(0,o.zR)({id:"6oYktw",defaultMessage:"Execution time"}),[f.tags]:(0,o.zR)({id:"4qVc2+",defaultMessage:"Tags"})},y={UNSET:null,IN_PROGRESS:(0,o.zR)({id:"y56Vz9",defaultMessage:"In progress"}),OK:(0,o.zR)({id:"Mn7Kss",defaultMessage:"OK"}),ERROR:(0,o.zR)({id:"igK5Su",defaultMessage:"Error"})}},83946:function(e,t,n){n.d(t,{O:function(){return Me}});var o=n(89555),a=n(13062),s=n(31014),r=n(63528),i=n(80171),l=n(50361),c=n(9133);const u="request_metadata.`mlflow.sourceRun`",d="request_metadata.`mlflow.modelId`",m=e=>`run_id IN (${e.map((e=>`'${e}'`)).join(",")})`,g=({experimentIds:e,sorting:t,filter:n="",runUuid:o,loggedModelId:a})=>{const[g,p]=(0,s.useState)([]),[h,f]=(0,s.useState)(!0),[v,y]=(0,s.useState)(void 0),w=(0,s.useMemo)((()=>{const e=(0,c.first)(t);return e&&i.CF.includes(e.id)?`${e.id} ${e.desc?"DESC":"ASC"}`:"timestamp_ms DESC"}),[t]),_=(0,s.useMemo)((()=>o||a?a?n?`${n} AND ${d}='${a}'`:`${d}='${a}'`:n?`${n} AND ${u}='${o}'`:`${u}='${o}'`:n),[n,o,a]),[b,x]=(0,s.useState)({0:void 0}),[S,k]=(0,s.useState)(0),C=b[S],A=(0,s.useCallback)((async({experimentIds:e,currentPage:t=0,pageToken:n,silent:o,orderByString:a="",filterString:s=""})=>{o||f(!0),y(void 0);try{const o=await r.x.getExperimentTraces(e,a,n,s);if(!o.traces)return void p([]);const u=await(async(e,t)=>{const n=t.reduce(((e,t)=>{const n=t.request_id,o=(0,i.y)(t);return n&&o?{...e,[n]:o}:e}),{}),o=(0,c.uniq)((0,c.values)(n));if(o.length<1)return{};const a=((await r.x.searchRuns({experiment_ids:e,filter:m(o),run_view_type:l.qi.ALL})).runs||[]).reduce(((e,t)=>({...e,[t.info.runUuid]:t.info.runName})),{});return t.reduce(((e,t)=>{const o=t.request_id;if(!o)return e;const s=n[o];return{...e,[o]:a[s]||s}}),{})})(e,o.traces),d=o.traces.map((e=>{const t=e.request_id;if(!t)return{...e};const n=u[t];return{...e,runName:n}}));p(d),x((e=>({...e,[t+1]:o.next_page_token})))}catch(u){y(u)}finally{f(!1)}}),[]),I=!h&&void 0!==b[S+1],T=!h&&(1===S||void 0!==b[S-1]);(0,s.useEffect)((()=>{A({experimentIds:e,filterString:_,orderByString:w})}),[A,_,e,w]);const Y=(0,s.useCallback)((()=>{p([]),x({0:void 0}),k(0),A({experimentIds:e})}),[A,e]);return{traces:g,loading:h,error:v,hasNextPage:I,hasPreviousPage:T,fetchNextPage:(0,s.useCallback)((()=>{k((e=>e+1)),A({experimentIds:e,currentPage:S+1,pageToken:b[S+1],filterString:_,orderByString:w})}),[e,S,A,b,_,w]),fetchPrevPage:(0,s.useCallback)((()=>{k((e=>e-1)),A({experimentIds:e,currentPage:S-1,pageToken:b[S-1],filterString:_,orderByString:w})}),[e,S,A,b,_,w]),refreshCurrentPage:(0,s.useCallback)(((t=!1)=>A({experimentIds:e,currentPage:S,pageToken:C,silent:t,filterString:_,orderByString:w})),[e,S,A,C,_,w]),reset:Y}};var p=n(37523),h=n(70618),f=n(9856),v=n(76010),y=n(93215),w=n(52350),_=n(58481),b=n(88464),x=n(88443),S=n(98590),k=n(98597),C=n(50111);var A={name:"1wcfv52",styles:"margin-right:0"},I={name:"14cnl6e",styles:"flex-shrink:0;opacity:0;[role=row]:hover &{opacity:1;}[role=row]:focus-within &{opacity:1;}"};const T=({onAddEditTags:e,tags:t,baseComponentId:n})=>{const{theme:s}=(0,a.u)(),r=(null===t||void 0===t?void 0:t.filter((({key:e})=>e&&!e.startsWith(S.nt))))||[],i=r.length>0;return(0,C.FD)("div",{css:(0,o.AH)({display:"flex",alignItems:"center",flexWrap:"wrap",columnGap:s.spacing.xs,rowGap:s.spacing.xs},""),children:[r.map((e=>(0,C.Y)(k.t,{tag:e,css:A,charLimit:20,maxWidth:150,enableFullViewModal:!0},e.key)))," ",(0,C.Y)(a.B,{componentId:`${n}.traces_table.edit_tag`,size:"small",icon:i?(0,C.Y)(p.PencilIcon,{}):void 0,onClick:e,children:i?void 0:(0,C.Y)(x.A,{id:"vHNP+J",defaultMessage:"Add tags"}),css:I,type:"tertiary"})]})};var Y=n(40553);const M=(e,t)=>"IN_PROGRESS"===e?(0,C.Y)(Y.C,{css:(0,o.AH)({color:t.colors.textValidationWarning},"")}):"OK"===e?(0,C.Y)(p.CheckCircleIcon,{css:(0,o.AH)({color:t.colors.textValidationSuccess},"")}):"ERROR"===e?(0,C.Y)(p.XCircleIcon,{css:(0,o.AH)({color:t.colors.textValidationDanger},"")}):null,N=({row:{original:e}})=>{const{theme:t}=(0,a.u)(),n=(0,b.A)(),s=i.Ab[e.status||"UNSET"];return(0,C.FD)("div",{css:(0,o.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center"},""),children:[M(e.status,t),s?n.formatMessage(s):""]})};var E=n(27193);const R={name:"rthgne",styles:"display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical"};var O={name:"ozd7xs",styles:"flex-shrink:0"};const P=({value:e,traceId:t,previewFieldName:n})=>{const{theme:l}=(0,a.u)(),[u,d]=(0,s.useState)(!1),[m,g]=(0,s.useState)(null),[h,f]=(0,s.useState)(!1),y=(0,s.useCallback)((async()=>{f(!0);try{const e=await r.x.getExperimentTraceData(t);if(n in e){const t=e[n],o=(0,c.isString)(t)?t:JSON.stringify(t);g(o)}}catch(e){const t=e instanceof w.s?e.getUserVisibleError():e.message;v.A.logErrorAndNotifyUser(`Error fetching response: ${t}`)}f(!1)}),[n,t]),_=(0,i.cS)(e),b=(0,s.useCallback)((async()=>{!m&&_&&await y(),d(!0)}),[m,y,_]),x=(0,s.useCallback)((()=>{d(!1)}),[]);return(0,C.FD)("div",{css:(0,o.AH)({display:"flex",gap:l.spacing.xs},""),children:[(0,C.Y)(a.B,{componentId:"mlflow.traces.traces_table.expand_cell_preview",size:"small",icon:u?(0,C.Y)(p.ChevronDownIcon,{}):(0,C.Y)(a.q,{}),onClick:u?x:b,css:O,loading:h,type:"primary"}),(0,C.Y)("div",{title:e,css:["overflow:hidden;text-overflow:ellipsis;",!u&&R,""],children:u?(0,C.Y)(D,{value:null!==m&&void 0!==m?m:e}):e})]})},D=({value:e})=>{const{theme:t}=(0,a.u)(),n=(0,s.useMemo)((()=>{try{const t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(t){return null}}),[e]);return(0,C.Y)("div",{css:(0,o.AH)({whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:n?"monospace":void 0},""),children:(0,C.Y)(E.z7,{language:"json",wrapLongLines:!0,style:{padding:t.spacing.sm},theme:t.isDarkMode?"duotoneDark":"light",children:n||e})})},F=({row:{original:e}})=>(0,C.Y)(P,{previewFieldName:"request",traceId:e.request_id||"",value:(0,i.h)(e)||""}),L=({row:{original:e}})=>(0,C.Y)(P,{previewFieldName:"response",traceId:e.request_id||"",value:(0,i.Mq)(e)||""});var H=n(15164);const q=({row:{original:e}})=>(0,C.Y)(H.t,{value:(0,c.keyBy)(e.tags,"key")}),U=e=>`--header-${e}-size`,V=e=>`--col-${e}-size`,K=s.memo((({row:e})=>{const{theme:t}=(0,a.u)();return(0,C.Y)("div",{role:"row","data-testid":"endpoints-list-table-rows",css:(0,o.AH)({minHeight:t.general.buttonHeight,display:"flex",flexDirection:"row",":hover":{backgroundColor:"var(--table-row-hover)"},paddingRight:"32px",borderBottom:"1px solid var(--table-separator-color)"},""),children:e.getAllCells().map((e=>{var n,o;const a=null===(n=e.column.columnDef.meta)||void 0===n?void 0:n.multiline,s=e.column.id===i._H?t.spacing.sm:`${t.spacing.sm}px ${t.spacing.xs}px`;return(0,C.Y)("div",{role:"cell",css:[{"--table-row-vertical-padding":`${t.spacing.sm}px`,flex:`calc(var(${V(e.column.id)}) / 100)`,overflow:"hidden",whiteSpace:a?"pre-wrap":"nowrap",textOverflow:a?"ellipsis":void 0,padding:s},null===(o=e.column.columnDef.meta)||void 0===o?void 0:o.styles,""],children:(0,h.Kv)(e.column.columnDef.cell,e.getContext())},e.id)}))},e.id)}),((e,t)=>e.columns===t.columns&&e.selected===t.selected&&(0,c.isEqual)(e.row.original.tags,t.row.original.tags))),z=s.memo((({row:{original:e}})=>e.timestamp_ms?(0,C.Y)(p.LegacyTooltip,{title:new Date(e.timestamp_ms).toLocaleString(navigator.language,{timeZoneName:"short"}),placement:"right",children:(0,C.Y)("span",{children:v.A.timeSinceStr(e.timestamp_ms)})}):null),(()=>!0)),W=({table:e})=>{const t=e.getIsAllRowsSelected()||!!e.getIsSomeRowsSelected()&&null;return(0,C.Y)(p.Checkbox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewtableheadercheckbox.tsx_14","data-testid":"trace-table-header-checkbox",isChecked:t,wrapperStyle:{padding:0,margin:0},onChange:e.toggleAllRowsSelected})},$=({row:e})=>(0,C.Y)(p.Checkbox,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewtablecellcheckbox.tsx_12","data-testid":`trace-table-cell-checkbox-${e.id}`,disabled:!e.getCanSelect(),isChecked:e.getIsSelected(),wrapperStyle:{padding:0,margin:0},onChange:()=>e.toggleSelected()});var B=n(56412);var G={name:"ddxhyk",styles:"max-width:800px"},j={name:"ddxhyk",styles:"max-width:800px"};const J={openai:{minVersion:"2.15.1",getContent:()=>(0,C.Y)(x.A,{id:"smtq2M",defaultMessage:"Automatically log traces for OpenAI API calls by calling the {code} function. For example:",values:{code:(0,C.Y)("code",{children:"mlflow.openai.autolog()"})}}),getCodeSource:()=>'from openai import OpenAI\n\nmlflow.openai.autolog()\n\n# Ensure that the "OPENAI_API_KEY" environment variable is set\nclient = OpenAI()\n\nmessages = [\n  {"role": "system", "content": "You are a helpful assistant."},\n  {"role": "user", "content": "Hello!"}\n]\n\n# Inputs and outputs of the API request will be logged in a trace\nclient.chat.completions.create(model="gpt-4o-mini", messages=messages)'},langchain:{minVersion:"2.17.2",getContent:()=>(0,C.Y)(x.A,{id:"7/urtn",defaultMessage:"Automatically log traces for LangChain or LangGraph invocations by calling the {code} function. For example:",values:{code:(0,C.Y)("code",{children:"mlflow.langchain.autolog()"})}}),getCodeSource:()=>'from langchain_openai import OpenAI\nfrom langchain_core.prompts import PromptTemplate\n\nmlflow.langchain.autolog()\n\n# Ensure that the "OPENAI_API_KEY" environment variable is set\nllm = OpenAI()\nprompt = PromptTemplate.from_template("Answer the following question: {question}")\nchain = prompt | llm\n\n# Invoking the chain will cause a trace to be logged\nchain.invoke("What is MLflow?")'},llama_index:{minVersion:"2.15.1",getContent:()=>(0,C.Y)(x.A,{id:"/v6KuF",defaultMessage:"Automatically log traces for LlamaIndex queries by calling the {code} function. For example:",values:{code:(0,C.Y)("code",{children:"mlflow.llama_index.autolog()"})}}),getCodeSource:()=>'from llama_index.core import Document, VectorStoreIndex\n\nmlflow.llama_index.autolog()\n\n# Ensure that the "OPENAI_API_KEY" environment variable is set\nindex = VectorStoreIndex.from_documents([Document.example()])\nquery_engine = index.as_query_engine()\n\n# Querying the engine will cause a trace to be logged\nquery_engine.query("What is LlamaIndex?")'},dspy:{minVersion:"2.18.0",getContent:()=>(0,C.Y)(x.A,{id:"h1HQ14",defaultMessage:"Automatically log traces for DSPy executions by calling the {code} function. For example:",values:{code:(0,C.Y)("code",{children:"mlflow.dspy.autolog()"})}}),getCodeSource:()=>'import dspy\n\nmlflow.dspy.autolog()\n\n# Configure the LLM to use. Please ensure that\n# the OPENAI_API_KEY environment variable is set\nlm = dspy.LM("openai/gpt-4o-mini")\ndspy.configure(lm=lm)\n\n# Define a simple chain-of-thought model and run it\nmath = dspy.ChainOfThought("question -> answer: float")\nquestion = "Two dice are tossed. What is the probability that the sum equals two?"\n\n# All intermediate outputs from the execution will be logged\nmath(question=question)'},crewai:{minVersion:"2.19.0",getContent:()=>(0,C.Y)(x.A,{id:"K8LdMX",defaultMessage:"Automatically log traces for CrewAI executions by calling the {code} function. For example:",values:{code:(0,C.Y)("code",{children:"mlflow.crewai.autolog()"})}}),getCodeSource:()=>'from crewai import Agent, Crew, Process, Task\n\nmlflow.crewai.autolog()\n\ncity_selection_agent = Agent(\n    role="City selection expert",\n    goal="Select the best city based on weather, season, and prices",\n    backstory="An expert in analyzing travel data to pick ideal destinations",\n    allow_delegation=True,\n    verbose=True,\n)\n\nlocal_expert = Agent(\n    role="Local expert",\n    goal="Provide the best insights about the selected city",\n    backstory="A local guide with extensive information about the city",\n    verbose=True,\n)\n  \nplan_trip = Task(\n    name="Plan a trip",\n    description="""Plan a trip to a city based on weather, prices, and best local attractions. \n    Please consult with a local expert when researching things to do.""",\n    expected_output="A short summary of the trip destination and key things to do",\n    agent=city_selection_agent,\n)\n\ncrew = Crew(\n  agents=[\n    city_selection_agent,\n    local_expert,\n  ],\n  tasks=[plan_trip],\n  process=Process.sequential\n)\n\n# Ensure the "OPENAI_API_KEY" environment variable is set\n# before kicking off the crew. All intermediate agent outputs\n# will be logged in the resulting trace.\ncrew.kickoff()'},autogen:{minVersion:"2.16.2",getContent:()=>(0,C.Y)(x.A,{id:"i/pJvo",defaultMessage:"Automatically log traces for AutoGen conversations by calling the {code} function. For example:",values:{code:(0,C.Y)("code",{children:"mlflow.autogen.autolog()"})}}),getCodeSource:()=>'import os\nfrom autogen import AssistantAgent, UserProxyAgent\n\nmlflow.autogen.autolog()\n\n# Ensure that the "OPENAI_API_KEY" environment variable is set\nllm_config = { "model": "gpt-4o-mini", "api_key": os.environ["OPENAI_API_KEY"] }\nassistant = AssistantAgent("assistant", llm_config = llm_config)\nuser_proxy = UserProxyAgent("user_proxy", code_execution_config = False)\n\n# All intermediate executions within the chat session will be logged\nuser_proxy.initiate_chat(assistant, message = "What is MLflow?", max_turns = 1)'},anthropic:{minVersion:"2.19.0",getContent:()=>(0,C.Y)(x.A,{id:"AzOnmT",defaultMessage:"Automatically log traces for Anthropic API calls by calling the {code} function. For example:",values:{code:(0,C.Y)("code",{children:"mlflow.anthropic.autolog()"})}}),getCodeSource:()=>'import os\nimport anthropic\n\n# Enable auto-tracing for Anthropic\nmlflow.anthropic.autolog()\n\n# Configure your API key (please ensure that the "ANTHROPIC_API_KEY" environment variable is set)\nclient = anthropic.Anthropic(api_key=os.environ["ANTHROPIC_API_KEY"])\n\n# Inputs and outputs of API calls will be logged as a trace\nmessage = client.messages.create(\n    model="claude-3-5-sonnet-20241022",\n    max_tokens=1024,\n    messages=[\n        {"role": "user", "content": "Hello, Claude"},\n    ],\n)'},bedrock:{minVersion:"2.20.0",getContent:()=>(0,C.Y)(x.A,{id:"6tKW1I",defaultMessage:"Automatically log traces for Bedrock conversations by calling the {code} function. For example:",values:{code:(0,C.Y)("code",{children:"mlflow.bedrock.autolog()"})}}),getCodeSource:()=>'import boto3\n\nmlflow.bedrock.autolog()\n\n# Ensure that your boto3 client has the necessary auth information\nbedrock = boto3.client(\n    service_name="bedrock-runtime",\n    region_name="<REPLACE_WITH_YOUR_AWS_REGION>",\n)\n\nmodel = "anthropic.claude-3-5-sonnet-20241022-v2:0"\nmessages = [{ "role": "user", "content": [{"text": "Hello!"}]}]\n\n# All intermediate executions within the chat session will be logged\nbedrock.converse(modelId=model, messages=messages)'},litellm:{minVersion:"2.18.0",getContent:()=>(0,C.Y)(x.A,{id:"D7SSDK",defaultMessage:"Automatically log traces for LiteLLM API calls by calling the {code} function. For example:",values:{code:(0,C.Y)("code",{children:"mlflow.litellm.autolog()"})}}),getCodeSource:()=>'import litellm\n\nmlflow.litellm.autolog()\n\n# Ensure that the "OPENAI_API_KEY" environment variable is set\nmessages = [{"role": "user", "content": "Hello!"}]\n\n# Inputs and outputs of the API request will be logged in a trace\nlitellm.completion(model="gpt-4o-mini", messages=messages)'},gemini:{minVersion:"2.18.0",getContent:()=>(0,C.Y)(x.A,{id:"IsIgE2",defaultMessage:"Automatically log traces for Gemini conversations by calling the {code} function. For example:",values:{code:(0,C.Y)("code",{children:"mlflow.gemini.autolog()"})}}),getCodeSource:()=>'import google.genai as genai\n\nmlflow.gemini.autolog()\n\n# Replace "GEMINI_API_KEY" with your API key\nclient = genai.Client(api_key="GEMINI_API_KEY")\n\n# Inputs and outputs of the API request will be logged in a trace\nclient.models.generate_content(model="gemini-1.5-flash", contents="Hello!")'},custom:{minVersion:"2.14.3",getContent:e=>(0,C.FD)(C.FK,{children:[(0,C.Y)(a.T.Paragraph,{css:G,children:(0,C.Y)(x.A,{id:"3Z6K+n",defaultMessage:"To manually instrument your own traces, the most convenient method is to use the {code} function decorator. This will cause the inputs and outputs of the function to be captured in the trace.",values:{code:(0,C.Y)("code",{children:"@mlflow.trace"})}})}),(0,C.Y)(a.T.Paragraph,{css:j,children:(0,C.Y)(x.A,{id:"WNz02j",defaultMessage:"For more complex use cases, MLflow also provides granular APIs that can be used to control tracing behavior. For more information, please visit the <a>official documentation</a> on fluent and client APIs for MLflow Tracing.",values:{a:t=>(0,C.Y)(a.T.Link,{title:"official documentation",componentId:`${e}.traces_table.custom_tracing_docs_link`,href:"https://mlflow.org/docs/latest/llms/tracing/index.html#tracing-fluent-apis",openInNewTab:!0,children:t})}})})]}),getCodeSource:()=>'@mlflow.trace\ndef foo(a):\nreturn a + bar(a)\n\n# Various attributes can be passed to the decorator\n# to modify the information contained in the span\n@mlflow.trace(name = "custom_name", attributes = { "key": "value" })\ndef bar(b):\nreturn b + 1\n\n# Invoking the traced function will cause a trace to be logged\nfoo(1)'}};var X=n(51455);var Q={name:"ddxhyk",styles:"max-width:800px"},Z={name:"1hyob9y",styles:"position:relative;width:min-content"};const ee=({flavorName:e,baseComponentId:t})=>{const{theme:n}=(0,a.u)(),{getContent:s,getCodeSource:r,minVersion:i}=J[e],{displayVersionWarnings:l=!0}=(0,X.S)(),c=s(t),u=`import mlflow\nfrom packaging.version import Version\n\nassert Version(mlflow.__version__) >= Version("${i}"), (\n  "This feature requires MLflow version ${i} or newer. "\n  "Please run '%pip install -U mlflow' in a notebook cell, "\n  "and restart the kernel when the command finishes."\n)\n\n`+r(),d=(0,C.Y)(x.A,{id:"YfspJh",defaultMessage:"This example requires MLflow version {minVersion} or newer. Please run {installCommand} in a notebook cell if your MLflow version is older than this, and restart the kernel when the command finishes.",values:{minVersion:i,installCommand:(0,C.Y)(a.T.Text,{code:!0,children:"%pip install -U mlflow"})}});return(0,C.FD)("div",{children:[l&&(0,C.Y)(p.Alert,{componentId:`${t}.traces_table.${e}_quickstart_alert`,css:(0,o.AH)({marginBottom:n.spacing.md,maxWidth:800},""),closable:!1,message:(0,C.Y)(x.A,{id:"NoYMjZ",defaultMessage:"Requires MLflow >= {minVersion}",values:{minVersion:i}}),description:d,type:"info"}),(0,C.Y)(a.T.Text,{css:Q,children:c}),(0,C.FD)("div",{css:Z,children:[(0,C.Y)(B.i,{componentId:`${t}.traces_table.${e}_quickstart_snippet_copy`,css:(0,o.AH)({zIndex:1,position:"absolute",top:n.spacing.xs,right:n.spacing.xs},""),showLabel:!1,copyText:u,icon:(0,C.Y)(p.CopyIcon,{})}),(0,C.Y)(E.z7,{showLineNumbers:!0,theme:n.isDarkMode?"duotoneDark":"light",style:{padding:`${n.spacing.sm}px ${n.spacing.md}px`,marginTop:n.spacing.md},language:"python",children:u})]})]})},te=({baseComponentId:e,runUuid:t})=>{const{theme:n}=(0,a.u)(),{introductionText:s}=(0,X.S)();return(0,C.FD)("div",{css:(0,o.AH)({overflow:"auto",paddingBottom:n.spacing.lg},""),children:[(0,C.Y)(p.Header,{title:(0,C.Y)(x.A,{id:"6d5JTO",defaultMessage:"No traces recorded"}),titleElementLevel:3}),(0,C.Y)(a.T.Text,{css:(0,o.AH)({display:"block",marginTop:n.spacing.md,marginBottom:n.spacing.md,maxWidth:800},""),children:s||(0,C.Y)(x.A,{id:"msYDmK",defaultMessage:"This tab displays all the traces logged to this {isRun, select, true {run} other {experiment}}. Follow the steps below to log your first trace. For more information about MLflow Tracing, visit the <a>MLflow documentation</a>.",values:{isRun:!(0,c.isNil)(t),a:t=>(0,C.Y)(a.T.Link,{componentId:`${e}.traces_table.quickstart_docs_link`,href:"https://mlflow.org/docs/latest/llms/tracing/index.html",openInNewTab:!0,children:t})}})}),(0,C.Y)(ee,{flavorName:"custom",baseComponentId:e})]})};var ne=n(91144);var oe={name:"s09txq",styles:"max-width:100%;text-overflow:ellipsis"};const ae=({row:{original:e},table:{options:{meta:t}}})=>{const{baseComponentId:n,onTraceClicked:o}=t;return(0,C.Y)(a.T.Link,{componentId:`${n}.traces_table.request_id_link`,ellipsis:!0,css:oe,onClick:()=>{null===o||void 0===o||o(e)},children:e.request_id})};var se={name:"s09txq",styles:"max-width:100%;text-overflow:ellipsis"};const re=({row:{original:e},table:{options:{meta:t}}})=>{const{baseComponentId:n,onTraceClicked:o}=t;return(0,C.Y)(a.T.Link,{componentId:`${n}.traces_table.trace_name_link`,ellipsis:!0,css:se,onClick:()=>{null===o||void 0===o||o(e)},children:(0,i.dY)(e,i.Nh)})};var ie={name:"hgn0g7",styles:"max-width:100%;text-overflow:ellipsis;display:inline-block;overflow:hidden"};const le=({row:{original:e}})=>{const t=(0,i.y)(e);if(!t||!e.experiment_id)return null;const n=e.runName||t;return(0,C.Y)(y.N_,{css:ie,to:_.Ay.getRunPageRoute(e.experiment_id,t),children:n})},ce=({row:{original:e},table:{options:{meta:t}}})=>{const{onTraceTagsEdit:n,baseComponentId:o}=t;return(0,C.Y)(T,{tags:e.tags||[],onAddEditTags:()=>null===n||void 0===n?void 0:n(e),baseComponentId:o})};var ue={name:"s09txq",styles:"max-width:100%;text-overflow:ellipsis"},de={name:"s09txq",styles:"max-width:100%;text-overflow:ellipsis"},me={name:"hgn0g7",styles:"max-width:100%;text-overflow:ellipsis;display:inline-block;overflow:hidden"};const ge=s.memo((({experimentIds:e,runUuid:t,traces:n,loading:o,error:r,onTraceClicked:l,onTraceTagsEdit:u,hasNextPage:d,hasPreviousPage:m,onNextPage:g,onPreviousPage:S,usingFilters:k,onResetFilters:A,sorting:I,setSorting:Y,rowSelection:M,setRowSelection:E,hiddenColumns:R=[],disableTokenColumn:O,baseComponentId:P,toggleHiddenColumn:D,disabledColumns:H=[]})=>{const B=(0,b.A)(),{theme:G}=(0,a.u)(),j=!o&&0===n.length&&!k&&!r,J=(0,ne.rR)(),X=(0,s.useMemo)((()=>(0,c.entries)(i.YO).map((([e,t])=>({key:e,label:B.formatMessage(t)}))).filter((({key:e})=>!H.includes(e)))),[B,H]),Q=(0,s.useMemo)((()=>{if(j)return[];const e=[{id:i._H,header:W,enableResizing:!1,enableSorting:!1,cell:$,meta:{styles:{minWidth:32,maxWidth:32}}},{header:B.formatMessage(i.YO[i.se.requestId]),enableSorting:!1,enableResizing:!0,id:i.se.requestId,cell:J?ae:({row:{original:e}})=>(0,C.Y)(a.T.Link,{componentId:`${P}.traces_table.request_id_link`,ellipsis:!0,css:ue,onClick:()=>{null===l||void 0===l||l(e)},children:e.request_id}),meta:{styles:{minWidth:200}}},{header:B.formatMessage(i.YO[i.se.traceName]),enableSorting:!1,enableResizing:!0,id:i.se.traceName,cell:J?re:({row:{original:e}})=>(0,C.Y)(a.T.Link,{componentId:`${P}.traces_table.trace_name_link`,ellipsis:!0,css:de,onClick:()=>{null===l||void 0===l||l(e)},children:(0,i.dY)(e,i.Nh)}),meta:{styles:{minWidth:150}}},{header:B.formatMessage(i.YO[i.se.timestampMs]),id:i.se.timestampMs,accessorFn:e=>e.timestamp_ms,enableSorting:!0,enableResizing:!0,cell:z,meta:{styles:{minWidth:100}}},{header:B.formatMessage(i.YO[i.se.status]),id:i.se.status,enableSorting:!1,enableResizing:!0,cell:N,meta:{styles:{minWidth:100}}},{header:B.formatMessage(i.YO[i.se.inputs]),id:i.se.inputs,enableSorting:!1,enableResizing:!0,cell:F,meta:{multiline:!0}},{header:B.formatMessage(i.YO[i.se.outputs]),enableSorting:!1,enableResizing:!0,id:i.se.outputs,cell:L,meta:{multiline:!0}},{header:B.formatMessage(i.YO[i.se.runName]),enableSorting:!1,enableResizing:!0,id:i.se.runName,cell:J?le:({row:{original:e}})=>{const t=(0,i.y)(e);if(!t||!e.experiment_id)return null;const n=e.runName||t;return(0,C.Y)(y.N_,{css:me,to:_.Ay.getRunPageRoute(e.experiment_id,t),children:n})}},{header:B.formatMessage(i.YO[i.se.source]),enableSorting:!0,enableResizing:!0,id:i.se.source,cell:q,meta:{styles:{minWidth:100}}}];return O||e.push({header:B.formatMessage(i.YO[i.se.totalTokens]),enableSorting:!1,enableResizing:!0,id:i.se.totalTokens,accessorFn:e=>(0,i.oj)(e),meta:{styles:{minWidth:80,maxWidth:80}}}),e.push({header:B.formatMessage(i.YO[i.se.latency]),enableSorting:!1,enableResizing:!0,id:i.se.latency,accessorFn:e=>(0,c.isNil)(e.execution_time_ms)||!isFinite(e.execution_time_ms)?null:v.A.formatDuration(e.execution_time_ms),meta:{styles:{minWidth:100}}},{header:B.formatMessage(i.YO[i.se.tags]),enableSorting:!1,enableResizing:!0,id:i.se.tags,cell:J?ce:({row:{original:e}})=>(0,C.Y)(T,{tags:e.tags||[],onAddEditTags:()=>null===u||void 0===u?void 0:u(e),baseComponentId:P})}),e.filter((e=>e.id&&!R.includes(e.id)))}),[B,l,u,O,R,P,J,j]),Z=(0,h.N4)({columns:Q,data:j?[]:n,state:{sorting:I,rowSelection:M},getCoreRowModel:(0,f.HT)(),getRowId:(e,t)=>e.request_id||t.toString(),getSortedRowModel:(0,f.h5)(),onSortingChange:Y,onRowSelectionChange:E,enableColumnResizing:!0,enableRowSelection:!0,columnResizeMode:"onChange",meta:{baseComponentId:P,onTraceClicked:l,onTraceTagsEdit:u}}),ee=Z.getState().columnSizingInfo,oe=s.useMemo((()=>{if(j)return{};const e=Z.getFlatHeaders(),t={};return e.forEach((e=>{t[U(e.id)]=e.getSize(),t[V(e.column.id)]=e.column.getSize()})),t}),[ee,Q,Z,j]);return j?(0,C.Y)(te,{baseComponentId:P,runUuid:t}):(0,C.FD)(p.Table,{scrollable:!0,empty:(()=>{if(r){const e=r instanceof w.s?r.getMessageField():r.message;return(0,C.Y)(p.Empty,{image:(0,C.Y)(a.l,{}),description:e,title:(0,C.Y)(x.A,{id:"Cj2i02",defaultMessage:"Error"})})}return!o&&0===n.length&&k?(0,C.Y)(p.Empty,{description:(0,C.Y)(x.A,{id:"LTe7m4",defaultMessage:"No traces found with the current filter query. <button>Reset filters</button> to see all traces.",values:{button:e=>(0,C.Y)(a.T.Link,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewtable.tsx_289",onClick:A,children:e})}}),title:(0,C.Y)(x.A,{id:"yeEPjS",defaultMessage:"No traces found"})}):null})(),style:oe,pagination:(0,C.Y)(p.CursorPagination,{componentId:`${P}.traces_table.pagination`,hasNextPage:d,hasPreviousPage:m,onNextPage:g,onPreviousPage:S}),children:[(0,C.FD)(p.TableRow,{isHeader:!0,children:[Z.getLeafHeaders().map((e=>{var t;return(0,C.Y)(p.TableHeader,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewtable.tsx_365",css:null===(t=e.column.columnDef.meta)||void 0===t?void 0:t.styles,sortable:e.column.getCanSort(),sortDirection:e.column.getIsSorted()||"none",onToggleSort:e.column.getToggleSortingHandler(),header:e,column:e.column,setColumnSizing:Z.setColumnSizing,isResizing:e.column.getIsResizing(),style:{flex:`calc(var(${U(e.id)}) / 100)`},children:(0,h.Kv)(e.column.columnDef.header,e.getContext())},e.id)})),(0,C.Y)(p.TableRowAction,{children:(0,C.FD)(p.DropdownMenu.Root,{children:[(0,C.Y)(p.DropdownMenu.Trigger,{asChild:!0,children:(0,C.Y)(a.B,{componentId:`${P}.traces_table.column_selector_dropdown`,icon:(0,C.Y)(p.ColumnsIcon,{}),size:"small","aria-label":B.formatMessage({id:"zd5Jw4",defaultMessage:"Select columns"})})}),(0,C.Y)(p.DropdownMenu.Content,{align:"end",children:X.map((({key:e,label:t})=>(0,C.FD)(p.DropdownMenu.CheckboxItem,{componentId:`${P}.traces_table.column_toggle_button`,checked:!R.includes(e),onClick:()=>D(e),children:[(0,C.Y)(p.DropdownMenu.ItemIndicator,{}),t]},e)))})]})})]}),o&&(0,C.Y)(p.TableSkeletonRows,{table:Z}),!o&&!r&&Z.getRowModel().rows.map((e=>(0,C.Y)(K,{row:e,columns:Q,selected:M[e.id]},e.id)))]})}));var pe=n(6958);var he=n(8409);n(46932),n(48563);const fe=({requestId:e,traceInfo:t,loadingTraceInfo:n,onClose:l,selectedSpanId:c,onSelectSpan:u})=>{const{traceData:d,loading:m,error:g}=((e,t=!1)=>{const[n,o]=(0,s.useState)(void 0),[a,i]=(0,s.useState)(!1),[l,c]=(0,s.useState)(void 0),u=(0,s.useCallback)((async e=>{i(!0);try{const t=await r.x.getExperimentTraceData(e);Array.isArray(t.spans)?o(t):v.A.logErrorAndNotifyUser("Invalid trace data response: "+JSON.stringify(null===t||void 0===t?void 0:t.toString()))}catch(t){c(t)}i(!1)}),[]);return(0,s.useEffect)((()=>{e&&!t&&u(e)}),[u,e,t]),{traceData:n,loading:a,error:l}})(e,"IN_PROGRESS"===(null===t||void 0===t?void 0:t.status)),{theme:h}=(0,a.u)(),f=!n&&!t,{traceInfo:y,loading:w}=((e,t=!0)=>{const[n,o]=(0,s.useState)(void 0),[a,i]=(0,s.useState)(t),[l,c]=(0,s.useState)(void 0),u=(0,s.useCallback)((async()=>{if(t){c(void 0);try{const t=await r.x.getExperimentTraceInfo(e);if(!t.trace_info)return void o(void 0);o(t.trace_info)}catch(n){c(n)}finally{i(!1)}}}),[t,e]);return(0,s.useEffect)((()=>{u()}),[u]),{traceInfo:n,loading:a,error:l}})(e,f),_=t||y,b=(0,s.useMemo)((()=>n||w?(0,C.Y)(p.TitleSkeleton,{}):_?(0,C.Y)(a.T.Title,{level:2,withoutMargins:!0,children:(0,i.Db)(_)}):e),[n,w,_,e]),S=(0,s.useMemo)((()=>d?{info:_||{},data:d}:void 0),[d,_]),k=((null===d||void 0===d?void 0:d.spans)||[]).length>0;return(0,C.Y)(p.Drawer.Root,{modal:!0,open:!0,onOpenChange:e=>{e||l()},children:(0,C.Y)(p.Drawer.Content,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracedatadrawer.tsx_222",width:"90vw",title:b,expandContentToFullHeight:!0,children:m||n||w?(0,C.Y)(he.a.Skeleton,{}):"IN_PROGRESS"===(null===t||void 0===t?void 0:t.status)?(0,C.FD)(C.FK,{children:[(0,C.Y)(pe.S,{size:"lg"}),(0,C.Y)(p.Empty,{image:(0,C.Y)(a.W,{}),description:(0,C.Y)(x.A,{id:"K+5g8S",defaultMessage:"Trace data is not available for in-progress traces. Please wait for the trace to complete."}),title:(0,C.Y)(x.A,{id:"p0O0uP",defaultMessage:"Trace data not available"})})]}):g?(0,C.FD)(C.FK,{children:[(0,C.Y)(pe.S,{size:"lg"}),(0,C.Y)(p.Empty,{image:(0,C.Y)(a.l,{}),description:(0,C.Y)(x.A,{id:"c4KA32",defaultMessage:"An error occurred while attempting to fetch the trace data. Please wait a moment and try again."}),title:(0,C.Y)(x.A,{id:"eavoW/",defaultMessage:"Error"})})]}):k?S?(0,C.Y)("div",{css:(0,o.AH)({height:"100%",marginLeft:-h.spacing.lg,marginRight:-h.spacing.lg,marginBottom:-h.spacing.lg},""),onWheel:e=>e.stopPropagation(),children:(0,C.Y)(he.a,{modelTrace:S,selectedSpanId:c,onSelectSpan:u})}):null:(0,C.FD)(C.FK,{children:[(0,C.Y)(pe.S,{size:"lg"}),(0,C.Y)(p.Empty,{description:null,title:(0,C.Y)(x.A,{id:"EpFST9",defaultMessage:"No trace data recorded"})})]})})})};var ve=n(43683);const ye=({experimentIds:e,visible:t,rowSelection:n,setRowSelection:o,handleClose:i,refreshTraces:l})=>{const u=(0,b.A)(),[d,m]=(0,s.useState)(""),[g,p]=(0,s.useState)(!1),h=(0,c.keys)((0,c.pickBy)(n,(e=>e)));return(0,C.FD)(pe.d,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewdeletetracemodal.tsx_62",title:(0,C.Y)(x.A,{id:"gRz1nB",defaultMessage:"{count, plural, one {Delete Trace} other {Delete Traces}}",values:{count:h.length}}),visible:t,onCancel:i,okText:(0,C.Y)(x.A,{id:"g56Cuk",defaultMessage:"Delete {count, plural, one { # trace } other { # traces }}",values:{count:h.length}}),onOk:()=>{(async()=>{try{var t;await r.x.deleteTraces(null!==(t=e[0])&&void 0!==t?t:"",h),o({}),l(),i()}catch(n){m(u.formatMessage({id:"zhzZUu",defaultMessage:"An error occured while attempting to delete traces. Please refresh the page and try again."}))}p(!1)})(),p(!0)},okButtonProps:{loading:g,danger:!0},children:[d&&(0,C.Y)(a.T.Paragraph,{color:"error",children:d}),(0,C.Y)(a.T.Paragraph,{children:(0,C.Y)(a.T.Text,{bold:!0,children:(0,C.Y)(x.A,{id:"kmtWGf",defaultMessage:"{count, plural, one { # trace } other { # traces }} will be deleted.",values:{count:h.length}})})}),(0,C.Y)(a.T.Paragraph,{children:(0,C.Y)(x.A,{id:"VfGJFc",defaultMessage:"Deleted traces cannot be restored. Are you sure you want to proceed?"})})]})},we=({experimentIds:e,rowSelection:t,setRowSelection:n,refreshTraces:r,baseComponentId:i})=>{const[l,c]=(0,s.useState)(!1),{theme:u}=(0,a.u)(),d=(0,s.useCallback)((()=>{c(!0)}),[c]),m=(0,s.useCallback)((()=>{c(!1)}),[c]);return(0,C.FD)("div",{css:(0,o.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:u.spacing.sm},""),children:[(0,C.Y)(a.B,{componentId:`${i}.traces_table.delete_traces`,onClick:d,danger:!0,children:(0,C.Y)(x.A,{id:"QAyzA3",defaultMessage:"Delete"})}),(0,C.Y)(ye,{experimentIds:e,visible:l,rowSelection:t,handleClose:m,refreshTraces:r,setRowSelection:n})]})};const _e=({baseComponentId:e})=>{const{theme:t}=(0,a.u)();return(0,C.FD)(a.ax.Root,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_traces_tracesviewcontrols.tsx_28",modal:!1,children:[(0,C.Y)(a.ax.Trigger,{asChild:!0,children:(0,C.Y)(a.B,{size:"small",type:"link",icon:(0,C.Y)(pe.I,{css:(0,o.AH)({svg:{width:16,height:16,color:t.colors.textSecondary}},"")}),componentId:`${e}.traces_table.filter_tooltip`})}),(0,C.FD)(a.ax.Content,{children:[(0,C.Y)(a.ax.Arrow,{}),(0,C.Y)(a.T.Paragraph,{children:(0,C.Y)(x.A,{id:"2Ofya9",defaultMessage:"Search traces using a simplified version of the SQL {whereBold} clause.",values:{whereBold:(0,C.Y)("b",{children:"WHERE"})}})}),(0,C.Y)(x.A,{id:"U3btBc",defaultMessage:"Examples:"}),(0,C.Y)("ul",{children:(0,C.Y)("li",{children:(0,C.Y)("code",{children:'tags.some_tag = "abc"'})})})]})]})};var be={name:"1ykowef",styles:"margin-bottom:0"},xe={name:"ikeoj9",styles:"width:430px"};const Se=({experimentIds:e,filter:t,onChangeFilter:n,rowSelection:r,setRowSelection:i,refreshTraces:l,baseComponentId:c,runUuid:u,traces:d})=>{const m=(0,b.A)(),{theme:g}=(0,a.u)(),[h,f]=(0,s.useState)(t||void 0),[v,y]=(0,s.useState)(!1),w=null!==h&&void 0!==h?h:t,_=Object.entries(r).filter((([,e])=>e)).map((([e])=>e)).length>0?(0,C.Y)(we,{experimentIds:e,rowSelection:r,setRowSelection:i,refreshTraces:l,baseComponentId:c}):(0,C.Y)(p.TableFilterLayout,{css:be,children:(0,C.Y)(Y.I,{componentId:`${c}.traces_table.search_filter`,placeholder:m.formatMessage({id:"FPMrvd",defaultMessage:"Search traces"}),value:w,css:xe,onChange:e=>f(e.target.value),prefix:(0,C.Y)(Y.S,{}),suffix:(0,C.Y)(_e,{baseComponentId:c}),allowClear:!0,onClear:()=>{n(""),f(void 0)},onKeyDown:e=>{"Enter"===e.key&&(n(w),f(void 0))}})});return(0,C.Y)("div",{css:(0,o.AH)({display:"flex",gap:g.spacing.xs},""),children:_})};var ke=n(32614);const Ce={hiddenColumns:[i.se.traceName,i.se.source]},Ae=e=>{const t=(0,s.useMemo)((()=>{const t=JSON.stringify(e.slice().sort());return ke.A.getStoreForComponent("ExperimentViewTraces",t)}),[e]),[n,o]=(0,s.useState)((()=>(e=>{try{const t=e.getItem("uiState"),n=JSON.parse(t);return(0,c.isObject)(n)?n:Ce}catch(t){return Ce}})(t))),a=(0,s.useCallback)((e=>{o((t=>{const n=t.hiddenColumns||[];return{hiddenColumns:n.includes(e)?n.filter((t=>t!==e)):[...n,e]}}))}),[]);return(0,s.useEffect)((()=>{t.setItem("uiState",JSON.stringify(n))}),[t,n]),{uiState:n,toggleHiddenColumn:a}},Ie="selectedTraceId",Te="selectedSpanId",Ye=[{id:i.se.timestampMs,desc:!0}],Me=({experimentIds:e,runUuid:t,loggedModelId:n,disabledColumns:l,baseComponentId:u=(t?"mlflow.run.traces":"mlflow.experiment_page.traces")})=>{const d=(0,s.useRef)(void 0),[m,p]=(0,s.useState)(""),[h,f]=(0,s.useState)(Ye),[v,w]=(0,s.useState)({}),[_,b]=(()=>{var e;const[t,n]=(0,y.ok)(),o=null!==(e=t.get(Ie))&&void 0!==e?e:void 0,a=(0,s.useCallback)((e=>{n((t=>void 0===e?(t.delete(Ie),t):(t.set(Ie,e),t)))}),[n]);return[o,a]})(),[x,k]=(()=>{var e;const[t,n]=(0,y.ok)(),o=null!==(e=t.get(Te))&&void 0!==e?e:void 0,a=(0,s.useCallback)((e=>{n((t=>void 0===e?(t.delete(Te),t):(t.set(Te,e),t)),{replace:!0})}),[n]);return[o,a]})(),{traces:A,loading:I,error:T,hasNextPage:Y,hasPreviousPage:M,fetchNextPage:N,fetchPrevPage:E,refreshCurrentPage:R}=g({experimentIds:e,sorting:h,filter:m,runUuid:t,loggedModelId:n}),O=(0,s.useCallback)((({request_id:e})=>b(e)),[b]),P=(0,s.useCallback)((()=>{N(),w({})}),[N]),D=(0,s.useCallback)((()=>{E(),w({})}),[E]);(0,s.useEffect)((()=>{window.clearTimeout(d.current);const e=async()=>{I||M||(await R(!0),window.clearTimeout(d.current),d.current=window.setTimeout(e,3e4))};return d.current=window.setTimeout(e,3e4),()=>window.clearTimeout(d.current)}),[R,I,M]);const{theme:F}=(0,a.u)(),L=(0,s.useMemo)((()=>{if(_)return A.find((e=>e.request_id===_))}),[_,A]),{uiState:H,toggleHiddenColumn:q}=Ae(e),U=(0,s.useMemo)((()=>(0,c.uniq)((0,c.compact)(A.flatMap((e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.map((e=>e.key))}))))),[A]),{showEditTagsModalForTrace:V,EditTagsModal:K}=(({onSuccess:e,existingTagKeys:t=[],useV3Apis:n})=>{const{showEditTagsModal:o,EditTagsModal:a}=(0,ve.Q)({saveTagsHandler:async(e,t,o)=>{if(!e.traceRequestId)return;const a=e.traceRequestId,s=o.filter((({key:e,value:n})=>!t.some((({key:t,value:o})=>t===e&&n===o)))),i=t.filter((({key:e})=>!o.some((({key:t})=>e===t))));return Promise.all([...s.map((({key:e,value:t})=>n?r.x.setExperimentTraceTagV3(a,e,t):r.x.setExperimentTraceTag(a,e,t))),...i.map((({key:e})=>n?r.x.deleteExperimentTraceTagV3(a,e):r.x.deleteExperimentTraceTag(a,e)))])},valueRequired:!0,allAvailableTags:t.filter((e=>e&&!e.startsWith(S.nt))),onSuccess:e});return{showEditTagsModalForTrace:(0,s.useCallback)((e=>{var t;if(!e.request_id)return;const n=(null===(t=e.tags)||void 0===t?void 0:t.filter((({key:e})=>e&&!e.startsWith(S.nt))))||[];o({traceRequestId:e.request_id,tags:n||[]})}),[o]),EditTagsModal:a}})({onSuccess:()=>R(!0),existingTagKeys:U}),z=""!==m,W=A.some((e=>!(0,c.isNil)((0,i.oj)(e)))),$=(0,s.useMemo)((()=>W?[]:[i.se.totalTokens]),[W]),B=(0,s.useMemo)((()=>[...null!==l&&void 0!==l?l:[],...$]),[l,$]),G=(0,s.useMemo)((()=>{var e;return[...null!==(e=H.hiddenColumns)&&void 0!==e?e:[],...B]}),[H,B]);return(0,C.FD)("div",{css:(0,o.AH)({display:"flex",flexDirection:"column",gap:F.spacing.sm,height:"100%",overflow:"hidden"},""),children:[(0,C.Y)(Se,{experimentIds:e,filter:m,onChangeFilter:p,rowSelection:v,setRowSelection:w,refreshTraces:R,baseComponentId:u,runUuid:t,traces:A}),(0,C.Y)(ge,{experimentIds:e,runUuid:t,traces:A,loading:I,error:T,onTraceClicked:O,onTraceTagsEdit:V,hasNextPage:Y,hasPreviousPage:M,onPreviousPage:D,onNextPage:P,onTagsUpdated:R,usingFilters:z,onResetFilters:()=>p(""),hiddenColumns:G,disableTokenColumn:!W,disabledColumns:B,setSorting:e=>{if((0,c.isFunction)(e))return f((t=>{const n=e(t),o=t[0];return n&&0!==n.length||!o?n:[{id:o.id,desc:!o.desc}]}))},sorting:h,rowSelection:v,setRowSelection:w,baseComponentId:u,toggleHiddenColumn:q}),_&&(0,C.Y)(fe,{traceInfo:L,loadingTraceInfo:I,requestId:_,onClose:()=>b(void 0),selectedSpanId:x,onSelectSpan:k}),K]})}},94026:function(e,t,n){n.d(t,{Ub:function(){return s},b6:function(){return i.b},wY:function(){return r}});var o=n(31014),a=n(18930);function s(e){return function(e){return(0,a.useSyncExternalStore)(o.useCallback((t=>(e.addEventListener("change",t),()=>{e.removeEventListener("change",t)})),[e]),(()=>e.matches))}(o.useMemo((()=>window.matchMedia(e)),[e]))}function r({ref:e,debounceTimeMs:t}){const n=(0,o.useRef)({width:-1,height:-1}),a=(0,o.useRef)(),[s,r]=(0,o.useState)(null),i=(0,o.useCallback)((e=>{if(0===e.length)return;const o=e[0].contentRect;if(-1===n.current.width)return n.current={width:o.width,height:o.height},void r(n.current);if(o.width!==n.current.width||o.height!==n.current.height){if(n.current.width=o.width,n.current.height=o.height,!t)return void r({...n.current});clearTimeout(a.current),a.current=setTimeout((()=>{r({...n.current})}),t)}}),[t]),l=(0,o.useRef)();return l.current||(l.current=new ResizeObserver(i)),(0,o.useEffect)((()=>{const t="function"===typeof e?e():e.current;if(t){const e=l.current;return e.observe(t),()=>e.unobserve(t)}})),s}var i=n(39771)},98597:function(e,t,n){n.d(t,{t:function(){return f}});var o=n(89555),a=n(37523),s=n(13062),r=n(31014),i=n(88464),l=n(6958),c=n(56412),u=n(50111);const{Paragraph:d}=s.T;var m={name:"zjik7",styles:"display:flex"},g={name:"1ff36h2",styles:"flex-grow:1"};const p=r.memo((e=>{const{theme:t}=(0,s.u)();return(0,u.Y)(l.d,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17",title:"Tag: "+e.tagKey,visible:e.isKeyValueTagFullViewModalVisible,onCancel:()=>e.setIsKeyValueTagFullViewModalVisible(!1),children:(0,u.FD)("div",{css:m,children:[(0,u.Y)(d,{css:g,children:(0,u.Y)("pre",{css:(0,o.AH)({backgroundColor:t.colors.backgroundPrimary,marginTop:t.spacing.sm,whiteSpace:"pre-wrap",wordBreak:"break-all"},""),children:e.tagValue})}),(0,u.Y)("div",{css:(0,o.AH)({marginTop:t.spacing.sm},""),children:(0,u.Y)(c.i,{copyText:e.tagValue,showLabel:!1,icon:(0,u.Y)(a.CopyIcon,{}),"aria-label":"Copy"})})]})})}));function h(e=!0){return e?{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"}}const f=({isClosable:e=!1,onClose:t,tag:n,enableFullViewModal:l=!1,charLimit:c=30,maxWidth:d=300,className:m})=>{const g=(0,i.A)(),[f,v]=(0,r.useState)(!1),{shouldTruncateKey:y,shouldTruncateValue:w}=function(e,t=30){const{key:n,value:o}=e,a=n.length+o.length,s=n.length>o.length,r=s?o.length:n.length;return a<=t?{shouldTruncateKey:!1,shouldTruncateValue:!1}:r>t/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:s,shouldTruncateValue:!s}}(n,c),_=l&&(y||w),b=g.formatMessage({id:"ZXUtU8",defaultMessage:"Click to see more"});return(0,u.FD)("div",{children:[(0,u.Y)(a.Tag,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60",closable:e,onClose:t,title:n.key,className:m,children:(0,u.Y)(a.LegacyTooltip,{title:_?b:"",children:(0,u.FD)("span",{css:(0,o.AH)({maxWidth:d,display:"inline-flex"},""),onClick:()=>_?v(!0):void 0,children:[(0,u.Y)(s.T.Text,{bold:!0,title:n.key,css:h(y),children:n.key}),n.value&&(0,u.FD)(s.T.Text,{title:n.value,css:h(w),children:[": ",n.value]})]})})}),(0,u.Y)("div",{children:f&&(0,u.Y)(p,{tagKey:n.key,tagValue:n.value,isKeyValueTagFullViewModalVisible:f,setIsKeyValueTagFullViewModalVisible:v})})]})}}}]);
//# sourceMappingURL=4304.dda47375.chunk.js.map